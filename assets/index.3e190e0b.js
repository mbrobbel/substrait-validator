(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();function Sn(){}function Vl(r){return r()}function ro(){return Object.create(null)}function ir(r){r.forEach(Vl)}function nf(r){return typeof r=="function"}function rf(r,t){return r!=r?t==t:r!==t||r&&typeof r=="object"||typeof r=="function"}function sf(r){return Object.keys(r).length===0}function ht(r,t){r.appendChild(t)}function of(r,t,e){r.insertBefore(t,e||null)}function Fl(r){r.parentNode.removeChild(r)}function se(r){return document.createElement(r)}function oe(r){return document.createTextNode(r)}function br(){return oe(" ")}function we(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e)}function lf(r){return Array.from(r.childNodes)}let Mi;function Ai(r){Mi=r}function hf(){if(!Mi)throw new Error("Function called outside component initialization");return Mi}function af(r){hf().$$.on_mount.push(r)}const wi=[],Fr=[],sn=[],so=[],ff=Promise.resolve();let Hr=!1;function uf(){Hr||(Hr=!0,ff.then(Hl))}function Ur(r){sn.push(r)}const yr=new Set;let Fi=0;function Hl(){const r=Mi;do{for(;Fi<wi.length;){const t=wi[Fi];Fi++,Ai(t),cf(t.$$)}for(Ai(null),wi.length=0,Fi=0;Fr.length;)Fr.pop()();for(let t=0;t<sn.length;t+=1){const e=sn[t];yr.has(e)||(yr.add(e),e())}sn.length=0}while(wi.length);for(;so.length;)so.pop()();Hr=!1,yr.clear(),Ai(r)}function cf(r){if(r.fragment!==null){r.update(),ir(r.before_update);const t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(Ur)}}const df=new Set;function pf(r,t){r&&r.i&&(df.delete(r),r.i(t))}function gf(r,t,e,i){const{fragment:n,on_mount:s,on_destroy:o,after_update:l}=r.$$;n&&n.m(t,e),i||Ur(()=>{const h=s.map(Vl).filter(nf);o?o.push(...h):ir(h),r.$$.on_mount=[]}),l.forEach(Ur)}function mf(r,t){const e=r.$$;e.fragment!==null&&(ir(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function bf(r,t){r.$$.dirty[0]===-1&&(wi.push(r),uf(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31}function yf(r,t,e,i,n,s,o,l=[-1]){const h=Mi;Ai(r);const a=r.$$={fragment:null,ctx:null,props:s,update:Sn,not_equal:n,bound:ro(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(h?h.$$.context:[])),callbacks:ro(),dirty:l,skip_bound:!1,root:t.target||h.$$.root};o&&o(a.root);let f=!1;if(a.ctx=e?e(r,t.props||{},(u,c,...d)=>{const p=d.length?d[0]:c;return a.ctx&&n(a.ctx[u],a.ctx[u]=p)&&(!a.skip_bound&&a.bound[u]&&a.bound[u](p),f&&bf(r,u)),c}):[],a.update(),f=!0,ir(a.before_update),a.fragment=i?i(a.ctx):!1,t.target){if(t.hydrate){const u=lf(t.target);a.fragment&&a.fragment.l(u),u.forEach(Fl)}else a.fragment&&a.fragment.c();t.intro&&pf(r.$$.fragment),gf(r,t.target,t.anchor,t.customElement),Hl()}Ai(h)}class wf{$destroy(){mf(this,1),this.$destroy=Sn}$on(t,e){const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(e),()=>{const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}$set(t){this.$$set&&!sf(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}let $;const Ul=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Ul.decode();let on;function ln(){return on.byteLength===0&&(on=new Uint8Array($.memory.buffer)),on}function le(r,t){return Ul.decode(ln().subarray(r,r+t))}const ae=new Array(32).fill(void 0);ae.push(void 0,null,!0,!1);let Ci=ae.length;function V(r){Ci===ae.length&&ae.push(ae.length+1);const t=Ci;return Ci=ae[t],ae[t]=r,t}function I(r){return ae[r]}function xf(r){r<36||(ae[r]=Ci,Ci=r)}function Wr(r){const t=I(r);return xf(r),t}let ze=0;const hn=new TextEncoder("utf-8"),kf=typeof hn.encodeInto=="function"?function(r,t){return hn.encodeInto(r,t)}:function(r,t){const e=hn.encode(r);return t.set(e),{read:r.length,written:e.length}};function xi(r,t,e){if(e===void 0){const l=hn.encode(r),h=t(l.length);return ln().subarray(h,h+l.length).set(l),ze=l.length,h}let i=r.length,n=t(i);const s=ln();let o=0;for(;o<i;o++){const l=r.charCodeAt(o);if(l>127)break;s[n+o]=l}if(o!==i){o!==0&&(r=r.slice(o)),n=e(n,i,i=o+r.length*3);const l=ln().subarray(n+o,n+i);o+=kf(r,l).written}return ze=o,n}function vf(r){return r==null}let an;function Pt(){return an.byteLength===0&&(an=new Int32Array($.memory.buffer)),an}function $r(r){const t=typeof r;if(t=="number"||t=="boolean"||r==null)return`${r}`;if(t=="string")return`"${r}"`;if(t=="symbol"){const n=r.description;return n==null?"Symbol":`Symbol(${n})`}if(t=="function"){const n=r.name;return typeof n=="string"&&n.length>0?`Function(${n})`:"Function"}if(Array.isArray(r)){const n=r.length;let s="[";n>0&&(s+=$r(r[0]));for(let o=1;o<n;o++)s+=", "+$r(r[o]);return s+="]",s}const e=/\[object ([^\]]+)\]/.exec(toString.call(r));let i;if(e.length>1)i=e[1];else return toString.call(r);if(i=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:i}function Sf(r,t,e,i){const n={a:r,b:t,cnt:1,dtor:e},s=(...o)=>{n.cnt++;const l=n.a;n.a=0;try{return i(l,n.b,...o)}finally{--n.cnt===0?$.__wbindgen_export_2.get(n.dtor)(l,n.b):n.a=l}};return s.original=n,s}function Af(r,t,e){$._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__h8cb0181def3bd14d(r,t,V(e))}function oo(){try{const e=$.__wbindgen_add_to_stack_pointer(-16);$.version(e);var r=Pt()[e/4+0],t=Pt()[e/4+1];return le(r,t)}finally{$.__wbindgen_add_to_stack_pointer(16),$.__wbindgen_free(r,t)}}function lo(){try{const e=$.__wbindgen_add_to_stack_pointer(-16);$.substrait_version(e);var r=Pt()[e/4+0],t=Pt()[e/4+1];return le(r,t)}finally{$.__wbindgen_add_to_stack_pointer(16),$.__wbindgen_free(r,t)}}function Cf(r){const t=xi(r,$.__wbindgen_malloc,$.__wbindgen_realloc),e=ze,i=$.validate(t,e);return Wr(i)}function kt(r,t){try{return r.apply(this,t)}catch(e){$.__wbindgen_exn_store(V(e))}}function Of(r,t,e,i){$.wasm_bindgen__convert__closures__invoke2_mut__h409cffde0551835b(r,t,V(e),V(i))}async function Tf(r,t){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,t)}catch(i){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const e=await r.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(r,t);return e instanceof WebAssembly.Instance?{instance:e,module:r}:e}}function _f(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(t,e){const i=le(t,e);return V(i)},r.wbg.__wbindgen_object_drop_ref=function(t){Wr(t)},r.wbg.__wbindgen_string_get=function(t,e){const i=I(e),n=typeof i=="string"?i:void 0;var s=vf(n)?0:xi(n,$.__wbindgen_malloc,$.__wbindgen_realloc),o=ze;Pt()[t/4+1]=o,Pt()[t/4+0]=s},r.wbg.__wbindgen_cb_drop=function(t){const e=Wr(t).original;return e.cnt--==1?(e.a=0,!0):!1},r.wbg.__wbindgen_object_clone_ref=function(t){const e=I(t);return V(e)},r.wbg.__wbg_fetch_b1379d93c1e2b015=function(t){const e=fetch(I(t));return V(e)},r.wbg.__wbg_fetch_8c28485eb2d6317d=function(t,e){const i=I(t).fetch(I(e));return V(i)},r.wbg.__wbg_new_483f23f84dfd2751=function(){return kt(function(){const t=new Headers;return V(t)},arguments)},r.wbg.__wbg_append_fcf64231455390c4=function(){return kt(function(t,e,i,n,s){I(t).append(le(e,i),le(n,s))},arguments)},r.wbg.__wbg_instanceof_Response_e928c54c1025470c=function(t){return I(t)instanceof Response},r.wbg.__wbg_url_0f82030e7245954c=function(t,e){const i=I(e).url,n=xi(i,$.__wbindgen_malloc,$.__wbindgen_realloc),s=ze;Pt()[t/4+1]=s,Pt()[t/4+0]=n},r.wbg.__wbg_status_5b4a574de7c5bbfe=function(t){return I(t).status},r.wbg.__wbg_headers_1dc1ef92ba3d32b1=function(t){const e=I(t).headers;return V(e)},r.wbg.__wbg_text_5cb78830c1a11c5b=function(){return kt(function(t){const e=I(t).text();return V(e)},arguments)},r.wbg.__wbg_newwithstrandinit_41c86e821f771b24=function(){return kt(function(t,e,i){const n=new Request(le(t,e),I(i));return V(n)},arguments)},r.wbg.__wbindgen_is_function=function(t){return typeof I(t)=="function"},r.wbg.__wbg_newnoargs_fc5356289219b93b=function(t,e){const i=new Function(le(t,e));return V(i)},r.wbg.__wbindgen_is_object=function(t){const e=I(t);return typeof e=="object"&&e!==null},r.wbg.__wbg_next_0e1ee6203bc0f8ed=function(t){const e=I(t).next;return V(e)},r.wbg.__wbg_next_9ef803116340cdc1=function(){return kt(function(t){const e=I(t).next();return V(e)},arguments)},r.wbg.__wbg_done_2a1e30464aae6a4d=function(t){return I(t).done},r.wbg.__wbg_value_a495c29471c31da6=function(t){const e=I(t).value;return V(e)},r.wbg.__wbg_iterator_6ac6eb1e020f18e3=function(){return V(Symbol.iterator)},r.wbg.__wbg_get_89247d3aeaa38cc5=function(){return kt(function(t,e){const i=Reflect.get(I(t),I(e));return V(i)},arguments)},r.wbg.__wbg_call_4573f605ca4b5f10=function(){return kt(function(t,e){const i=I(t).call(I(e));return V(i)},arguments)},r.wbg.__wbg_new_306ce8d57919e6ae=function(){const t=new Object;return V(t)},r.wbg.__wbg_self_ba1ddafe9ea7a3a2=function(){return kt(function(){const t=self.self;return V(t)},arguments)},r.wbg.__wbg_window_be3cc430364fd32c=function(){return kt(function(){const t=window.window;return V(t)},arguments)},r.wbg.__wbg_globalThis_56d9c9f814daeeee=function(){return kt(function(){const t=globalThis.globalThis;return V(t)},arguments)},r.wbg.__wbg_global_8c35aeee4ac77f2b=function(){return kt(function(){const t=global.global;return V(t)},arguments)},r.wbg.__wbindgen_is_undefined=function(t){return I(t)===void 0},r.wbg.__wbg_call_9855a4612eb496cb=function(){return kt(function(t,e,i){const n=I(t).call(I(e),I(i));return V(n)},arguments)},r.wbg.__wbg_new_78403b138428b684=function(t,e){try{var i={a:t,b:e},n=(o,l)=>{const h=i.a;i.a=0;try{return Of(h,i.b,o,l)}finally{i.a=h}};const s=new Promise(n);return V(s)}finally{i.a=i.b=0}},r.wbg.__wbg_resolve_f269ce174f88b294=function(t){const e=Promise.resolve(I(t));return V(e)},r.wbg.__wbg_then_1c698eedca15eed6=function(t,e){const i=I(t).then(I(e));return V(i)},r.wbg.__wbg_then_4debc41d4fc92ce5=function(t,e,i){const n=I(t).then(I(e),I(i));return V(n)},r.wbg.__wbg_buffer_de1150f91b23aa89=function(t){const e=I(t).buffer;return V(e)},r.wbg.__wbg_newwithbyteoffsetandlength_9ca61320599a2c84=function(t,e,i){const n=new Uint8Array(I(t),e>>>0,i>>>0);return V(n)},r.wbg.__wbg_new_97cf52648830a70d=function(t){const e=new Uint8Array(I(t));return V(e)},r.wbg.__wbg_has_ded5f0e31f1ff6ad=function(){return kt(function(t,e){return Reflect.has(I(t),I(e))},arguments)},r.wbg.__wbg_set_b12cd0ab82903c2f=function(){return kt(function(t,e,i){return Reflect.set(I(t),I(e),I(i))},arguments)},r.wbg.__wbg_stringify_cf20dc96bee34a66=function(){return kt(function(t){const e=JSON.stringify(I(t));return V(e)},arguments)},r.wbg.__wbg_new_693216e109162396=function(){const t=new Error;return V(t)},r.wbg.__wbg_stack_0ddaca5d1abfb52f=function(t,e){const i=I(e).stack,n=xi(i,$.__wbindgen_malloc,$.__wbindgen_realloc),s=ze;Pt()[t/4+1]=s,Pt()[t/4+0]=n},r.wbg.__wbg_error_09919627ac0992f5=function(t,e){try{console.error(le(t,e))}finally{$.__wbindgen_free(t,e)}},r.wbg.__wbindgen_debug_string=function(t,e){const i=$r(I(e)),n=xi(i,$.__wbindgen_malloc,$.__wbindgen_realloc),s=ze;Pt()[t/4+1]=s,Pt()[t/4+0]=n},r.wbg.__wbindgen_throw=function(t,e){throw new Error(le(t,e))},r.wbg.__wbindgen_memory=function(){const t=$.memory;return V(t)},r.wbg.__wbindgen_closure_wrapper1730=function(t,e,i){const n=Sf(t,e,301,Af);return V(n)},r}function Lf(r,t){return $=r.exports,Wl.__wbindgen_wasm_module=t,an=new Int32Array($.memory.buffer),on=new Uint8Array($.memory.buffer),$}async function Wl(r){typeof r>"u"&&(r="/assets/substrait_playground_bg.wasm");const t=_f();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:e,module:i}=await Tf(await r,t);return Lf(e,i)}class G{constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let n=[];return this.decompose(0,t,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(e,this.length,n,1),Kt.from(n,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),Kt.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),n=new Oi(this),s=new Oi(t);for(let o=e,l=e;;){if(n.next(o),s.next(o),o=0,n.lineBreak!=s.lineBreak||n.done!=s.done||n.value!=s.value)return!1;if(l+=n.value.length,n.done||l>=i)return!0}}iter(t=1){return new Oi(this,t)}iterRange(t,e=this.length){return new $l(this,t,e)}iterLines(t,e){let i;if(t==null)i=this.iter();else{e==null&&(e=this.lines+1);let n=this.line(t).from;i=this.iterRange(n,Math.max(n,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new jl(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?G.empty:t.length<=32?new st(t):Kt.from(st.split(t,[]))}}class st extends G{constructor(t,e=Mf(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,n){for(let s=0;;s++){let o=this.text[s],l=n+o.length;if((e?i:l)>=t)return new Bf(n,l,i,o);n=l+1,i++}}decompose(t,e,i,n){let s=t<=0&&e>=this.length?this:new st(ho(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(n&1){let o=i.pop(),l=fn(s.text,o.text.slice(),0,s.length);if(l.length<=32)i.push(new st(l,o.length+s.length));else{let h=l.length>>1;i.push(new st(l.slice(0,h)),new st(l.slice(h)))}}else i.push(s)}replace(t,e,i){if(!(i instanceof st))return super.replace(t,e,i);let n=fn(this.text,fn(i.text,ho(this.text,0,t)),e),s=this.length+i.length-(e-t);return n.length<=32?new st(n,s):Kt.from(st.split(n,[]),s)}sliceString(t,e=this.length,i=`
`){let n="";for(let s=0,o=0;s<=e&&o<this.text.length;o++){let l=this.text[o],h=s+l.length;s>t&&o&&(n+=i),t<h&&e>s&&(n+=l.slice(Math.max(0,t-s),e-s)),s=h+1}return n}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],n=-1;for(let s of t)i.push(s),n+=s.length+1,i.length==32&&(e.push(new st(i,n)),i=[],n=-1);return n>-1&&e.push(new st(i,n)),e}}class Kt extends G{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let i of t)this.lines+=i.lines}lineInner(t,e,i,n){for(let s=0;;s++){let o=this.children[s],l=n+o.length,h=i+o.lines-1;if((e?h:l)>=t)return o.lineInner(t,e,i,n);n=l+1,i=h+1}}decompose(t,e,i,n){for(let s=0,o=0;o<=e&&s<this.children.length;s++){let l=this.children[s],h=o+l.length;if(t<=h&&e>=o){let a=n&((o<=t?1:0)|(h>=e?2:0));o>=t&&h<=e&&!a?i.push(l):l.decompose(t-o,e-o,i,a)}o=h+1}}replace(t,e,i){if(i.lines<this.lines)for(let n=0,s=0;n<this.children.length;n++){let o=this.children[n],l=s+o.length;if(t>=s&&e<=l){let h=o.replace(t-s,e-s,i),a=this.lines-o.lines+h.lines;if(h.lines<a>>5-1&&h.lines>a>>5+1){let f=this.children.slice();return f[n]=h,new Kt(f,this.length-(e-t)+i.length)}return super.replace(s,l,h)}s=l+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i=`
`){let n="";for(let s=0,o=0;s<this.children.length&&o<=e;s++){let l=this.children[s],h=o+l.length;o>t&&s&&(n+=i),t<h&&e>o&&(n+=l.sliceString(t-o,e-o,i)),o=h+1}return n}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof Kt))return 0;let i=0,[n,s,o,l]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;n+=e,s+=e){if(n==o||s==l)return i;let h=this.children[n],a=t.children[s];if(h!=a)return i+h.scanIdentical(a,e);i+=h.length+1}}static from(t,e=t.reduce((i,n)=>i+n.length+1,-1)){let i=0;for(let d of t)i+=d.lines;if(i<32){let d=[];for(let p of t)p.flatten(d);return new st(d,e)}let n=Math.max(32,i>>5),s=n<<1,o=n>>1,l=[],h=0,a=-1,f=[];function u(d){let p;if(d.lines>s&&d instanceof Kt)for(let x of d.children)u(x);else d.lines>o&&(h>o||!h)?(c(),l.push(d)):d instanceof st&&h&&(p=f[f.length-1])instanceof st&&d.lines+p.lines<=32?(h+=d.lines,a+=d.length+1,f[f.length-1]=new st(p.text.concat(d.text),p.length+1+d.length)):(h+d.lines>n&&c(),h+=d.lines,a+=d.length+1,f.push(d))}function c(){h!=0&&(l.push(f.length==1?f[0]:Kt.from(f,a)),a=-1,h=f.length=0)}for(let d of t)u(d);return c(),l.length==1?l[0]:new Kt(l,e)}}G.empty=new st([""],0);function Mf(r){let t=-1;for(let e of r)t+=e.length+1;return t}function fn(r,t,e=0,i=1e9){for(let n=0,s=0,o=!0;s<r.length&&n<=i;s++){let l=r[s],h=n+l.length;h>=e&&(h>i&&(l=l.slice(0,i-n)),n<e&&(l=l.slice(e-n)),o?(t[t.length-1]+=l,o=!1):t.push(l)),n=h+1}return t}function ho(r,t,e){return fn(r,[""],t,e)}class Oi{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof st?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],s=this.offsets[i],o=s>>1,l=n instanceof st?n.text.length:n.children.length;if(o==(e>0?l:0)){if(i==0)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(e>0?0:1)){if(this.offsets[i]+=e,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(n instanceof st){let h=n.text[o+(e<0?-1:0)];if(this.offsets[i]+=e,h.length>Math.max(0,t))return this.value=t==0?h:e>0?h.slice(t):h.slice(0,h.length-t),this;t-=h.length}else{let h=n.children[o+(e<0?-1:0)];t>h.length?(t-=h.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(h),this.offsets.push(e>0?1:(h instanceof st?h.text.length:h.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class $l{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new Oi(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:n}=this.cursor.next(t);return this.pos+=(n.length+t)*e,this.value=n.length<=i?n:e<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class jl{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:n}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(G.prototype[Symbol.iterator]=function(){return this.iter()},Oi.prototype[Symbol.iterator]=$l.prototype[Symbol.iterator]=jl.prototype[Symbol.iterator]=function(){return this});class Bf{constructor(t,e,i,n){this.from=t,this.to=e,this.number=i,this.text=n}get length(){return this.to-this.from}}let Xe="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(r=>r?parseInt(r,36):1);for(let r=1;r<Xe.length;r++)Xe[r]+=Xe[r-1];function Pf(r){for(let t=1;t<Xe.length;t+=2)if(Xe[t]>r)return Xe[t-1]<=r;return!1}function ao(r){return r>=127462&&r<=127487}const fo=8205;function Bt(r,t,e=!0,i=!0){return(e?Gl:Df)(r,t,i)}function Gl(r,t,e){if(t==r.length)return t;t&&ql(r.charCodeAt(t))&&Kl(r.charCodeAt(t-1))&&t--;let i=un(r,t);for(t+=jr(i);t<r.length;){let n=un(r,t);if(i==fo||n==fo||e&&Pf(n))t+=jr(n),i=n;else if(ao(n)){let s=0,o=t-2;for(;o>=0&&ao(un(r,o));)s++,o-=2;if(s%2==0)break;t+=2}else break}return t}function Df(r,t,e){for(;t>0;){let i=Gl(r,t-2,e);if(i<t)return i;t--}return 0}function ql(r){return r>=56320&&r<57344}function Kl(r){return r>=55296&&r<56320}function un(r,t){let e=r.charCodeAt(t);if(!Kl(e)||t+1==r.length)return e;let i=r.charCodeAt(t+1);return ql(i)?(e-55296<<10)+(i-56320)+65536:e}function jr(r){return r<65536?1:2}const Gr=/\r\n?|\n/;var Ct=function(r){return r[r.Simple=0]="Simple",r[r.TrackDel=1]="TrackDel",r[r.TrackBefore=2]="TrackBefore",r[r.TrackAfter=3]="TrackAfter",r}(Ct||(Ct={}));class Xt{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,n=0;e<this.sections.length;){let s=this.sections[e++],o=this.sections[e++];o<0?(t(i,n,s),n+=s):n+=o,i+=s}}iterChangedRanges(t,e=!1){qr(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];n<0?t.push(i,n):t.push(n,i)}return new Xt(t)}composeDesc(t){return this.empty?t:t.empty?this:Yl(this,t)}mapDesc(t,e=!1){return t.empty?this:Kr(this,t,e)}mapPos(t,e=-1,i=Ct.Simple){let n=0,s=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],h=this.sections[o++],a=n+l;if(h<0){if(a>t)return s+(t-n);s+=l}else{if(i!=Ct.Simple&&a>=t&&(i==Ct.TrackDel&&n<t&&a>t||i==Ct.TrackBefore&&n<t||i==Ct.TrackAfter&&a>t))return null;if(a>t||a==t&&e<0&&!l)return t==n||e<0?s:s+h;s+=h}n=a}if(t>n)throw new RangeError(`Position ${t} is out of range for changeset of length ${n}`);return s}touchesRange(t,e=t){for(let i=0,n=0;i<this.sections.length&&n<=e;){let s=this.sections[i++],o=this.sections[i++],l=n+s;if(o>=0&&n<=e&&l>=t)return n<t&&l>e?"cover":!0;n=l}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];t+=(t?" ":"")+i+(n>=0?":"+n:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>typeof e!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Xt(t)}static create(t){return new Xt(t)}}class at extends Xt{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return qr(this,(e,i,n,s,o)=>t=t.replace(n,n+(i-e),o),!1),t}mapDesc(t,e=!1){return Kr(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let n=0,s=0;n<e.length;n+=2){let o=e[n],l=e[n+1];if(l>=0){e[n]=l,e[n+1]=o;let h=n>>1;for(;i.length<h;)i.push(G.empty);i.push(o?t.slice(s,s+o):G.empty)}s+=o}return new at(e,i)}compose(t){return this.empty?t:t.empty?this:Yl(this,t,!0)}map(t,e=!1){return t.empty?this:Kr(this,t,e,!0)}iterChanges(t,e=!1){qr(this,t,e)}get desc(){return Xt.create(this.sections)}filter(t){let e=[],i=[],n=[],s=new Bi(this);t:for(let o=0,l=0;;){let h=o==t.length?1e9:t[o++];for(;l<h||l==h&&s.len==0;){if(s.done)break t;let f=Math.min(s.len,h-l);gt(n,f,-1);let u=s.ins==-1?-1:s.off==0?s.ins:0;gt(e,f,u),u>0&&Se(i,e,s.text),s.forward(f),l+=f}let a=t[o++];for(;l<a;){if(s.done)break t;let f=Math.min(s.len,a-l);gt(e,f,-1),gt(n,f,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(f),l+=f}}return{changes:new at(e,i),filtered:Xt.create(n)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],n=this.sections[e+1];n<0?t.push(i):n==0?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let n=[],s=[],o=0,l=null;function h(f=!1){if(!f&&!n.length)return;o<e&&gt(n,e-o,-1);let u=new at(n,s);l=l?l.compose(u.map(l)):u,n=[],s=[],o=0}function a(f){if(Array.isArray(f))for(let u of f)a(u);else if(f instanceof at){if(f.length!=e)throw new RangeError(`Mismatched change set length (got ${f.length}, expected ${e})`);h(),l=l?l.compose(f.map(l)):f}else{let{from:u,to:c=u,insert:d}=f;if(u>c||u<0||c>e)throw new RangeError(`Invalid change range ${u} to ${c} (in doc of length ${e})`);let p=d?typeof d=="string"?G.of(d.split(i||Gr)):d:G.empty,x=p.length;if(u==c&&x==0)return;u<o&&h(),u>o&&gt(n,u-o,-1),gt(n,c-u,x),Se(s,n,p),o=c}}return a(t),h(!l),l}static empty(t){return new at(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let n=0;n<t.length;n++){let s=t[n];if(typeof s=="number")e.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)e.push(s[0],0);else{for(;i.length<n;)i.push(G.empty);i[n]=G.of(s.slice(1)),e.push(s[0],i[n].length)}}}return new at(e,i)}static createSet(t,e){return new at(t,e)}}function gt(r,t,e,i=!1){if(t==0&&e<=0)return;let n=r.length-2;n>=0&&e<=0&&e==r[n+1]?r[n]+=t:t==0&&r[n]==0?r[n+1]+=e:i?(r[n]+=t,r[n+1]+=e):r.push(t,e)}function Se(r,t,e){if(e.length==0)return;let i=t.length-2>>1;if(i<r.length)r[r.length-1]=r[r.length-1].append(e);else{for(;r.length<i;)r.push(G.empty);r.push(e)}}function qr(r,t,e){let i=r.inserted;for(let n=0,s=0,o=0;o<r.sections.length;){let l=r.sections[o++],h=r.sections[o++];if(h<0)n+=l,s+=l;else{let a=n,f=s,u=G.empty;for(;a+=l,f+=h,h&&i&&(u=u.append(i[o-2>>1])),!(e||o==r.sections.length||r.sections[o+1]<0);)l=r.sections[o++],h=r.sections[o++];t(n,a,s,f,u),n=a,s=f}}}function Kr(r,t,e,i=!1){let n=[],s=i?[]:null,o=new Bi(r),l=new Bi(t);for(let h=-1;;)if(o.ins==-1&&l.ins==-1){let a=Math.min(o.len,l.len);gt(n,a,-1),o.forward(a),l.forward(a)}else if(l.ins>=0&&(o.ins<0||h==o.i||o.off==0&&(l.len<o.len||l.len==o.len&&!e))){let a=l.len;for(gt(n,l.ins,-1);a;){let f=Math.min(o.len,a);o.ins>=0&&h<o.i&&o.len<=f&&(gt(n,0,o.ins),s&&Se(s,n,o.text),h=o.i),o.forward(f),a-=f}l.next()}else if(o.ins>=0){let a=0,f=o.len;for(;f;)if(l.ins==-1){let u=Math.min(f,l.len);a+=u,f-=u,l.forward(u)}else if(l.ins==0&&l.len<f)f-=l.len,l.next();else break;gt(n,a,h<o.i?o.ins:0),s&&h<o.i&&Se(s,n,o.text),h=o.i,o.forward(o.len-f)}else{if(o.done&&l.done)return s?at.createSet(n,s):Xt.create(n);throw new Error("Mismatched change set lengths")}}function Yl(r,t,e=!1){let i=[],n=e?[]:null,s=new Bi(r),o=new Bi(t);for(let l=!1;;){if(s.done&&o.done)return n?at.createSet(i,n):Xt.create(i);if(s.ins==0)gt(i,s.len,0,l),s.next();else if(o.len==0&&!o.done)gt(i,0,o.ins,l),n&&Se(n,i,o.text),o.next();else{if(s.done||o.done)throw new Error("Mismatched change set lengths");{let h=Math.min(s.len2,o.len),a=i.length;if(s.ins==-1){let f=o.ins==-1?-1:o.off?0:o.ins;gt(i,h,f,l),n&&f&&Se(n,i,o.text)}else o.ins==-1?(gt(i,s.off?0:s.len,h,l),n&&Se(n,i,s.textBit(h))):(gt(i,s.off?0:s.len,o.off?0:o.ins,l),n&&!o.off&&Se(n,i,o.text));l=(s.ins>h||o.ins>=0&&o.len>h)&&(l||i.length>a),s.forward2(h),o.forward(h)}}}}class Bi{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?G.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?G.empty:e[i].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class Ve{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let t=this.flags&3;return t==3?null:t}get goalColumn(){let t=this.flags>>5;return t==33554431?void 0:t}map(t,e=-1){let i,n;return this.empty?i=n=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),n=t.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new Ve(i,n,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return O.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return O.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return O.range(t.anchor,t.head)}static create(t,e,i){return new Ve(t,e,i)}}class O{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:O.create(this.ranges.map(i=>i.map(t,e)),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new O([this.main],0)}addRange(t,e=!0){return O.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,O.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new O(t.ranges.map(e=>Ve.fromJSON(e)),t.main)}static single(t,e=t){return new O([O.range(t,e)],0)}static create(t,e=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<t.length;n++){let s=t[n];if(s.empty?s.from<=i:s.from<i)return O.normalized(t.slice(),e);i=s.to}return new O(t,e)}static cursor(t,e=0,i,n){return Ve.create(t,t,(e==0?0:e<0?4:8)|(i==null?3:Math.min(2,i))|(n!=null?n:33554431)<<5)}static range(t,e,i){let n=(i!=null?i:33554431)<<5;return e<t?Ve.create(e,t,16|n|8):Ve.create(t,e,n|(e>t?4:0))}static normalized(t,e=0){let i=t[e];t.sort((n,s)=>n.from-s.from),e=t.indexOf(i);for(let n=1;n<t.length;n++){let s=t[n],o=t[n-1];if(s.empty?s.from<=o.to:s.from<o.to){let l=o.from,h=Math.max(s.to,o.to);n<=e&&e--,t.splice(--n,2,s.anchor>s.head?O.range(h,l):O.range(l,h))}}return new O(t,e)}}function Ql(r,t){for(let e of r.ranges)if(e.to>t)throw new RangeError("Selection points outside of document")}let Ts=0;class P{constructor(t,e,i,n,s){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=n,this.id=Ts++,this.default=t([]),this.extensions=typeof s=="function"?s(this):s}static define(t={}){return new P(t.combine||(e=>e),t.compareInput||((e,i)=>e===i),t.compare||(t.combine?(e,i)=>e===i:_s),!!t.static,t.enables)}of(t){return new cn([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new cn(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new cn(t,this,2,e)}from(t,e){return e||(e=i=>i),this.compute([t],i=>e(i.field(t)))}}function _s(r,t){return r==t||r.length==t.length&&r.every((e,i)=>e===t[i])}class cn{constructor(t,e,i,n){this.dependencies=t,this.facet=e,this.type=i,this.value=n,this.id=Ts++}dynamicSlot(t){var e;let i=this.value,n=this.facet.compareInput,s=this.id,o=t[s]>>1,l=this.type==2,h=!1,a=!1,f=[];for(let u of this.dependencies)u=="doc"?h=!0:u=="selection"?a=!0:(((e=t[u.id])!==null&&e!==void 0?e:1)&1)==0&&f.push(t[u.id]);return{create(u){return u.values[o]=i(u),1},update(u,c){if(h&&c.docChanged||a&&(c.docChanged||c.selection)||Yr(u,f)){let d=i(u);if(l?!uo(d,u.values[o],n):!n(d,u.values[o]))return u.values[o]=d,1}return 0},reconfigure:(u,c)=>{let d=i(u),p=c.config.address[s];if(p!=null){let x=Cn(c,p);if(this.dependencies.every(S=>S instanceof P?c.facet(S)===u.facet(S):S instanceof Rt?c.field(S,!1)==u.field(S,!1):!0)||(l?uo(d,x,n):n(d,x)))return u.values[o]=x,0}return u.values[o]=d,1}}}}function uo(r,t,e){if(r.length!=t.length)return!1;for(let i=0;i<r.length;i++)if(!e(r[i],t[i]))return!1;return!0}function Yr(r,t){let e=!1;for(let i of t)Ti(r,i)&1&&(e=!0);return e}function Nf(r,t,e){let i=e.map(h=>r[h.id]),n=e.map(h=>h.type),s=i.filter(h=>!(h&1)),o=r[t.id]>>1;function l(h){let a=[];for(let f=0;f<i.length;f++){let u=Cn(h,i[f]);if(n[f]==2)for(let c of u)a.push(c);else a.push(u)}return t.combine(a)}return{create(h){for(let a of i)Ti(h,a);return h.values[o]=l(h),1},update(h,a){if(!Yr(h,s))return 0;let f=l(h);return t.compare(f,h.values[o])?0:(h.values[o]=f,1)},reconfigure(h,a){let f=Yr(h,i),u=a.config.facets[t.id],c=a.facet(t);if(u&&!f&&_s(e,u))return h.values[o]=c,0;let d=l(h);return t.compare(d,c)?(h.values[o]=c,0):(h.values[o]=d,1)}}}const co=P.define({static:!0});class Rt{constructor(t,e,i,n,s){this.id=t,this.createF=e,this.updateF=i,this.compareF=n,this.spec=s,this.provides=void 0}static define(t){let e=new Rt(Ts++,t.create,t.update,t.compare||((i,n)=>i===n),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(co).find(i=>i.field==this);return((e==null?void 0:e.create)||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:i=>(i.values[e]=this.create(i),1),update:(i,n)=>{let s=i.values[e],o=this.updateF(s,n);return this.compareF(s,o)?0:(i.values[e]=o,1)},reconfigure:(i,n)=>n.config.address[this.id]!=null?(i.values[e]=n.field(this),0):(i.values[e]=this.create(i),1)}}init(t){return[this,co.of({field:this,create:t})]}get extension(){return this}}const Ie={lowest:4,low:3,default:2,high:1,highest:0};function pi(r){return t=>new Xl(t,r)}const Jl={highest:pi(Ie.highest),high:pi(Ie.high),default:pi(Ie.default),low:pi(Ie.low),lowest:pi(Ie.lowest)};class Xl{constructor(t,e){this.inner=t,this.prec=e}}class nr{of(t){return new Qr(this,t)}reconfigure(t){return nr.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class Qr{constructor(t,e){this.compartment=t,this.inner=e}}class An{constructor(t,e,i,n,s,o){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=n,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let n=[],s=Object.create(null),o=new Map;for(let c of Rf(t,e,o))c instanceof Rt?n.push(c):(s[c.facet.id]||(s[c.facet.id]=[])).push(c);let l=Object.create(null),h=[],a=[];for(let c of n)l[c.id]=a.length<<1,a.push(d=>c.slot(d));let f=i==null?void 0:i.config.facets;for(let c in s){let d=s[c],p=d[0].facet,x=f&&f[c]||[];if(d.every(S=>S.type==0))if(l[p.id]=h.length<<1|1,_s(x,d))h.push(i.facet(p));else{let S=p.combine(d.map(k=>k.value));h.push(i&&p.compare(S,i.facet(p))?i.facet(p):S)}else{for(let S of d)S.type==0?(l[S.id]=h.length<<1|1,h.push(S.value)):(l[S.id]=a.length<<1,a.push(k=>S.dynamicSlot(k)));l[p.id]=a.length<<1,a.push(S=>Nf(S,p,d))}}let u=a.map(c=>c(l));return new An(t,o,u,l,h,s)}}function Rf(r,t,e){let i=[[],[],[],[],[]],n=new Map;function s(o,l){let h=n.get(o);if(h!=null){if(h<=l)return;let a=i[h].indexOf(o);a>-1&&i[h].splice(a,1),o instanceof Qr&&e.delete(o.compartment)}if(n.set(o,l),Array.isArray(o))for(let a of o)s(a,l);else if(o instanceof Qr){if(e.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let a=t.get(o.compartment)||o.inner;e.set(o.compartment,a),s(a,l)}else if(o instanceof Xl)s(o.inner,o.prec);else if(o instanceof Rt)i[l].push(o),o.provides&&s(o.provides,l);else if(o instanceof cn)i[l].push(o),o.facet.extensions&&s(o.facet.extensions,Ie.default);else{let a=o.extension;if(!a)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(a,l)}}return s(r,Ie.default),i.reduce((o,l)=>o.concat(l))}function Ti(r,t){if(t&1)return 2;let e=t>>1,i=r.status[e];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;r.status[e]=4;let n=r.computeSlot(r,r.config.dynamicSlots[e]);return r.status[e]=2|n}function Cn(r,t){return t&1?r.config.staticValues[t>>1]:r.values[t>>1]}const Zl=P.define(),th=P.define({combine:r=>r.some(t=>t),static:!0}),eh=P.define({combine:r=>r.length?r[0]:void 0,static:!0}),ih=P.define(),nh=P.define(),rh=P.define(),sh=P.define({combine:r=>r.length?r[0]:!1});class $e{constructor(t,e){this.type=t,this.value=e}static define(){return new If}}class If{of(t){return new $e(this,t)}}class Ef{constructor(t){this.map=t}of(t){return new J(this,t)}}class J{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return e===void 0?void 0:e==this.value?this:new J(this.type,e)}is(t){return this.type==t}static define(t={}){return new Ef(t.map||(e=>e))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let n of t){let s=n.map(e);s&&i.push(s)}return i}}J.reconfigure=J.define();J.appendConfig=J.define();class ft{constructor(t,e,i,n,s,o){this.startState=t,this.changes=e,this.selection=i,this.effects=n,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,i&&Ql(i,e.newLength),s.some(l=>l.type==ft.time)||(this.annotations=s.concat(ft.time.of(Date.now())))}static create(t,e,i,n,s,o){return new ft(t,e,i,n,s,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(ft.userEvent);return!!(e&&(e==t||e.length>t.length&&e.slice(0,t.length)==t&&e[t.length]=="."))}}ft.time=$e.define();ft.userEvent=$e.define();ft.addToHistory=$e.define();ft.remote=$e.define();function zf(r,t){let e=[];for(let i=0,n=0;;){let s,o;if(i<r.length&&(n==t.length||t[n]>=r[i]))s=r[i++],o=r[i++];else if(n<t.length)s=t[n++],o=t[n++];else return e;!e.length||e[e.length-1]<s?e.push(s,o):e[e.length-1]<o&&(e[e.length-1]=o)}}function oh(r,t,e){var i;let n,s,o;return e?(n=t.changes,s=at.empty(t.changes.length),o=r.changes.compose(t.changes)):(n=t.changes.map(r.changes),s=r.changes.mapDesc(t.changes,!0),o=r.changes.compose(n)),{changes:o,selection:t.selection?t.selection.map(s):(i=r.selection)===null||i===void 0?void 0:i.map(n),effects:J.mapEffects(r.effects,n).concat(J.mapEffects(t.effects,s)),annotations:r.annotations.length?r.annotations.concat(t.annotations):t.annotations,scrollIntoView:r.scrollIntoView||t.scrollIntoView}}function Jr(r,t,e){let i=t.selection,n=Ze(t.annotations);return t.userEvent&&(n=n.concat(ft.userEvent.of(t.userEvent))),{changes:t.changes instanceof at?t.changes:at.of(t.changes||[],e,r.facet(eh)),selection:i&&(i instanceof O?i:O.single(i.anchor,i.head)),effects:Ze(t.effects),annotations:n,scrollIntoView:!!t.scrollIntoView}}function lh(r,t,e){let i=Jr(r,t.length?t[0]:{},r.doc.length);t.length&&t[0].filter===!1&&(e=!1);for(let s=1;s<t.length;s++){t[s].filter===!1&&(e=!1);let o=!!t[s].sequential;i=oh(i,Jr(r,t[s],o?i.changes.newLength:r.doc.length),o)}let n=ft.create(r,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return Ff(e?Vf(n):n)}function Vf(r){let t=r.startState,e=!0;for(let n of t.facet(ih)){let s=n(r);if(s===!1){e=!1;break}Array.isArray(s)&&(e=e===!0?s:zf(e,s))}if(e!==!0){let n,s;if(e===!1)s=r.changes.invertedDesc,n=at.empty(t.doc.length);else{let o=r.changes.filter(e);n=o.changes,s=o.filtered.mapDesc(o.changes).invertedDesc}r=ft.create(t,n,r.selection&&r.selection.map(s),J.mapEffects(r.effects,s),r.annotations,r.scrollIntoView)}let i=t.facet(nh);for(let n=i.length-1;n>=0;n--){let s=i[n](r);s instanceof ft?r=s:Array.isArray(s)&&s.length==1&&s[0]instanceof ft?r=s[0]:r=lh(t,Ze(s),!1)}return r}function Ff(r){let t=r.startState,e=t.facet(rh),i=r;for(let n=e.length-1;n>=0;n--){let s=e[n](r);s&&Object.keys(s).length&&(i=oh(r,Jr(t,s,r.changes.newLength),!0))}return i==r?r:ft.create(t,r.changes,r.selection,i.effects,i.annotations,i.scrollIntoView)}const Hf=[];function Ze(r){return r==null?Hf:Array.isArray(r)?r:[r]}var fe=function(r){return r[r.Word=0]="Word",r[r.Space=1]="Space",r[r.Other=2]="Other",r}(fe||(fe={}));const Uf=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Xr;try{Xr=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function Wf(r){if(Xr)return Xr.test(r);for(let t=0;t<r.length;t++){let e=r[t];if(/\w/.test(e)||e>"\x80"&&(e.toUpperCase()!=e.toLowerCase()||Uf.test(e)))return!0}return!1}function $f(r){return t=>{if(!/\S/.test(t))return fe.Space;if(Wf(t))return fe.Word;for(let e=0;e<r.length;e++)if(t.indexOf(r[e])>-1)return fe.Word;return fe.Other}}class j{constructor(t,e,i,n,s,o){this.config=t,this.doc=e,this.selection=i,this.values=n,this.status=t.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)Ti(this,l<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(i==null){if(e)throw new RangeError("Field is not present in this state");return}return Ti(this,i),Cn(this,i)}update(...t){return lh(this,t,!0)}applyTransaction(t){let e=this.config,{base:i,compartments:n}=e;for(let o of t.effects)o.is(nr.reconfigure)?(e&&(n=new Map,e.compartments.forEach((l,h)=>n.set(h,l)),e=null),n.set(o.value.compartment,o.value.extension)):o.is(J.reconfigure)?(e=null,i=o.value):o.is(J.appendConfig)&&(e=null,i=Ze(i).concat(o.value));let s;e?s=t.startState.values.slice():(e=An.resolve(i,n,this),s=new j(e,this.doc,this.selection,e.dynamicSlots.map(()=>null),(l,h)=>h.reconfigure(l,this),null).values),new j(e,t.newDoc,t.newSelection,s,(o,l)=>l.update(o,t),t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:O.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),n=this.changes(i.changes),s=[i.range],o=Ze(i.effects);for(let l=1;l<e.ranges.length;l++){let h=t(e.ranges[l]),a=this.changes(h.changes),f=a.map(n);for(let c=0;c<l;c++)s[c]=s[c].map(f);let u=n.mapDesc(a,!0);s.push(h.range.map(u)),n=n.compose(f),o=J.mapEffects(o,f).concat(J.mapEffects(Ze(h.effects),u))}return{changes:n,selection:O.create(s,e.mainIndex),effects:o}}changes(t=[]){return t instanceof at?t:at.of(t,this.doc.length,this.facet(j.lineSeparator))}toText(t){return G.of(t.split(this.facet(j.lineSeparator)||Gr))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return e==null?t.default:(Ti(this,e),Cn(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let n=t[i];n instanceof Rt&&this.config.address[n.id]!=null&&(e[i]=n.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i){for(let s in i)if(Object.prototype.hasOwnProperty.call(t,s)){let o=i[s],l=t[s];n.push(o.init(h=>o.spec.fromJSON(l,h)))}}return j.create({doc:t.doc,selection:O.fromJSON(t.selection),extensions:e.extensions?n.concat([e.extensions]):n})}static create(t={}){let e=An.resolve(t.extensions||[],new Map),i=t.doc instanceof G?t.doc:G.of((t.doc||"").split(e.staticFacet(j.lineSeparator)||Gr)),n=t.selection?t.selection instanceof O?t.selection:O.single(t.selection.anchor,t.selection.head):O.single(0);return Ql(n,i.length),e.staticFacet(th)||(n=n.asSingle()),new j(e,i,n,e.dynamicSlots.map(()=>null),(s,o)=>o.create(s),null)}get tabSize(){return this.facet(j.tabSize)}get lineBreak(){return this.facet(j.lineSeparator)||`
`}get readOnly(){return this.facet(sh)}phrase(t,...e){for(let i of this.facet(j.phrases))if(Object.prototype.hasOwnProperty.call(i,t)){t=i[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,(i,n)=>{if(n=="$")return"$";let s=+(n||1);return!s||s>e.length?i:e[s-1]})),t}languageDataAt(t,e,i=-1){let n=[];for(let s of this.facet(Zl))for(let o of s(this,e,i))Object.prototype.hasOwnProperty.call(o,t)&&n.push(o[t]);return n}charCategorizer(t){return $f(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:n}=this.doc.lineAt(t),s=this.charCategorizer(t),o=t-i,l=t-i;for(;o>0;){let h=Bt(e,o,!1);if(s(e.slice(h,o))!=fe.Word)break;o=h}for(;l<n;){let h=Bt(e,l);if(s(e.slice(l,h))!=fe.Word)break;l=h}return o==l?null:O.range(o+i,l+i)}}j.allowMultipleSelections=th;j.tabSize=P.define({combine:r=>r.length?r[0]:4});j.lineSeparator=eh;j.readOnly=sh;j.phrases=P.define({compare(r,t){let e=Object.keys(r),i=Object.keys(t);return e.length==i.length&&e.every(n=>r[n]==t[n])}});j.languageData=Zl;j.changeFilter=ih;j.transactionFilter=nh;j.transactionExtender=rh;nr.reconfigure=J.define();function rr(r,t,e={}){let i={};for(let n of r)for(let s of Object.keys(n)){let o=n[s],l=i[s];if(l===void 0)i[s]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(e,s))i[s]=e[s](l,o);else throw new Error("Config merge conflict for field "+s)}for(let n in t)i[n]===void 0&&(i[n]=t[n]);return i}class ei{eq(t){return this==t}range(t,e=t){return Pi.create(t,e,this)}}ei.prototype.startSide=ei.prototype.endSide=0;ei.prototype.point=!1;ei.prototype.mapMode=Ct.TrackDel;class Pi{constructor(t,e,i){this.from=t,this.to=e,this.value=i}static create(t,e,i){return new Pi(t,e,i)}}function Zr(r,t){return r.from-t.from||r.value.startSide-t.value.startSide}class Ls{constructor(t,e,i,n){this.from=t,this.to=e,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,n=0){let s=i?this.to:this.from;for(let o=n,l=s.length;;){if(o==l)return o;let h=o+l>>1,a=s[h]-t||(i?this.value[h].endSide:this.value[h].startSide)-e;if(h==o)return a>=0?o:l;a>=0?l=h:o=h+1}}between(t,e,i,n){for(let s=this.findIndex(e,-1e9,!0),o=this.findIndex(i,1e9,!1,s);s<o;s++)if(n(this.from[s]+t,this.to[s]+t,this.value[s])===!1)return!1}map(t,e){let i=[],n=[],s=[],o=-1,l=-1;for(let h=0;h<this.value.length;h++){let a=this.value[h],f=this.from[h]+t,u=this.to[h]+t,c,d;if(f==u){let p=e.mapPos(f,a.startSide,a.mapMode);if(p==null||(c=d=p,a.startSide!=a.endSide&&(d=e.mapPos(f,a.endSide),d<c)))continue}else if(c=e.mapPos(f,a.startSide),d=e.mapPos(u,a.endSide),c>d||c==d&&a.startSide>0&&a.endSide<=0)continue;(d-c||a.endSide-a.startSide)<0||(o<0&&(o=c),a.point&&(l=Math.max(l,d-c)),i.push(a),n.push(c-o),s.push(d-o))}return{mapped:i.length?new Ls(n,s,i,l):null,pos:o}}}class q{constructor(t,e,i,n){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=n}static create(t,e,i,n){return new q(t,e,i,n)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:n=0,filterTo:s=this.length}=t,o=t.filter;if(e.length==0&&!o)return this;if(i&&(e=e.slice().sort(Zr)),this.isEmpty)return e.length?q.of(e):this;let l=new hh(this,null,-1).goto(0),h=0,a=[],f=new On;for(;l.value||h<e.length;)if(h<e.length&&(l.from-e[h].from||l.startSide-e[h].value.startSide)>=0){let u=e[h++];f.addInner(u.from,u.to,u.value)||a.push(u)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(l.chunkIndex)<e[h].from)&&(!o||n>this.chunkEnd(l.chunkIndex)||s<this.chunkPos[l.chunkIndex])&&f.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||n>l.to||s<l.from||o(l.from,l.to,l.value))&&(f.addInner(l.from,l.to,l.value)||a.push(Pi.create(l.from,l.to,l.value))),l.next());return f.finishInner(this.nextLayer.isEmpty&&!a.length?q.empty:this.nextLayer.update({add:a,filter:o,filterFrom:n,filterTo:s}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],n=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],h=this.chunk[o],a=t.touchesRange(l,l+h.length);if(a===!1)n=Math.max(n,h.maxPoint),e.push(h),i.push(t.mapPos(l));else if(a===!0){let{mapped:f,pos:u}=h.map(l,t);f&&(n=Math.max(n,f.maxPoint),e.push(f),i.push(u))}}let s=this.nextLayer.map(t);return e.length==0?s:new q(i,e,s||q.empty,n)}between(t,e,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let s=this.chunkPos[n],o=this.chunk[n];if(e>=s&&t<=s+o.length&&o.between(s,t-s,e-s,i)===!1)return}this.nextLayer.between(t,e,i)}}iter(t=0){return Di.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return Di.from(t).goto(e)}static compare(t,e,i,n,s=-1){let o=t.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=s),l=e.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=s),h=po(o,l,i),a=new gi(o,h,s),f=new gi(l,h,s);i.iterGaps((u,c,d)=>go(a,u,f,c,d,n)),i.empty&&i.length==0&&go(a,0,f,0,0,n)}static eq(t,e,i=0,n){n==null&&(n=1e9);let s=t.filter(f=>!f.isEmpty&&e.indexOf(f)<0),o=e.filter(f=>!f.isEmpty&&t.indexOf(f)<0);if(s.length!=o.length)return!1;if(!s.length)return!0;let l=po(s,o),h=new gi(s,l,0).goto(i),a=new gi(o,l,0).goto(i);for(;;){if(h.to!=a.to||!ts(h.active,a.active)||h.point&&(!a.point||!h.point.eq(a.point)))return!1;if(h.to>n)return!0;h.next(),a.next()}}static spans(t,e,i,n,s=-1){let o=new gi(t,null,s).goto(e),l=e,h=o.openStart;for(;;){let a=Math.min(o.to,i);if(o.point?(n.point(l,a,o.point,o.activeForPoint(o.to),h,o.pointRank),h=o.openEnd(a)+(o.to>a?1:0)):a>l&&(n.span(l,a,o.active,h),h=o.openEnd(a)),o.to>i)break;l=o.to,o.next()}return h}static of(t,e=!1){let i=new On;for(let n of t instanceof Pi?[t]:e?jf(t):t)i.add(n.from,n.to,n.value);return i.finish()}}q.empty=new q([],[],null,-1);function jf(r){if(r.length>1)for(let t=r[0],e=1;e<r.length;e++){let i=r[e];if(Zr(t,i)>0)return r.slice().sort(Zr);t=i}return r}q.empty.nextLayer=q.empty;class On{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new Ls(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new On)).add(t,e,i)}addInner(t,e,i){let n=t-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(q.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let e=q.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function po(r,t,e){let i=new Map;for(let s of r)for(let o=0;o<s.chunk.length;o++)s.chunk[o].maxPoint<=0&&i.set(s.chunk[o],s.chunkPos[o]);let n=new Set;for(let s of t)for(let o=0;o<s.chunk.length;o++){let l=i.get(s.chunk[o]);l!=null&&(e?e.mapPos(l):l)==s.chunkPos[o]&&!(e!=null&&e.touchesRange(l,l+s.chunk[o].length))&&n.add(s.chunk[o])}return n}class hh{constructor(t,e,i,n=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<t||n.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class Di{constructor(t){this.heap=t}static from(t,e=null,i=-1){let n=[];for(let s=0;s<t.length;s++)for(let o=t[s];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&n.push(new hh(o,e,i,s));return n.length==1?n[0]:new Di(n)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let i=this.heap.length>>1;i>=0;i--)wr(this.heap,i);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let i=this.heap.length>>1;i>=0;i--)wr(this.heap,i);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),wr(this.heap,0)}}}function wr(r,t){for(let e=r[t];;){let i=(t<<1)+1;if(i>=r.length)break;let n=r[i];if(i+1<r.length&&n.compare(r[i+1])>=0&&(n=r[i+1],i++),e.compare(n)<0)break;r[i]=e,r[t]=n,t=i}}class gi{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Di.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){Hi(this.active,t),Hi(this.activeTo,t),Hi(this.activeRank,t),this.minActive=mo(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:n,rank:s}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=s;)e++;Ui(this.active,e,i),Ui(this.activeTo,e,n),Ui(this.activeRank,e,s),t&&Ui(t,e,this.cursor.from),this.minActive=mo(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null,n=0;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>t){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&Hi(i,s)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(i),this.cursor.from<t&&this.cursor.to>t&&n++,this.cursor.next();else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.from<t&&(n=1),this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){let s=0;for(;s<i.length&&i[s]<t;)s++;this.openStart=s+n}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}}function go(r,t,e,i,n,s){r.goto(t),e.goto(i);let o=i+n,l=i,h=i-t;for(;;){let a=r.to+h-e.to||r.endSide-e.endSide,f=a<0?r.to+h:e.to,u=Math.min(f,o);if(r.point||e.point?r.point&&e.point&&(r.point==e.point||r.point.eq(e.point))&&ts(r.activeForPoint(r.to+h),e.activeForPoint(e.to))||s.comparePoint(l,u,r.point,e.point):u>l&&!ts(r.active,e.active)&&s.compareRange(l,u,r.active,e.active),f>o)break;l=f,a<=0&&r.next(),a>=0&&e.next()}}function ts(r,t){if(r.length!=t.length)return!1;for(let e=0;e<r.length;e++)if(r[e]!=t[e]&&!r[e].eq(t[e]))return!1;return!0}function Hi(r,t){for(let e=t,i=r.length-1;e<i;e++)r[e]=r[e+1];r.pop()}function Ui(r,t,e){for(let i=r.length-1;i>=t;i--)r[i+1]=r[i];r[t]=e}function mo(r,t){let e=-1,i=1e9;for(let n=0;n<t.length;n++)(t[n]-i||r[n].endSide-r[e].endSide)<0&&(e=n,i=t[n]);return e}function Ms(r,t,e=r.length){let i=0;for(let n=0;n<e;)r.charCodeAt(n)==9?(i+=t-i%t,n++):(i++,n=Bt(r,n));return i}function Gf(r,t,e,i){for(let n=0,s=0;;){if(s>=t)return n;if(n==r.length)break;s+=r.charCodeAt(n)==9?e-s%e:1,n=Bt(r,n)}return i===!0?-1:r.length}const es="\u037C",bo=typeof Symbol>"u"?"__"+es:Symbol.for(es),is=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),yo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class ii{constructor(t,e){this.rules=[];let{finish:i}=e||{};function n(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function s(o,l,h,a){let f=[],u=/^@(\w+)\b/.exec(o[0]),c=u&&u[1]=="keyframes";if(u&&l==null)return h.push(o[0]+";");for(let d in l){let p=l[d];if(/&/.test(d))s(d.split(/,\s*/).map(x=>o.map(S=>x.replace(/&/,S))).reduce((x,S)=>x.concat(S)),p,h);else if(p&&typeof p=="object"){if(!u)throw new RangeError("The value of a property ("+d+") should be a primitive value.");s(n(d),p,f,c)}else p!=null&&f.push(d.replace(/_.*/,"").replace(/[A-Z]/g,x=>"-"+x.toLowerCase())+": "+p+";")}(f.length||c)&&h.push((i&&!u&&!a?o.map(i):o).join(", ")+" {"+f.join(" ")+"}")}for(let o in t)s(n(o),t[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let t=yo[bo]||1;return yo[bo]=t+1,es+t.toString(36)}static mount(t,e){(t[is]||new qf(t)).mount(Array.isArray(e)?e:[e])}}let Wi=null;class qf{constructor(t){if(!t.head&&t.adoptedStyleSheets&&typeof CSSStyleSheet<"u"){if(Wi)return t.adoptedStyleSheets=[Wi.sheet].concat(t.adoptedStyleSheets),t[is]=Wi;this.sheet=new CSSStyleSheet,t.adoptedStyleSheets=[this.sheet].concat(t.adoptedStyleSheets),Wi=this}else{this.styleTag=(t.ownerDocument||t).createElement("style");let e=t.head||t;e.insertBefore(this.styleTag,e.firstChild)}this.modules=[],t[is]=this}mount(t){let e=this.sheet,i=0,n=0;for(let s=0;s<t.length;s++){let o=t[s],l=this.modules.indexOf(o);if(l<n&&l>-1&&(this.modules.splice(l,1),n--,l=-1),l==-1){if(this.modules.splice(n++,0,o),e)for(let h=0;h<o.rules.length;h++)e.insertRule(o.rules[h],i++)}else{for(;n<l;)i+=this.modules[n++].rules.length;i+=o.rules.length,n++}}if(!e){let s="";for(let o=0;o<this.modules.length;o++)s+=this.modules[o].getRules()+`
`;this.styleTag.textContent=s}}}var Be={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Ni={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},wo=typeof navigator<"u"&&/Chrome\/(\d+)/.exec(navigator.userAgent);typeof navigator<"u"&&/Gecko\/\d+/.test(navigator.userAgent);var Kf=typeof navigator<"u"&&/Mac/.test(navigator.platform),Yf=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Qf=Kf||wo&&+wo[1]<57;for(var pt=0;pt<10;pt++)Be[48+pt]=Be[96+pt]=String(pt);for(var pt=1;pt<=24;pt++)Be[pt+111]="F"+pt;for(var pt=65;pt<=90;pt++)Be[pt]=String.fromCharCode(pt+32),Ni[pt]=String.fromCharCode(pt);for(var xr in Be)Ni.hasOwnProperty(xr)||(Ni[xr]=Be[xr]);function Jf(r){var t=Qf&&(r.ctrlKey||r.altKey||r.metaKey)||Yf&&r.shiftKey&&r.key&&r.key.length==1||r.key=="Unidentified",e=!t&&r.key||(r.shiftKey?Ni:Be)[r.keyCode]||r.key||"Unidentified";return e=="Esc"&&(e="Escape"),e=="Del"&&(e="Delete"),e=="Left"&&(e="ArrowLeft"),e=="Up"&&(e="ArrowUp"),e=="Right"&&(e="ArrowRight"),e=="Down"&&(e="ArrowDown"),e}function Tn(r){let t;return r.nodeType==11?t=r.getSelection?r:r.ownerDocument:t=r,t.getSelection()}function ni(r,t){return t?r==t||r.contains(t.nodeType!=1?t.parentNode:t):!1}function Xf(r){let t=r.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function dn(r,t){if(!t.anchorNode)return!1;try{return ni(r,t.anchorNode)}catch{return!1}}function Ri(r){return r.nodeType==3?ri(r,0,r.nodeValue.length).getClientRects():r.nodeType==1?r.getClientRects():[]}function _n(r,t,e,i){return e?xo(r,t,e,i,-1)||xo(r,t,e,i,1):!1}function Ln(r){for(var t=0;;t++)if(r=r.previousSibling,!r)return t}function xo(r,t,e,i,n){for(;;){if(r==e&&t==i)return!0;if(t==(n<0?0:Ii(r))){if(r.nodeName=="DIV")return!1;let s=r.parentNode;if(!s||s.nodeType!=1)return!1;t=Ln(r)+(n<0?0:1),r=s}else if(r.nodeType==1){if(r=r.childNodes[t+(n<0?-1:0)],r.nodeType==1&&r.contentEditable=="false")return!1;t=n<0?Ii(r):0}else return!1}}function Ii(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}const ah={left:0,right:0,top:0,bottom:0};function sr(r,t){let e=t?r.left:r.right;return{left:e,right:e,top:r.top,bottom:r.bottom}}function Zf(r){return{left:0,right:r.innerWidth,top:0,bottom:r.innerHeight}}function tu(r,t,e,i,n,s,o,l){let h=r.ownerDocument,a=h.defaultView;for(let f=r;f;)if(f.nodeType==1){let u,c=f==h.body;if(c)u=Zf(a);else{if(f.scrollHeight<=f.clientHeight&&f.scrollWidth<=f.clientWidth){f=f.parentNode;continue}let x=f.getBoundingClientRect();u={left:x.left,right:x.left+f.clientWidth,top:x.top,bottom:x.top+f.clientHeight}}let d=0,p=0;if(n=="nearest")t.top<u.top?(p=-(u.top-t.top+o),e>0&&t.bottom>u.bottom+p&&(p=t.bottom-u.bottom+p+o)):t.bottom>u.bottom&&(p=t.bottom-u.bottom+o,e<0&&t.top-p<u.top&&(p=-(u.top+p-t.top+o)));else{let x=t.bottom-t.top,S=u.bottom-u.top;p=(n=="center"&&x<=S?t.top+x/2-S/2:n=="start"||n=="center"&&e<0?t.top-o:t.bottom-S+o)-u.top}if(i=="nearest"?t.left<u.left?(d=-(u.left-t.left+s),e>0&&t.right>u.right+d&&(d=t.right-u.right+d+s)):t.right>u.right&&(d=t.right-u.right+s,e<0&&t.left<u.left+d&&(d=-(u.left+d-t.left+s))):d=(i=="center"?t.left+(t.right-t.left)/2-(u.right-u.left)/2:i=="start"==l?t.left-s:t.right-(u.right-u.left)+s)-u.left,d||p)if(c)a.scrollBy(d,p);else{if(p){let x=f.scrollTop;f.scrollTop+=p,p=f.scrollTop-x}if(d){let x=f.scrollLeft;f.scrollLeft+=d,d=f.scrollLeft-x}t={left:t.left-d,top:t.top-p,right:t.right-d,bottom:t.bottom-p}}if(c)break;f=f.assignedSlot||f.parentNode,i=n="nearest"}else if(f.nodeType==11)f=f.host;else break}class eu{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}}let Ye=null;function fh(r){if(r.setActive)return r.setActive();if(Ye)return r.focus(Ye);let t=[];for(let e=r;e&&(t.push(e,e.scrollTop,e.scrollLeft),e!=e.ownerDocument);e=e.parentNode);if(r.focus(Ye==null?{get preventScroll(){return Ye={preventScroll:!0},!0}}:void 0),!Ye){Ye=!1;for(let e=0;e<t.length;){let i=t[e++],n=t[e++],s=t[e++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=s&&(i.scrollLeft=s)}}}let ko;function ri(r,t,e=t){let i=ko||(ko=document.createRange());return i.setEnd(r,e),i.setStart(r,t),i}function _i(r,t,e){let i={key:t,code:t,keyCode:e,which:e,cancelable:!0},n=new KeyboardEvent("keydown",i);n.synthetic=!0,r.dispatchEvent(n);let s=new KeyboardEvent("keyup",i);return s.synthetic=!0,r.dispatchEvent(s),n.defaultPrevented||s.defaultPrevented}function iu(r){for(;r;){if(r&&(r.nodeType==9||r.nodeType==11&&r.host))return r;r=r.assignedSlot||r.parentNode}return null}function uh(r){for(;r.attributes.length;)r.removeAttributeNode(r.attributes[0])}function nu(r,t){let e=t.focusNode,i=t.focusOffset;if(!e||t.anchorNode!=e||t.anchorOffset!=i)return!1;for(;;)if(i){if(e.nodeType!=1)return!1;let n=e.childNodes[i-1];n.contentEditable=="false"?i--:(e=n,i=Ii(e))}else{if(e==r)return!0;i=Ln(e),e=e.parentNode}}class yt{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new yt(t.parentNode,Ln(t),e)}static after(t,e){return new yt(t.parentNode,Ln(t)+1,e)}}const Bs=[];class Z{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(this.dirty&2){let e=this.dom,i=null,n;for(let s of this.children){if(s.dirty){if(!s.dom&&(n=i?i.nextSibling:e.firstChild)){let o=Z.get(n);(!o||!o.parent&&o.constructor==s.constructor)&&s.reuseDOM(n)}s.sync(t),s.dirty=0}if(n=i?i.nextSibling:e.firstChild,t&&!t.written&&t.node==e&&n!=s.dom&&(t.written=!0),s.dom.parentNode==e)for(;n&&n!=s.dom;)n=vo(n);else e.insertBefore(s.dom,n);i=s.dom}for(n=i?i.nextSibling:e.firstChild,n&&t&&t.node==e&&(t.written=!0);n;)n=vo(n)}else if(this.dirty&1)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=Ii(t)==0?0:e==0?-1:1;for(;;){let s=t.parentNode;if(s==this.dom)break;n==0&&s.firstChild!=s.lastChild&&(t==s.firstChild?n=-1:n=1),t=s}n<0?i=t:i=t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Z.get(i);)i=i.nextSibling;if(!i)return this.length;for(let n=0,s=0;;n++){let o=this.children[n];if(o.dom==i)return s;s+=o.length+o.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,s=-1,o=-1,l=-1;for(let h=0,a=i,f=i;h<this.children.length;h++){let u=this.children[h],c=a+u.length;if(a<t&&c>e)return u.domBoundsAround(t,e,a);if(c>=t&&n==-1&&(n=h,s=a),a>e&&u.dom.parentNode==this.dom){o=h,l=f;break}f=c,a=c+u.breakAfter}return{from:s,to:l<0?i+this.length:l,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),e.dirty&1)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Bs){this.markDirty();for(let n=t;n<e;n++){let s=this.children[n];s.parent==this&&s.destroy()}this.children.splice(t,e-t,...i);for(let n=0;n<i.length;n++)i[n].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new ch(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,s,o){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}}Z.prototype.breakAfter=0;function vo(r){let t=r.nextSibling;return r.parentNode.removeChild(r),t}class ch{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function dh(r,t,e,i,n,s,o,l,h){let{children:a}=r,f=a.length?a[t]:null,u=s.length?s[s.length-1]:null,c=u?u.breakAfter:o;if(!(t==i&&f&&!o&&!c&&s.length<2&&f.merge(e,n,s.length?u:null,e==0,l,h))){if(i<a.length){let d=a[i];d&&n<d.length?(t==i&&(d=d.split(n),n=0),!c&&u&&d.merge(0,n,u,!0,0,h)?s[s.length-1]=d:(n&&d.merge(0,n,null,!1,0,h),s.push(d))):d!=null&&d.breakAfter&&(u?u.breakAfter=1:o=1),i++}for(f&&(f.breakAfter=o,e>0&&(!o&&s.length&&f.merge(e,f.length,s[0],!1,l,0)?f.breakAfter=s.shift().breakAfter:(e<f.length||f.children.length&&f.children[f.children.length-1].length==0)&&f.merge(e,f.length,null,!1,l,0),t++));t<i&&s.length;)if(a[i-1].become(s[s.length-1]))i--,s.pop(),h=s.length?0:l;else if(a[t].become(s[0]))t++,s.shift(),l=s.length?0:h;else break;!s.length&&t&&i<a.length&&!a[t-1].breakAfter&&a[i].merge(0,0,a[t-1],!1,l,h)&&t--,(t<i||s.length)&&r.replaceChildren(t,i,s)}}function ph(r,t,e,i,n,s){let o=r.childCursor(),{i:l,off:h}=o.findPos(e,1),{i:a,off:f}=o.findPos(t,-1),u=t-e;for(let c of i)u+=c.length;r.length+=u,dh(r,a,f,l,h,i,0,n,s)}let Mt=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},ns=typeof document<"u"?document:{documentElement:{style:{}}};const rs=/Edge\/(\d+)/.exec(Mt.userAgent),gh=/MSIE \d/.test(Mt.userAgent),ss=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Mt.userAgent),or=!!(gh||ss||rs),So=!or&&/gecko\/(\d+)/i.test(Mt.userAgent),kr=!or&&/Chrome\/(\d+)/.exec(Mt.userAgent),Ao="webkitFontSmoothing"in ns.documentElement.style,mh=!or&&/Apple Computer/.test(Mt.vendor),Co=mh&&(/Mobile\/\w+/.test(Mt.userAgent)||Mt.maxTouchPoints>2);var M={mac:Co||/Mac/.test(Mt.platform),windows:/Win/.test(Mt.platform),linux:/Linux|X11/.test(Mt.platform),ie:or,ie_version:gh?ns.documentMode||6:ss?+ss[1]:rs?+rs[1]:0,gecko:So,gecko_version:So?+(/Firefox\/(\d+)/.exec(Mt.userAgent)||[0,0])[1]:0,chrome:!!kr,chrome_version:kr?+kr[1]:0,ios:Co,android:/Android\b/.test(Mt.userAgent),webkit:Ao,safari:mh,webkit_version:Ao?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:ns.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const ru=256;class Pe extends Z{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,e,i){return i&&(!(i instanceof Pe)||this.length-(e-t)+i.length>ru)?!1:(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new Pe(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new yt(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return os(this.dom,t,e)}}class ie extends Z{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let n of e)n.setParent(this)}setAttrs(t){if(uh(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,s,o){return i&&(!(i instanceof ie&&i.mark.eq(this.mark))||t&&s<=0||e<this.length&&o<=0)?!1:(ph(this,t,e,i?i.children:[],s-1,o-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,s=0;for(let l of this.children){let h=i+l.length;h>t&&e.push(i<t?l.split(t-i):l),n<0&&i>=t&&(n=s),i=h,s++}let o=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new ie(this.mark,e,o)}domAtPos(t){return wh(this,t)}coordsAt(t,e){return kh(this,t,e)}}function os(r,t,e){let i=r.nodeValue.length;t>i&&(t=i);let n=t,s=t,o=0;t==0&&e<0||t==i&&e>=0?M.chrome||M.gecko||(t?(n--,o=1):s<i&&(s++,o=-1)):e<0?n--:s<i&&s++;let l=ri(r,n,s).getClientRects();if(!l.length)return ah;let h=l[(o?o<0:e>=0)?0:l.length-1];return M.safari&&!o&&h.width==0&&(h=Array.prototype.find.call(l,a=>a.width)||h),o?sr(h,o<0):h||null}class Ae extends Z{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||Ae)(t,e,i)}split(t){let e=Ae.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,s,o){return i&&(!(i instanceof Ae)||!this.widget.compare(i.widget)||t>0&&s<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof Ae&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return G.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):G.empty}domAtPos(t){return t==0?yt.before(this.dom):yt.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return ah;for(let s=t>0?i.length-1:0;n=i[s],!(t>0?s==0:s==i.length-1||n.top<n.bottom);s+=t>0?-1:1);return t==0&&e>0||t==this.length&&e<=0?n:sr(n,t==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class bh extends Ae{domAtPos(t){let{topView:e,text:i}=this.widget;return e?ls(t,0,e,i,(n,s)=>n.domAtPos(s),n=>new yt(i,Math.min(n,i.nodeValue.length))):new yt(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:n}=this.widget;return i?yh(t,e,i,n):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:n}=this.widget;return i?ls(t,e,i,n,(s,o,l)=>s.coordsAt(o,l),(s,o)=>os(n,s,o)):os(n,t,e)}destroy(){var t;super.destroy(),(t=this.widget.topView)===null||t===void 0||t.destroy()}get isEditable(){return!0}}function ls(r,t,e,i,n,s){if(e instanceof ie){for(let o=e.dom.firstChild;o;o=o.nextSibling){let l=Z.get(o);if(!l)return s(r,t);let h=ni(o,i),a=l.length+(h?i.nodeValue.length:0);if(r<a||r==a&&l.getSide()<=0)return h?ls(r,t,l,i,n,s):n(l,r,t);r-=a}return n(e,e.length,-1)}else return e.dom==i?s(r,t):n(e,r,t)}function yh(r,t,e,i){if(e instanceof ie)for(let n of e.children){let s=0,o=ni(n.dom,i);if(ni(n.dom,r))return s+(o?yh(r,t,n,i):n.localPosFromDOM(r,t));s+=o?i.nodeValue.length:n.length}else if(e.dom==i)return Math.min(t,i.nodeValue.length);return e.localPosFromDOM(r,t)}class si extends Z{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof si&&t.side==this.side}split(){return new si(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return yt.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=su(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return G.empty}}Pe.prototype.children=Ae.prototype.children=si.prototype.children=Bs;function su(r,t){let e=r.parent,i=e?e.children.indexOf(r):-1;for(;e&&i>=0;)if(t<0?i>0:i<e.children.length){let n=e.children[i+t];if(n instanceof Pe){let s=n.coordsAt(t<0?n.length:0,t);if(s)return s}i+=t}else if(e instanceof ie&&e.parent)i=e.parent.children.indexOf(e)+(t<0?0:1),e=e.parent;else{let n=e.dom.lastChild;if(n&&n.nodeName=="BR")return n.getClientRects()[0];break}}function wh(r,t){let e=r.dom,{children:i}=r,n=0;for(let s=0;n<i.length;n++){let o=i[n],l=s+o.length;if(!(l==s&&o.getSide()<=0)){if(t>s&&t<l&&o.dom.parentNode==e)return o.domAtPos(t-s);if(t<=s)break;s=l}}for(let s=n;s>0;s--){let o=i[s-1];if(o.dom.parentNode==e)return o.domAtPos(o.length)}for(let s=n;s<i.length;s++){let o=i[s];if(o.dom.parentNode==e)return o.domAtPos(0)}return new yt(e,0)}function xh(r,t,e){let i,{children:n}=r;e>0&&t instanceof ie&&n.length&&(i=n[n.length-1])instanceof ie&&i.mark.eq(t.mark)?xh(i,t.children[0],e-1):(n.push(t),t.setParent(r)),r.length+=t.length}function kh(r,t,e){for(let s=0,o=0;o<r.children.length;o++){let l=r.children[o],h=s+l.length,a;if((e<=0||h==r.length||l.getSide()>0?h>=t:h>t)&&(t<h||o+1==r.children.length||(a=r.children[o+1]).length||a.getSide()>0)){let f=0;if(h==s){if(l.getSide()<=0)continue;f=e=-l.getSide()}let u=l.coordsAt(Math.max(0,t-s),e);return f&&u?sr(u,e<0):u}s=h}let i=r.dom.lastChild;if(!i)return r.dom.getBoundingClientRect();let n=Ri(i);return n[n.length-1]||null}function hs(r,t){for(let e in r)e=="class"&&t.class?t.class+=" "+r.class:e=="style"&&t.style?t.style+=";"+r.style:t[e]=r[e];return t}function Ps(r,t){if(r==t)return!0;if(!r||!t)return!1;let e=Object.keys(r),i=Object.keys(t);if(e.length!=i.length)return!1;for(let n of e)if(i.indexOf(n)==-1||r[n]!==t[n])return!1;return!0}function as(r,t,e){let i=null;if(t)for(let n in t)e&&n in e||r.removeAttribute(i=n);if(e)for(let n in e)t&&t[n]==e[n]||r.setAttribute(i=n,e[n]);return!!i}class zi{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}}var ot=function(r){return r[r.Text=0]="Text",r[r.WidgetBefore=1]="WidgetBefore",r[r.WidgetAfter=2]="WidgetAfter",r[r.WidgetRange=3]="WidgetRange",r}(ot||(ot={}));class tt extends ei{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new lr(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new We(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,i,n;if(t.isBlockGap)i=-5e8,n=4e8;else{let{start:s,end:o}=vh(t,e);i=(s?e?-3e8:-1:5e8)-1,n=(o?e?2e8:1:-6e8)+1}return new We(t,i,n,e,t.widget||null,!0)}static line(t){return new Vi(t)}static set(t,e=!1){return q.of(t,e)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}tt.none=q.empty;class lr extends tt{constructor(t){let{start:e,end:i}=vh(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof lr&&this.tagName==t.tagName&&this.class==t.class&&Ps(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}lr.prototype.point=!1;class Vi extends tt{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof Vi&&Ps(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}Vi.prototype.mapMode=Ct.TrackBefore;Vi.prototype.point=!0;class We extends tt{constructor(t,e,i,n,s,o){super(e,i,s,t),this.block=n,this.isReplace=o,this.mapMode=n?e<=0?Ct.TrackBefore:Ct.TrackAfter:Ct.TrackDel}get type(){return this.startSide<this.endSide?ot.WidgetRange:this.startSide<=0?ot.WidgetBefore:ot.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof We&&ou(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}We.prototype.point=!0;function vh(r,t=!1){let{inclusiveStart:e,inclusiveEnd:i}=r;return e==null&&(e=r.inclusive),i==null&&(i=r.inclusive),{start:e!=null?e:t,end:i!=null?i:t}}function ou(r,t){return r==t||!!(r&&t&&r.compare(t))}function fs(r,t,e,i=0){let n=e.length-1;n>=0&&e[n]+i>=r?e[n]=Math.max(e[n],t):e.push(r,t)}class At extends Z{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,s,o){if(i){if(!(i instanceof At))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),ph(this,t,e,i?i.children:[],s,o),!0}split(t){let e=new At;if(e.breakAfter=this.breakAfter,this.length==0)return e;let{i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let s=i;s<this.children.length;s++)e.append(this.children[s],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){!this.dom||(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){Ps(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){xh(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=hs(e,this.attrs||{})),i&&(this.attrs=hs({class:i},this.attrs||{}))}domAtPos(t){return wh(this,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?this.dirty&4&&(uh(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(as(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&Z.get(i)instanceof ie;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((e=Z.get(i))===null||e===void 0?void 0:e.isEditable)==!1&&(!M.ios||!this.children.some(n=>n instanceof Pe))){let n=document.createElement("BR");n.cmIgnore=!0,this.dom.appendChild(n)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof Pe)||/[^ -~]/.test(e.text))return null;let i=Ri(e.dom);if(i.length!=1)return null;t+=i[0].width}return t?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}:null}coordsAt(t,e){return kh(this,t,e)}become(t){return!1}get type(){return ot.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let s=t.children[i],o=n+s.length;if(o>=e){if(s instanceof At)return s;if(o>e)break}n=o+s.breakAfter}return null}}class He extends Z{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,s,o){return i&&(!(i instanceof He)||!this.widget.compare(i.widget)||t>0&&s<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return t==0?yt.before(this.dom):yt.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new He(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Bs}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):G.empty}domBoundsAround(){return null}become(t){return t instanceof He&&t.type==this.type&&t.widget.constructor==this.widget.constructor?(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Ds{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!t.breakAfter&&!(t instanceof He&&t.type==ot.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new At),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append($i(new si(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:s,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}else this.text=s,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append($i(new Pe(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,s,o){if(this.disallowBlockEffectsFor[o]&&i instanceof We){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=e-t;if(i instanceof We)if(i.block){let{type:h}=i;h==ot.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new He(i.widget||new Oo("div"),l,h))}else{let h=Ae.create(i.widget||new Oo("span"),l,i.startSide),a=this.atCursorPos&&!h.isEditable&&s<=n.length&&(t<e||i.startSide>0),f=!h.isEditable&&(t<e||i.startSide<=0),u=this.getLine();this.pendingBuffer==2&&!a&&(this.pendingBuffer=0),this.flushBuffer(n),a&&(u.append($i(new si(1),n),s),s=n.length+Math.max(0,s-n.length)),u.append($i(h,n),s),this.atCursorPos=f,this.pendingBuffer=f?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=s)}static build(t,e,i,n,s){let o=new Ds(t,e,i,s);return o.openEnd=q.spans(n,e,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function $i(r,t){for(let e of t)r=new ie(e,[r],r.length);return r}class Oo extends zi{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}}const Sh=P.define(),Ah=P.define(),Ch=P.define(),Oh=P.define(),us=P.define(),Th=P.define(),_h=P.define({combine:r=>r.some(t=>t)});class Mn{constructor(t,e="nearest",i="nearest",n=5,s=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=s}map(t){return t.empty?this:new Mn(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const To=J.define({map:(r,t)=>r.map(t)});function Zt(r,t,e){let i=r.facet(Oh);i.length?i[0](t):window.onerror?window.onerror(String(t),e,void 0,void 0,t):e?console.error(e+":",t):console.error(t)}const hr=P.define({combine:r=>r.length?r[0]:!0});let lu=0;const ki=P.define();class ne{constructor(t,e,i,n){this.id=t,this.create=e,this.domEventHandlers=i,this.extension=n(this)}static define(t,e){const{eventHandlers:i,provide:n,decorations:s}=e||{};return new ne(lu++,t,i,o=>{let l=[ki.of(o)];return s&&l.push(Ei.of(h=>{let a=h.plugin(o);return a?s(a):tt.none})),n&&l.push(n(o)),l})}static fromClass(t,e){return ne.define(i=>new t(i),e)}}class vr{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(i){if(Zt(e.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){Zt(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(!((e=this.value)===null||e===void 0)&&e.destroy)try{this.value.destroy()}catch(i){Zt(t.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Lh=P.define(),Mh=P.define(),Ei=P.define(),Bh=P.define(),Ph=P.define(),vi=P.define();class ue{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new ue(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(e.length==0)return t;let i=[];for(let n=0,s=0,o=0,l=0;;n++){let h=n==t.length?null:t[n],a=o-l,f=h?h.fromB:1e9;for(;s<e.length&&e[s]<f;){let u=e[s],c=e[s+1],d=Math.max(l,u),p=Math.min(f,c);if(d<=p&&new ue(d+a,p+a,d,p).addToSet(i),c>f)break;s+=2}if(!h)return i;new ue(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),o=h.toA,l=h.toB}}}class Bn{constructor(t,e,i){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=at.empty(this.startState.doc.length);for(let o of i)this.changes=this.changes.compose(o.changes);let n=[];this.changes.iterChangedRanges((o,l,h,a)=>n.push(new ue(o,l,h,a))),this.changedRanges=n;let s=t.hasFocus;s!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=s,this.flags|=1)}static create(t,e,i){return new Bn(t,e,i)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var ut=function(r){return r[r.LTR=0]="LTR",r[r.RTL=1]="RTL",r}(ut||(ut={}));const cs=ut.LTR,hu=ut.RTL;function Dh(r){let t=[];for(let e=0;e<r.length;e++)t.push(1<<+r[e]);return t}const au=Dh("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),fu=Dh("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),ds=Object.create(null),Wt=[];for(let r of["()","[]","{}"]){let t=r.charCodeAt(0),e=r.charCodeAt(1);ds[t]=e,ds[e]=-t}function uu(r){return r<=247?au[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?fu[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203?256:64336<=r&&r<=65023?4:r==8204?256:1}const cu=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class ti{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?hu:cs}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let s=-1;for(let o=0;o<t.length;o++){let l=t[o];if(l.from<=e&&l.to>=e){if(l.level==i)return o;(s<0||(n!=0?n<0?l.from<e:l.to>e:t[s].level>l.level))&&(s=o)}}if(s<0)throw new RangeError("Index out of range");return s}}const nt=[];function du(r,t){let e=r.length,i=t==cs?1:2,n=t==cs?2:1;if(!r||i==1&&!cu.test(r))return Nh(e);for(let o=0,l=i,h=i;o<e;o++){let a=uu(r.charCodeAt(o));a==512?a=l:a==8&&h==4&&(a=16),nt[o]=a==4?2:a,a&7&&(h=a),l=a}for(let o=0,l=i,h=i;o<e;o++){let a=nt[o];if(a==128)o<e-1&&l==nt[o+1]&&l&24?a=nt[o]=l:nt[o]=256;else if(a==64){let f=o+1;for(;f<e&&nt[f]==64;)f++;let u=o&&l==8||f<e&&nt[f]==8?h==1?1:8:256;for(let c=o;c<f;c++)nt[c]=u;o=f-1}else a==8&&h==1&&(nt[o]=1);l=a,a&7&&(h=a)}for(let o=0,l=0,h=0,a,f,u;o<e;o++)if(f=ds[a=r.charCodeAt(o)])if(f<0){for(let c=l-3;c>=0;c-=3)if(Wt[c+1]==-f){let d=Wt[c+2],p=d&2?i:d&4?d&1?n:i:0;p&&(nt[o]=nt[Wt[c]]=p),l=c;break}}else{if(Wt.length==189)break;Wt[l++]=o,Wt[l++]=a,Wt[l++]=h}else if((u=nt[o])==2||u==1){let c=u==i;h=c?0:1;for(let d=l-3;d>=0;d-=3){let p=Wt[d+2];if(p&2)break;if(c)Wt[d+2]|=2;else{if(p&4)break;Wt[d+2]|=4}}}for(let o=0;o<e;o++)if(nt[o]==256){let l=o+1;for(;l<e&&nt[l]==256;)l++;let h=(o?nt[o-1]:i)==1,a=(l<e?nt[l]:i)==1,f=h==a?h?1:2:i;for(let u=o;u<l;u++)nt[u]=f;o=l-1}let s=[];if(i==1)for(let o=0;o<e;){let l=o,h=nt[o++]!=1;for(;o<e&&h==(nt[o]!=1);)o++;if(h)for(let a=o;a>l;){let f=a,u=nt[--a]!=2;for(;a>l&&u==(nt[a-1]!=2);)a--;s.push(new ti(a,f,u?2:1))}else s.push(new ti(l,o,0))}else for(let o=0;o<e;){let l=o,h=nt[o++]==2;for(;o<e&&h==(nt[o]==2);)o++;s.push(new ti(l,o,h?1:2))}return s}function Nh(r){return[new ti(0,r,0)]}let Rh="";function pu(r,t,e,i,n){var s;let o=i.head-r.from,l=-1;if(o==0){if(!n||!r.length)return null;t[0].level!=e&&(o=t[0].side(!1,e),l=0)}else if(o==r.length){if(n)return null;let c=t[t.length-1];c.level!=e&&(o=c.side(!0,e),l=t.length-1)}l<0&&(l=ti.find(t,o,(s=i.bidiLevel)!==null&&s!==void 0?s:-1,i.assoc));let h=t[l];o==h.side(n,e)&&(h=t[l+=n?1:-1],o=h.side(!n,e));let a=n==(h.dir==e),f=Bt(r.text,o,a);if(Rh=r.text.slice(Math.min(o,f),Math.max(o,f)),f!=h.side(n,e))return O.cursor(f+r.from,a?-1:1,h.level);let u=l==(n?t.length-1:0)?null:t[l+(n?1:-1)];return!u&&h.level!=e?O.cursor(n?r.to:r.from,n?-1:1,e):u&&u.level<h.level?O.cursor(u.side(!n,e)+r.from,n?1:-1,u.level):O.cursor(f+r.from,n?-1:1,h.level)}const Ce="\uFFFF";class Ih{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(j.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=Ce}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let s=n.nextSibling;if(s==e)break;let o=Z.get(n),l=Z.get(s);(o&&l?o.breakAfter:(o?o.breakAfter:_o(n))||_o(s)&&(n.nodeName!="BR"||n.cmIgnore))&&this.lineBreak(),n=s}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,o=1,l;if(this.lineSeparator?(s=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=n.exec(e))&&(s=l.index,o=l[0].length),this.append(e.slice(i,s<0?e.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let h of this.points)h.node==t&&h.pos>this.text.length&&(h.pos-=o-1);i=s+o}}readNode(t){if(t.cmIgnore)return;let e=Z.get(t),i=e&&e.overrideDOMText;if(i!=null){this.findPointInside(t,i.length);for(let n=i.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(t.nodeType==3?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}}function _o(r){return r.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(r.nodeName)}class Lo{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class Mo extends Z{constructor(t){super(),this.view=t,this.compositionDeco=tt.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new At],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ue(0,0,0,t.state.doc.length)],0)}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=tt.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=mu(this.view,t.changes)),(M.ie||M.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,n=this.updateDeco(),s=xu(i,n,t.changes);return e=ue.extendWithRanges(e,s),this.dirty==0&&e.length==0?!1:(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let s=M.chrome||M.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(s),this.dirty=0,s&&(s.written||i.selectionRange.focusNode!=s.node)&&(this.forceSelection=!0),this.dom.style.height=""});let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let s of this.children)s instanceof He&&s.widget instanceof Bo&&n.push(s.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let n=t.length-1;;n--){let s=n>=0?t[n]:null;if(!s)break;let{fromA:o,toA:l,fromB:h,toB:a}=s,{content:f,breakAtStart:u,openStart:c,openEnd:d}=Ds.build(this.view.state.doc,h,a,this.decorations,this.dynamicDecorationMap),{i:p,off:x}=i.findPos(l,1),{i:S,off:k}=i.findPos(o,-1);dh(this,S,k,p,x,f,u,c,d)}}updateSelection(t=!1,e=!1){if((t||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange(),!(e||this.mayControlSelection()))return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,s=this.domAtPos(n.anchor),o=n.empty?s:this.domAtPos(n.head);if(M.gecko&&n.empty&&gu(s)){let h=document.createTextNode("");this.view.observer.ignore(()=>s.node.insertBefore(h,s.node.childNodes[s.offset]||null)),s=o=new yt(h,0),i=!0}let l=this.view.observer.selectionRange;(i||!l.focusNode||!_n(s.node,s.offset,l.anchorNode,l.anchorOffset)||!_n(o.node,o.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{M.android&&M.chrome&&this.dom.contains(l.focusNode)&&ku(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=Tn(this.view.root);if(h)if(n.empty){if(M.gecko){let a=yu(s.node,s.offset);if(a&&a!=3){let f=zh(s.node,s.offset,a==1?1:-1);f&&(s=new yt(f,a==1?0:f.nodeValue.length))}}h.collapse(s.node,s.offset),n.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=n.bidiLevel)}else if(h.extend)h.collapse(s.node,s.offset),h.extend(o.node,o.offset);else{let a=document.createRange();n.anchor>n.head&&([s,o]=[o,s]),a.setEnd(o.node,o.offset),a.setStart(s.node,s.offset),h.removeAllRanges(),h.addRange(a)}}),this.view.observer.setSelectionRange(s,o)),this.impreciseAnchor=s.precise?null:new yt(l.anchorNode,l.anchorOffset),this.impreciseHead=o.precise?null:new yt(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=Tn(this.view.root);if(!e||!t.empty||!t.assoc||!e.modify)return;let i=At.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let s=this.coordsAt(t.head,-1),o=this.coordsAt(t.head,1);if(!s||!o||s.bottom>o.top)return;let l=this.domAtPos(t.head+t.assoc);e.collapse(l.node,l.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){let t=this.view.root.activeElement;return t==this.dom||dn(this.dom,this.view.observer.selectionRange)&&!(t&&this.dom.contains(t))}nearest(t){for(let e=t;e;){let i=Z.get(e);if(i&&i.rootView==this)return i;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let n=this.children[e];if(i<n.length||n instanceof At)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let s=this.children[n],o=i-s.breakAfter-s.length;if(t>o||t==o&&s.type!=ot.WidgetBefore&&s.type!=ot.WidgetAfter&&(!n||e==2||this.children[n-1].breakAfter||this.children[n-1].type==ot.WidgetBefore&&e>-2))return s.coordsAt(t-o,e);i=o}}measureVisibleLineHeights(t){let e=[],{from:i,to:n}=t,s=this.view.contentDOM.clientWidth,o=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,h=this.view.textDirection==ut.LTR;for(let a=0,f=0;f<this.children.length;f++){let u=this.children[f],c=a+u.length;if(c>n)break;if(a>=i){let d=u.dom.getBoundingClientRect();if(e.push(d.height),o){let p=u.dom.lastChild,x=p?Ri(p):[];if(x.length){let S=x[x.length-1],k=h?S.right-d.left:d.right-S.left;k>l&&(l=k,this.minWidth=s,this.minWidthFrom=a,this.minWidthTo=c)}}}a=c+u.breakAfter}return e}textDirectionAt(t){let{i:e}=this.childPos(t,1);return getComputedStyle(this.children[e].dom).direction=="rtl"?ut.RTL:ut.LTR}measureTextSize(){for(let n of this.children)if(n instanceof At){let s=n.measureTextSize();if(s)return s}let t=document.createElement("div"),e,i;return t.className="cm-line",t.style.width="99999px",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let n=Ri(t.firstChild)[0];e=t.getBoundingClientRect().height,i=n?n.width/27:7,t.remove()}),{lineHeight:e,charWidth:i}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new ch(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let s=n==e.viewports.length?null:e.viewports[n],o=s?s.from-1:this.length;if(o>i){let l=e.lineBlockAt(o).bottom-e.lineBlockAt(i).top;t.push(tt.replace({widget:new Bo(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!s)break;i=s.to+1}return tt.set(t)}updateDeco(){let t=this.view.state.facet(Ei).map((e,i)=>(this.dynamicDecorationMap[i]=typeof e=="function")?e(this.view):e);for(let e=t.length;e<t.length+3;e++)this.dynamicDecorationMap[e]=!1;return this.decorations=[...t,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let{range:e}=t,i=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),n;if(!i)return;!e.empty&&(n=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(i={left:Math.min(i.left,n.left),top:Math.min(i.top,n.top),right:Math.max(i.right,n.right),bottom:Math.max(i.bottom,n.bottom)});let s=0,o=0,l=0,h=0;for(let f of this.view.state.facet(Ph).map(u=>u(this.view)))if(f){let{left:u,right:c,top:d,bottom:p}=f;u!=null&&(s=Math.max(s,u)),c!=null&&(o=Math.max(o,c)),d!=null&&(l=Math.max(l,d)),p!=null&&(h=Math.max(h,p))}let a={left:i.left-s,top:i.top-l,right:i.right+o,bottom:i.bottom+h};tu(this.view.scrollDOM,a,e.head<e.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==ut.LTR)}}function gu(r){return r.node.nodeType==1&&r.node.firstChild&&(r.offset==0||r.node.childNodes[r.offset-1].contentEditable=="false")&&(r.offset==r.node.childNodes.length||r.node.childNodes[r.offset].contentEditable=="false")}class Bo extends zi{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function Eh(r){let t=r.observer.selectionRange,e=t.focusNode&&zh(t.focusNode,t.focusOffset,0);if(!e)return null;let i=r.docView.nearest(e);if(!i)return null;if(i instanceof At){let n=e;for(;n.parentNode!=i.dom;)n=n.parentNode;let s=n.previousSibling;for(;s&&!Z.get(s);)s=s.previousSibling;let o=s?Z.get(s).posAtEnd:i.posAtStart;return{from:o,to:o,node:n,text:e}}else{for(;;){let{parent:s}=i;if(!s)return null;if(s instanceof At)break;i=s}let n=i.posAtStart;return{from:n,to:n+i.length,node:i.dom,text:e}}}function mu(r,t){let e=Eh(r);if(!e)return tt.none;let{from:i,to:n,node:s,text:o}=e,l=t.mapPos(i,1),h=Math.max(l,t.mapPos(n,-1)),{state:a}=r,f=s.nodeType==3?s.nodeValue:new Ih([],a).readRange(s.firstChild,null).text;if(h-l<f.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+f.length),Ce)==f)h=l+f.length;else if(a.doc.sliceString(Math.max(0,h-f.length),h,Ce)==f)l=h-f.length;else return tt.none;else if(a.doc.sliceString(l,h,Ce)!=f)return tt.none;let u=Z.get(s);return u instanceof bh?u=u.widget.topView:u&&(u.parent=null),tt.set(tt.replace({widget:new bu(s,o,u),inclusive:!0}).range(l,h))}class bu extends zi{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return bh}}function zh(r,t,e){for(;;){if(r.nodeType==3)return r;if(r.nodeType==1&&t>0&&e<=0)r=r.childNodes[t-1],t=Ii(r);else if(r.nodeType==1&&t<r.childNodes.length&&e>=0)r=r.childNodes[t],t=0;else return null}}function yu(r,t){return r.nodeType!=1?0:(t&&r.childNodes[t-1].contentEditable=="false"?1:0)|(t<r.childNodes.length&&r.childNodes[t].contentEditable=="false"?2:0)}class wu{constructor(){this.changes=[]}compareRange(t,e){fs(t,e,this.changes)}comparePoint(t,e){fs(t,e,this.changes)}}function xu(r,t,e){let i=new wu;return q.compare(r,t,e,i),i.changes}function ku(r,t){for(let e=r;e&&e!=t;e=e.assignedSlot||e.parentNode)if(e.nodeType==1&&e.contentEditable=="false")return!0;return!1}function vu(r,t,e=1){let i=r.charCategorizer(t),n=r.doc.lineAt(t),s=t-n.from;if(n.length==0)return O.cursor(t);s==0?e=1:s==n.length&&(e=-1);let o=s,l=s;e<0?o=Bt(n.text,s,!1):l=Bt(n.text,s);let h=i(n.text.slice(o,l));for(;o>0;){let a=Bt(n.text,o,!1);if(i(n.text.slice(a,o))!=h)break;o=a}for(;l<n.length;){let a=Bt(n.text,l);if(i(n.text.slice(l,a))!=h)break;l=a}return O.range(o+n.from,l+n.from)}function Su(r,t){return t.left>r?t.left-r:Math.max(0,r-t.right)}function Au(r,t){return t.top>r?t.top-r:Math.max(0,r-t.bottom)}function Sr(r,t){return r.top<t.bottom-1&&r.bottom>t.top+1}function Po(r,t){return t<r.top?{top:t,left:r.left,right:r.right,bottom:r.bottom}:r}function Do(r,t){return t>r.bottom?{top:r.top,left:r.left,right:r.right,bottom:t}:r}function ps(r,t,e){let i,n,s,o,l=!1,h,a,f,u;for(let p=r.firstChild;p;p=p.nextSibling){let x=Ri(p);for(let S=0;S<x.length;S++){let k=x[S];n&&Sr(n,k)&&(k=Po(Do(k,n.bottom),n.top));let B=Su(t,k),C=Au(e,k);if(B==0&&C==0)return p.nodeType==3?No(p,t,e):ps(p,t,e);(!i||o>C||o==C&&s>B)&&(i=p,n=k,s=B,o=C,l=!B||(B>0?S<x.length-1:S>0)),B==0?e>k.bottom&&(!f||f.bottom<k.bottom)?(h=p,f=k):e<k.top&&(!u||u.top>k.top)&&(a=p,u=k):f&&Sr(f,k)?f=Do(f,k.bottom):u&&Sr(u,k)&&(u=Po(u,k.top))}}if(f&&f.bottom>=e?(i=h,n=f):u&&u.top<=e&&(i=a,n=u),!i)return{node:r,offset:0};let c=Math.max(n.left,Math.min(n.right,t));if(i.nodeType==3)return No(i,c,e);if(l&&i.contentEditable!="false")return ps(i,c,e);let d=Array.prototype.indexOf.call(r.childNodes,i)+(t>=(n.left+n.right)/2?1:0);return{node:r,offset:d}}function No(r,t,e){let i=r.nodeValue.length,n=-1,s=1e9,o=0;for(let l=0;l<i;l++){let h=ri(r,l,l+1).getClientRects();for(let a=0;a<h.length;a++){let f=h[a];if(f.top==f.bottom)continue;o||(o=t-f.left);let u=(f.top>e?f.top-e:e-f.bottom)-1;if(f.left-1<=t&&f.right+1>=t&&u<s){let c=t>=(f.left+f.right)/2,d=c;if((M.chrome||M.gecko)&&ri(r,l).getBoundingClientRect().left==f.right&&(d=!c),u<=0)return{node:r,offset:l+(d?1:0)};n=l+(d?1:0),s=u}}}return{node:r,offset:n>-1?n:o>0?r.nodeValue.length:0}}function Vh(r,{x:t,y:e},i,n=-1){var s;let o=r.contentDOM.getBoundingClientRect(),l=o.top+r.viewState.paddingTop,h,{docHeight:a}=r.viewState,f=e-l;if(f<0)return 0;if(f>a)return r.state.doc.length;for(let k=r.defaultLineHeight/2,B=!1;h=r.elementAtHeight(f),h.type!=ot.Text;)for(;f=n>0?h.bottom+k:h.top-k,!(f>=0&&f<=a);){if(B)return i?null:0;B=!0,n=-n}e=l+f;let u=h.from;if(u<r.viewport.from)return r.viewport.from==0?0:i?null:Ro(r,o,h,t,e);if(u>r.viewport.to)return r.viewport.to==r.state.doc.length?r.state.doc.length:i?null:Ro(r,o,h,t,e);let c=r.dom.ownerDocument,d=r.root.elementFromPoint?r.root:c,p=d.elementFromPoint(t,e);p&&!r.contentDOM.contains(p)&&(p=null),p||(t=Math.max(o.left+1,Math.min(o.right-1,t)),p=d.elementFromPoint(t,e),p&&!r.contentDOM.contains(p)&&(p=null));let x,S=-1;if(p&&((s=r.docView.nearest(p))===null||s===void 0?void 0:s.isEditable)!=!1){if(c.caretPositionFromPoint){let k=c.caretPositionFromPoint(t,e);k&&({offsetNode:x,offset:S}=k)}else if(c.caretRangeFromPoint){let k=c.caretRangeFromPoint(t,e);k&&({startContainer:x,startOffset:S}=k,(!r.contentDOM.contains(x)||M.safari&&Cu(x,S,t)||M.chrome&&Ou(x,S,t))&&(x=void 0))}}if(!x||!r.docView.dom.contains(x)){let k=At.find(r.docView,u);if(!k)return f>h.top+h.height/2?h.to:h.from;({node:x,offset:S}=ps(k.dom,t,e))}return r.docView.posFromDOM(x,S)}function Ro(r,t,e,i,n){let s=Math.round((i-t.left)*r.defaultCharacterWidth);r.lineWrapping&&e.height>r.defaultLineHeight*1.5&&(s+=Math.floor((n-e.top)/r.defaultLineHeight)*r.viewState.heightOracle.lineLength);let o=r.state.sliceDoc(e.from,e.to);return e.from+Gf(o,s,r.state.tabSize)}function Cu(r,t,e){let i;if(r.nodeType!=3||t!=(i=r.nodeValue.length))return!1;for(let n=r.nextSibling;n;n=n.nextSibling)if(n.nodeType!=1||n.nodeName!="BR")return!1;return ri(r,i-1,i).getBoundingClientRect().left>e}function Ou(r,t,e){if(t!=0)return!1;for(let n=r;;){let s=n.parentNode;if(!s||s.nodeType!=1||s.firstChild!=n)return!1;if(s.classList.contains("cm-line"))break;n=s}let i=r.nodeType==1?r.getBoundingClientRect():ri(r,0,Math.max(r.nodeValue.length,1)).getBoundingClientRect();return e-i.left>5}function Tu(r,t,e,i){let n=r.state.doc.lineAt(t.head),s=!i||!r.lineWrapping?null:r.coordsAtPos(t.assoc<0&&t.head>n.from?t.head-1:t.head);if(s){let h=r.dom.getBoundingClientRect(),a=r.textDirectionAt(n.from),f=r.posAtCoords({x:e==(a==ut.LTR)?h.right-1:h.left+1,y:(s.top+s.bottom)/2});if(f!=null)return O.cursor(f,e?-1:1)}let o=At.find(r.docView,t.head),l=o?e?o.posAtEnd:o.posAtStart:e?n.to:n.from;return O.cursor(l,e?-1:1)}function Io(r,t,e,i){let n=r.state.doc.lineAt(t.head),s=r.bidiSpans(n),o=r.textDirectionAt(n.from);for(let l=t,h=null;;){let a=pu(n,s,o,l,e),f=Rh;if(!a){if(n.number==(e?r.state.doc.lines:1))return l;f=`
`,n=r.state.doc.line(n.number+(e?1:-1)),s=r.bidiSpans(n),a=O.cursor(e?n.from:n.to)}if(h){if(!h(f))return l}else{if(!i)return a;h=i(f)}l=a}}function _u(r,t,e){let i=r.state.charCategorizer(t),n=i(e);return s=>{let o=i(s);return n==fe.Space&&(n=o),n==o}}function Lu(r,t,e,i){let n=t.head,s=e?1:-1;if(n==(e?r.state.doc.length:0))return O.cursor(n,t.assoc);let o=t.goalColumn,l,h=r.contentDOM.getBoundingClientRect(),a=r.coordsAtPos(n),f=r.documentTop;if(a)o==null&&(o=a.left-h.left),l=s<0?a.top:a.bottom;else{let d=r.viewState.lineBlockAt(n);o==null&&(o=Math.min(h.right-h.left,r.defaultCharacterWidth*(n-d.from))),l=(s<0?d.top:d.bottom)+f}let u=h.left+o,c=i!=null?i:r.defaultLineHeight>>1;for(let d=0;;d+=10){let p=l+(c+d)*s,x=Vh(r,{x:u,y:p},!1,s);if(p<h.top||p>h.bottom||(s<0?x<n:x>n))return O.cursor(x,t.assoc,void 0,o)}}function Ar(r,t,e){let i=r.state.facet(Bh).map(n=>n(r));for(;;){let n=!1;for(let s of i)s.between(e.from-1,e.from+1,(o,l,h)=>{e.from>o&&e.from<l&&(e=t.head>e.from?O.cursor(o,1):O.cursor(l,-1),n=!0)});if(!n)return e}}class Mu{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.mouseSelection=null;for(let e in ct){let i=ct[e];t.contentDOM.addEventListener(e,n=>{!Eo(t,n)||this.ignoreDuringComposition(n)||e=="keydown"&&this.keydown(t,n)||(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))},gs[e]),this.registeredEvents.push(e)}M.chrome&&M.chrome_version==102&&t.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?t.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,t.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=t.hasFocus,M.safari&&t.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t,e){var i;let n;this.customHandlers=[];for(let s of e)if(n=(i=s.update(t).spec)===null||i===void 0?void 0:i.domEventHandlers){this.customHandlers.push({plugin:s.value,handlers:n});for(let o in n)this.registeredEvents.indexOf(o)<0&&o!="scroll"&&(this.registeredEvents.push(o),t.contentDOM.addEventListener(o,l=>{!Eo(t,l)||this.runCustomHandlers(o,t,l)&&l.preventDefault()}))}}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let s=n.handlers[t];if(s)try{if(s.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(o){Zt(e.state,o)}}return!1}runScrollHandlers(t,e){this.lastScrollTop=t.scrollDOM.scrollTop,this.lastScrollLeft=t.scrollDOM.scrollLeft;for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(s){Zt(t.state,s)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(M.android&&M.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return M.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((i=Fh.find(n=>n.keyCode==e.keyCode))&&!e.ctrlKey||Bu.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=i||e,setTimeout(()=>this.flushIOSKey(t),250),!0):!1}flushIOSKey(t){let e=this.pendingIOSKey;return e?(this.pendingIOSKey=void 0,_i(t.contentDOM,e.key,e.keyCode)):!1}ignoreDuringComposition(t){return/^key/.test(t.type)?this.composing>0?!0:M.safari&&!M.ios&&Date.now()-this.compositionEndedAt<100?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(t){return t.type=="keydown"&&t.keyCode!=229}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const Fh=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Bu="dthko",Hh=[16,17,18,20,91,92,224,225];class Pu{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let s=t.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(j.allowMultipleSelections)&&Du(t,e),this.dragMove=Nu(t,e),this.dragging=Ru(t,e)&&Ns(e)==1?null:!1,this.dragging===!1&&(e.preventDefault(),this.select(e))}move(t){if(t.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=t)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);(this.mustSelect||!e.eq(this.view.state.selection)||e.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}}function Du(r,t){let e=r.state.facet(Sh);return e.length?e[0](t):M.mac?t.metaKey:t.ctrlKey}function Nu(r,t){let e=r.state.facet(Ah);return e.length?e[0](t):M.mac?!t.altKey:!t.ctrlKey}function Ru(r,t){let{main:e}=r.state.selection;if(e.empty)return!1;let i=Tn(r.root);if(!i||i.rangeCount==0)return!0;let n=i.getRangeAt(0).getClientRects();for(let s=0;s<n.length;s++){let o=n[s];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function Eo(r,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target,i;e!=r.contentDOM;e=e.parentNode)if(!e||e.nodeType==11||(i=Z.get(e))&&i.ignoreEvent(t))return!1;return!0}const ct=Object.create(null),gs=Object.create(null),Uh=M.ie&&M.ie_version<15||M.ios&&M.webkit_version<604;function Iu(r){let t=r.dom.parentNode;if(!t)return;let e=t.appendChild(document.createElement("textarea"));e.style.cssText="position: fixed; left: -10000px; top: 10px",e.focus(),setTimeout(()=>{r.focus(),e.remove(),Wh(r,e.value)},50)}function Wh(r,t){let{state:e}=r,i,n=1,s=e.toText(t),o=s.lines==e.selection.ranges.length;if(ms!=null&&e.selection.ranges.every(h=>h.empty)&&ms==s.toString()){let h=-1;i=e.changeByRange(a=>{let f=e.doc.lineAt(a.from);if(f.from==h)return{range:a};h=f.from;let u=e.toText((o?s.line(n++).text:t)+e.lineBreak);return{changes:{from:f.from,insert:u},range:O.cursor(a.from+u.length)}})}else o?i=e.changeByRange(h=>{let a=s.line(n++);return{changes:{from:h.from,to:h.to,insert:a.text},range:O.cursor(h.from+a.length)}}):i=e.replaceSelection(s);r.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}ct.keydown=(r,t)=>{r.inputState.setSelectionOrigin("select"),t.keyCode==27?r.inputState.lastEscPress=Date.now():Hh.indexOf(t.keyCode)<0&&(r.inputState.lastEscPress=0)};ct.touchstart=(r,t)=>{r.inputState.lastTouchTime=Date.now(),r.inputState.setSelectionOrigin("select.pointer")};ct.touchmove=r=>{r.inputState.setSelectionOrigin("select.pointer")};gs.touchstart=gs.touchmove={passive:!0};ct.mousedown=(r,t)=>{if(r.observer.flush(),r.inputState.lastTouchTime>Date.now()-2e3&&Ns(t)==1)return;let e=null;for(let i of r.state.facet(Ch))if(e=i(r,t),e)break;if(!e&&t.button==0&&(e=Vu(r,t)),e){let i=r.root.activeElement!=r.contentDOM;i&&r.observer.ignore(()=>fh(r.contentDOM)),r.inputState.startMouseSelection(new Pu(r,t,e,i))}};function zo(r,t,e,i){if(i==1)return O.cursor(t,e);if(i==2)return vu(r.state,t,e);{let n=At.find(r.docView,t),s=r.state.doc.lineAt(n?n.posAtEnd:t),o=n?n.posAtStart:s.from,l=n?n.posAtEnd:s.to;return l<r.state.doc.length&&l==s.to&&l++,O.range(o,l)}}let $h=(r,t)=>r>=t.top&&r<=t.bottom,Vo=(r,t,e)=>$h(t,e)&&r>=e.left&&r<=e.right;function Eu(r,t,e,i){let n=At.find(r.docView,t);if(!n)return 1;let s=t-n.posAtStart;if(s==0)return 1;if(s==n.length)return-1;let o=n.coordsAt(s,-1);if(o&&Vo(e,i,o))return-1;let l=n.coordsAt(s,1);return l&&Vo(e,i,l)?1:o&&$h(i,o)?-1:1}function Fo(r,t){let e=r.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:e,bias:Eu(r,e,t.clientX,t.clientY)}}const zu=M.ie&&M.ie_version<=11;let Ho=null,Uo=0,Wo=0;function Ns(r){if(!zu)return r.detail;let t=Ho,e=Wo;return Ho=r,Wo=Date.now(),Uo=!t||e>Date.now()-400&&Math.abs(t.clientX-r.clientX)<2&&Math.abs(t.clientY-r.clientY)<2?(Uo+1)%3:1}function Vu(r,t){let e=Fo(r,t),i=Ns(t),n=r.state.selection,s=e,o=t;return{update(l){l.docChanged&&(e.pos=l.changes.mapPos(e.pos),n=n.map(l.changes),o=null)},get(l,h,a){let f;o&&l.clientX==o.clientX&&l.clientY==o.clientY?f=s:(f=s=Fo(r,l),o=l);let u=zo(r,f.pos,f.bias,i);if(e.pos!=f.pos&&!h){let c=zo(r,e.pos,e.bias,i),d=Math.min(c.from,u.from),p=Math.max(c.to,u.to);u=d<u.from?O.range(d,p):O.range(p,d)}return h?n.replaceRange(n.main.extend(u.from,u.to)):a&&n.ranges.length>1&&n.ranges.some(c=>c.eq(u))?Fu(n,u):a?n.addRange(u):O.create([u])}}}function Fu(r,t){for(let e=0;;e++)if(r.ranges[e].eq(t))return O.create(r.ranges.slice(0,e).concat(r.ranges.slice(e+1)),r.mainIndex==e?0:r.mainIndex-(r.mainIndex>e?1:0))}ct.dragstart=(r,t)=>{let{selection:{main:e}}=r.state,{mouseSelection:i}=r.inputState;i&&(i.dragging=e),t.dataTransfer&&(t.dataTransfer.setData("Text",r.state.sliceDoc(e.from,e.to)),t.dataTransfer.effectAllowed="copyMove")};function $o(r,t,e,i){if(!e)return;let n=r.posAtCoords({x:t.clientX,y:t.clientY},!1);t.preventDefault();let{mouseSelection:s}=r.inputState,o=i&&s&&s.dragging&&s.dragMove?{from:s.dragging.from,to:s.dragging.to}:null,l={from:n,insert:e},h=r.state.changes(o?[o,l]:l);r.focus(),r.dispatch({changes:h,selection:{anchor:h.mapPos(n,-1),head:h.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}ct.drop=(r,t)=>{if(!t.dataTransfer)return;if(r.state.readOnly)return t.preventDefault();let e=t.dataTransfer.files;if(e&&e.length){t.preventDefault();let i=Array(e.length),n=0,s=()=>{++n==e.length&&$o(r,t,i.filter(o=>o!=null).join(r.state.lineBreak),!1)};for(let o=0;o<e.length;o++){let l=new FileReader;l.onerror=s,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),s()},l.readAsText(e[o])}}else $o(r,t,t.dataTransfer.getData("Text"),!0)};ct.paste=(r,t)=>{if(r.state.readOnly)return t.preventDefault();r.observer.flush();let e=Uh?null:t.clipboardData;e?(Wh(r,e.getData("text/plain")),t.preventDefault()):Iu(r)};function Hu(r,t){let e=r.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=t,i.focus(),i.selectionEnd=t.length,i.selectionStart=0,setTimeout(()=>{i.remove(),r.focus()},50)}function Uu(r){let t=[],e=[],i=!1;for(let n of r.selection.ranges)n.empty||(t.push(r.sliceDoc(n.from,n.to)),e.push(n));if(!t.length){let n=-1;for(let{from:s}of r.selection.ranges){let o=r.doc.lineAt(s);o.number>n&&(t.push(o.text),e.push({from:o.from,to:Math.min(r.doc.length,o.to+1)})),n=o.number}i=!0}return{text:t.join(r.lineBreak),ranges:e,linewise:i}}let ms=null;ct.copy=ct.cut=(r,t)=>{let{text:e,ranges:i,linewise:n}=Uu(r.state);if(!e&&!n)return;ms=n?e:null;let s=Uh?null:t.clipboardData;s?(t.preventDefault(),s.clearData(),s.setData("text/plain",e)):Hu(r,e),t.type=="cut"&&!r.state.readOnly&&r.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})};function jh(r){setTimeout(()=>{r.hasFocus!=r.inputState.notifiedFocused&&r.update([])},10)}ct.focus=r=>{r.inputState.lastFocusTime=Date.now(),!r.scrollDOM.scrollTop&&(r.inputState.lastScrollTop||r.inputState.lastScrollLeft)&&(r.scrollDOM.scrollTop=r.inputState.lastScrollTop,r.scrollDOM.scrollLeft=r.inputState.lastScrollLeft),jh(r)};ct.blur=r=>{r.observer.clearSelectionRange(),jh(r)};ct.compositionstart=ct.compositionupdate=r=>{r.inputState.compositionFirstChange==null&&(r.inputState.compositionFirstChange=!0),r.inputState.composing<0&&(r.inputState.composing=0)};ct.compositionend=r=>{r.inputState.composing=-1,r.inputState.compositionEndedAt=Date.now(),r.inputState.compositionFirstChange=null,M.chrome&&M.android&&r.observer.flushSoon(),setTimeout(()=>{r.inputState.composing<0&&r.docView.compositionDeco.size&&r.update([])},50)};ct.contextmenu=r=>{r.inputState.lastContextMenu=Date.now()};ct.beforeinput=(r,t)=>{var e;let i;if(M.chrome&&M.android&&(i=Fh.find(n=>n.inputType==t.inputType))&&(r.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let n=((e=window.visualViewport)===null||e===void 0?void 0:e.height)||0;setTimeout(()=>{var s;(((s=window.visualViewport)===null||s===void 0?void 0:s.height)||0)>n+10&&r.hasFocus&&(r.contentDOM.blur(),r.focus())},100)}};const jo=["pre-wrap","normal","pre-line","break-spaces"];class Wu{constructor(){this.doc=G.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return jo.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(n*10)]||(e=!0,this.heightSamples[Math.floor(n*10)]=!0)}return e}refresh(t,e,i,n,s){let o=jo.indexOf(t)>-1,l=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=e,this.charWidth=i,this.lineLength=n,l){this.heightSamples={};for(let h=0;h<s.length;h++){let a=s[h];a<0?h++:this.heightSamples[Math.floor(a*10)]=!0}}return l}}class $u{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class Oe{constructor(t,e,i,n,s){this.from=t,this.length=e,this.top=i,this.height=n,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new Oe(this.from,this.length+t.length,this.top,this.height+t.height,e)}}var X=function(r){return r[r.ByPos=0]="ByPos",r[r.ByHeight=1]="ByHeight",r[r.ByPosNoHeight=2]="ByPosNoHeight",r}(X||(X={}));const pn=.001;class Tt{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>pn&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return Tt.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let s=this;for(let o=n.length-1;o>=0;o--){let{fromA:l,toA:h,fromB:a,toB:f}=n[o],u=s.lineAt(l,X.ByPosNoHeight,e,0,0),c=u.to>=h?u:s.lineAt(h,X.ByPosNoHeight,e,0,0);for(f+=c.to-h,h=c.to;o>0&&u.from<=n[o-1].toA;)l=n[o-1].fromA,a=n[o-1].fromB,o--,l<u.from&&(u=s.lineAt(l,X.ByPosNoHeight,e,0,0));a+=u.from-l,l=u.from;let d=Rs.build(i,t,a,f);s=s.replace(l,h,d)}return s.updateHeight(i,0)}static empty(){return new Lt(0,0)}static of(t){if(t.length==1)return t[0];let e=0,i=t.length,n=0,s=0;for(;;)if(e==i)if(n>s*2){let l=t[e-1];l.break?t.splice(--e,1,l.left,null,l.right):t.splice(--e,1,l.left,l.right),i+=1+l.break,n-=l.size}else if(s>n*2){let l=t[i];l.break?t.splice(i,1,l.left,null,l.right):t.splice(i,1,l.left,l.right),i+=2+l.break,s-=l.size}else break;else if(n<s){let l=t[e++];l&&(n+=l.size)}else{let l=t[--i];l&&(s+=l.size)}let o=0;return t[e-1]==null?(o=1,e--):t[e]==null&&(o=1,i++),new ju(Tt.of(t.slice(0,e)),o,Tt.of(t.slice(i)))}}Tt.prototype.size=1;class Gh extends Tt{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new Oe(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,s){return this.blockAt(0,i,n,s)}forEachLine(t,e,i,n,s,o){t<=s+this.length&&e>=s&&o(this.blockAt(0,i,n,s))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Lt extends Gh{constructor(t,e){super(t,e,ot.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return i.length==1&&(n instanceof Lt||n instanceof dt&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof dt?n=new Lt(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):Tt.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class dt extends Tt{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:s,lastLine:o,lineHeight:l}=this.lines(e,n),h=Math.max(0,Math.min(o-s,Math.floor((t-i)/l))),{from:a,length:f}=e.line(s+h);return new Oe(a,f,i+l*h,l,ot.Text)}lineAt(t,e,i,n,s){if(e==X.ByHeight)return this.blockAt(t,i,n,s);if(e==X.ByPosNoHeight){let{from:u,to:c}=i.lineAt(t);return new Oe(u,c-u,0,0,ot.Text)}let{firstLine:o,lineHeight:l}=this.lines(i,s),{from:h,length:a,number:f}=i.lineAt(t);return new Oe(h,a,n+l*(f-o),l,ot.Text)}forEachLine(t,e,i,n,s,o){let{firstLine:l,lineHeight:h}=this.lines(i,s);for(let a=Math.max(t,s),f=Math.min(s+this.length,e);a<=f;){let u=i.lineAt(a);a==t&&(n+=h*(u.number-l)),o(new Oe(u.from,u.length,n,h,ot.Text)),n+=h,a=u.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let s=i[i.length-1];s instanceof dt?i[i.length-1]=new dt(s.length+n):i.push(null,new dt(n-1))}if(t>0){let s=i[0];s instanceof dt?i[0]=new dt(t+s.length):i.unshift(new dt(t-1),null)}return Tt.of(i)}decomposeLeft(t,e){e.push(new dt(t-1),null)}decomposeRight(t,e){e.push(null,new dt(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let s=e+this.length;if(n&&n.from<=e+this.length&&n.more){let o=[],l=Math.max(e,n.from),h=-1,a=t.heightChanged;for(n.from>e&&o.push(new dt(n.from-e-1).updateHeight(t,e));l<=s&&n.more;){let u=t.doc.lineAt(l).length;o.length&&o.push(null);let c=n.heights[n.index++];h==-1?h=c:Math.abs(c-h)>=pn&&(h=-2);let d=new Lt(u,c);d.outdated=!1,o.push(d),l+=u+1}l<=s&&o.push(null,new dt(s-l).updateHeight(t,l));let f=Tt.of(o);return t.heightChanged=a||h<0||Math.abs(f.height-this.height)>=pn||Math.abs(h-this.lines(t.doc,e).lineHeight)>=pn,f}else(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class ju extends Tt{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return this.flags&1}blockAt(t,e,i,n){let s=i+this.left.height;return t<s?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,s,n+this.left.length+this.break)}lineAt(t,e,i,n,s){let o=n+this.left.height,l=s+this.left.length+this.break,h=e==X.ByHeight?t<o:t<l,a=h?this.left.lineAt(t,e,i,n,s):this.right.lineAt(t,e,i,o,l);if(this.break||(h?a.to<l:a.from>l))return a;let f=e==X.ByPosNoHeight?X.ByPosNoHeight:X.ByPos;return h?a.join(this.right.lineAt(l,f,i,o,l)):this.left.lineAt(l,f,i,n,s).join(a)}forEachLine(t,e,i,n,s,o){let l=n+this.left.height,h=s+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,n,s,o),e>=h&&this.right.forEachLine(t,e,i,l,h,o);else{let a=this.lineAt(h,X.ByPos,i,n,s);t<a.from&&this.left.forEachLine(t,a.from-1,i,n,s,o),a.to>=t&&a.from<=e&&o(a),e>a.to&&this.right.forEachLine(a.to+1,e,i,l,h,o)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let s=[];t>0&&this.decomposeLeft(t,s);let o=s.length;for(let l of i)s.push(l);if(t>0&&Go(s,o-1),e<this.length){let l=s.length;this.decomposeRight(e,s),Go(s,l)}return Tt.of(s)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Tt.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:s,right:o}=this,l=e+s.length+this.break,h=null;return n&&n.from<=e+s.length&&n.more?h=s=s.updateHeight(t,e,i,n):s.updateHeight(t,e,i),n&&n.from<=l+o.length&&n.more?h=o=o.updateHeight(t,l,i,n):o.updateHeight(t,l,i),h?this.balanced(s,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Go(r,t){let e,i;r[t]==null&&(e=r[t-1])instanceof dt&&(i=r[t+1])instanceof dt&&r.splice(t-1,3,new dt(e.length+1+i.length))}const Gu=5;class Rs{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let i=Math.min(e,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof Lt?n.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new Lt(i-this.pos,-1)),this.writtenTo=i,e>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let s=e-t;i.block?this.addBlock(new Gh(s,n,i.type)):(s||n>=Gu)&&this.addLineDeco(n,s)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Lt(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new dt(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Lt)return t;let e=new Lt(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type==ot.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=ot.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(e instanceof Lt)&&!this.isCovered?this.nodes.push(new Lt(0,-1)):(this.writtenTo<this.pos||e==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=t;for(let n of this.nodes)n instanceof Lt&&n.updateHeight(this.oracle,i),i+=n?n.length:1;return this.nodes}static build(t,e,i,n){let s=new Rs(i,t);return q.spans(e,i,n,s,0),s.finish(i)}}function qu(r,t,e){let i=new Ku;return q.compare(r,t,e,i,0),i.changes}class Ku{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&fs(t,e,this.changes,5)}}function Yu(r,t){let e=r.getBoundingClientRect(),i=Math.max(0,e.left),n=Math.min(innerWidth,e.right),s=Math.max(0,e.top),o=Math.min(innerHeight,e.bottom),l=r.ownerDocument.body;for(let h=r.parentNode;h&&h!=l;)if(h.nodeType==1){let a=h,f=window.getComputedStyle(a);if((a.scrollHeight>a.clientHeight||a.scrollWidth>a.clientWidth)&&f.overflow!="visible"){let u=a.getBoundingClientRect();i=Math.max(i,u.left),n=Math.min(n,u.right),s=Math.max(s,u.top),o=h==r.parentNode?u.bottom:Math.min(o,u.bottom)}h=f.position=="absolute"||f.position=="fixed"?a.offsetParent:a.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:i-e.left,right:Math.max(i,n)-e.left,top:s-(e.top+t),bottom:Math.max(s,o)-(e.top+t)}}function Qu(r,t){let e=r.getBoundingClientRect();return{left:0,right:e.right-e.left,top:t,bottom:e.bottom-(e.top+t)}}class Cr{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],s=e[i];if(n.from!=s.from||n.to!=s.to||n.size!=s.size)return!1}return!0}draw(t){return tt.replace({widget:new Ju(this.size,t)}).range(this.from,this.to)}}class Ju extends zi{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class qo{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new Wu,this.scaler=Qo,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=ut.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=t.facet(Ei).filter(e=>typeof e!="function"),this.heightMap=Tt.empty().applyChanges(this.stateDeco,G.empty,this.heightOracle.setDoc(t.doc),[new ue(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=tt.set(this.lineGaps.map(e=>e.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some(({from:s,to:o})=>n>=s&&n<=o)){let{from:s,to:o}=this.lineBlockAt(n);t.push(new ji(s,o))}}this.viewports=t.sort((i,n)=>i.from-n.from),this.scaler=this.heightMap.height<=7e6?Qo:new tc(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,t=>{this.viewportLines.push(this.scaler.scale==1?t:Si(t,this.scaler))})}update(t,e=null){this.state=t.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Ei).filter(a=>typeof a!="function");let n=t.changedRanges,s=ue.extendWithRanges(n,qu(i,this.stateDeco,t?t.changes:at.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),s),this.heightMap.height!=o&&(t.flags|=2);let l=s.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||t.flags&2||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,s=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?ut.RTL:ut.LTR;let o=this.heightOracle.mustRefreshForWrapping(s),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight;this.contentDOMHeight=e.clientHeight,this.mustMeasureContent=!1;let h=0,a=0,f=parseInt(i.paddingTop)||0,u=parseInt(i.paddingBottom)||0;(this.paddingTop!=f||this.paddingBottom!=u)&&(this.paddingTop=f,this.paddingBottom=u,h|=10),this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8);let c=(this.printing?Qu:Yu)(e,this.paddingTop),d=c.top-this.pixelViewport.top,p=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let x=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(x!=this.inView&&(this.inView=x,x&&(l=!0)),!this.inView)return 0;let S=e.clientWidth;if((this.contentDOMWidth!=S||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=S,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let B=t.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(B)&&(o=!0),o||n.lineWrapping&&Math.abs(S-this.contentDOMWidth)>n.charWidth){let{lineHeight:C,charWidth:y}=t.docView.measureTextSize();o=n.refresh(s,C,y,S/y,B),o&&(t.docView.minWidth=0,h|=8)}d>0&&p>0?a=Math.max(d,p):d<0&&p<0&&(a=Math.min(d,p)),n.heightChanged=!1;for(let C of this.viewports){let y=C.from==this.viewport.from?B:t.docView.measureVisibleLineHeights(C);this.heightMap=this.heightMap.updateHeight(n,0,o,new $u(C.from,y))}n.heightChanged&&(h|=2)}let k=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return k&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(h&2||k)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,s=this.state.doc,{visibleTop:o,visibleBottom:l}=this,h=new ji(n.lineAt(o-i*1e3,X.ByHeight,s,0,0).from,n.lineAt(l+(1-i)*1e3,X.ByHeight,s,0,0).to);if(e){let{head:a}=e.range;if(a<h.from||a>h.to){let f=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=n.lineAt(a,X.ByPos,s,0,0),c;e.y=="center"?c=(u.top+u.bottom)/2-f/2:e.y=="start"||e.y=="nearest"&&a<h.from?c=u.top:c=u.bottom-f,h=new ji(n.lineAt(c-1e3/2,X.ByHeight,s,0,0).from,n.lineAt(c+f+1e3/2,X.ByHeight,s,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new ji(this.heightMap.lineAt(i,X.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,X.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,X.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(e,X.ByPos,this.state.doc,0,0),{visibleTop:o,visibleBottom:l}=this;return(t==0||n<=o-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||s>=l+Math.max(10,Math.min(i,250)))&&n>o-2*1e3&&s<l+2*1e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new Cr(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.defaultTextDirection!=ut.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n=Xu(i.from,i.to,this.stateDeco);if(n.total<4e3)continue;let s,o;if(this.heightOracle.lineWrapping){let a=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=Gi(n,(this.visibleTop-i.top-a)/i.height),o=Gi(n,(this.visibleBottom-i.top+a)/i.height)}else{let a=n.total*this.heightOracle.charWidth,f=2e3*this.heightOracle.charWidth;s=Gi(n,(this.pixelViewport.left-f)/a),o=Gi(n,(this.pixelViewport.right+f)/a)}let l=[];s>i.from&&l.push({from:i.from,to:s}),o<i.to&&l.push({from:o,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&Yo(l,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&Yo(l,h.to-10,h.to+10);for(let{from:a,to:f}of l)f-a>1e3&&e.push(Zu(t,u=>u.from>=i.from&&u.to<=i.to&&Math.abs(u.from-a)<1e3&&Math.abs(u.to-f)<1e3)||new Cr(a,f,this.gapSize(i,a,f,n)))}return e}gapSize(t,e,i,n){let s=Ko(n,i)-Ko(n,e);return this.heightOracle.lineWrapping?t.height*s:n.total*this.heightOracle.charWidth*s}updateLineGaps(t){Cr.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=tt.set(t.map(e=>e.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];q.spans(t,this.viewport.from,this.viewport.to,{span(n,s){e.push({from:n,to:s})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some((n,s)=>n.from!=e[s].from||n.to!=e[s].to);return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(e=>e.from<=t&&e.to>=t)||Si(this.heightMap.lineAt(t,X.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return Si(this.heightMap.lineAt(this.scaler.fromDOM(t),X.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return Si(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class ji{constructor(t,e){this.from=t,this.to=e}}function Xu(r,t,e){let i=[],n=r,s=0;return q.spans(e,r,t,{span(){},point(o,l){o>n&&(i.push({from:n,to:o}),s+=o-n),n=l}},20),n<t&&(i.push({from:n,to:t}),s+=t-n),{total:s,ranges:i}}function Gi({total:r,ranges:t},e){if(e<=0)return t[0].from;if(e>=1)return t[t.length-1].to;let i=Math.floor(r*e);for(let n=0;;n++){let{from:s,to:o}=t[n],l=o-s;if(i<=l)return s+i;i-=l}}function Ko(r,t){let e=0;for(let{from:i,to:n}of r.ranges){if(t<=n){e+=t-i;break}e+=n-i}return e/r.total}function Yo(r,t,e){for(let i=0;i<r.length;i++){let n=r[i];if(n.from<e&&n.to>t){let s=[];n.from<t&&s.push({from:n.from,to:t}),n.to>e&&s.push({from:e,to:n.to}),r.splice(i,1,...s),i+=s.length-1}}}function Zu(r,t){for(let e of r)if(t(e))return e}const Qo={toDOM(r){return r},fromDOM(r){return r},scale:1};class tc{constructor(t,e,i){let n=0,s=0,o=0;this.viewports=i.map(({from:l,to:h})=>{let a=e.lineAt(l,X.ByPos,t,0,0).top,f=e.lineAt(h,X.ByPos,t,0,0).bottom;return n+=f-a,{from:l,to:h,top:a,bottom:f,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(e.height-n);for(let l of this.viewports)l.domTop=o+(l.top-s)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),s=l.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.top)return n+(t-i)*this.scale;if(t<=s.bottom)return s.domTop+(t-s.top);i=s.bottom,n=s.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.domTop)return i+(t-n)/this.scale;if(t<=s.domBottom)return s.top+(t-s.domTop);i=s.bottom,n=s.domBottom}}}function Si(r,t){if(t.scale==1)return r;let e=t.toDOM(r.top),i=t.toDOM(r.bottom);return new Oe(r.from,r.length,e,i-e,Array.isArray(r.type)?r.type.map(n=>Si(n,t)):r.type)}const qi=P.define({combine:r=>r.join(" ")}),bs=P.define({combine:r=>r.indexOf(!0)>-1}),ys=ii.newName(),qh=ii.newName(),Kh=ii.newName(),Yh={"&light":"."+qh,"&dark":"."+Kh};function ws(r,t,e){return new ii(t,{finish(i){return/&/.test(i)?i.replace(/&\w*/,n=>{if(n=="&")return r;if(!e||!e[n])throw new RangeError(`Unsupported selector: ${n}`);return e[n]}):r+" "+i}})}const ec=ws("."+ys,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Yh),ic={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Or=M.ie&&M.ie_version<=11;class nc{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new eu,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(n=>{for(let s of n)this.queue.push(s);(M.ie&&M.ie_version<=11||M.ios&&t.composing)&&n.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),Or&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(t.scrollDOM)),this.addWindowListeners(this.win=t.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(n=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),n.length>0&&n[n.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(n=>{n.length>0&&n[n.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((e,i)=>e!=t[i]))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){let e=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,n=this.selectionRange;if(i.state.facet(hr)?i.root.activeElement!=this.dom:!dn(i.dom,n))return;let s=n.anchorNode&&i.docView.nearest(n.anchorNode);if(s&&s.ignoreEvent(t)){e||(this.selectionChanged=!1);return}(M.ie&&M.ie_version<=11||M.android&&M.chrome)&&!i.state.selection.main.empty&&n.focusNode&&_n(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:t}=this,e=M.safari&&t.root.nodeType==11&&Xf(this.dom.ownerDocument)==this.dom&&rc(this.view)||Tn(t.root);if(!e||this.selectionRange.eq(e))return!1;let i=dn(this.dom,e);return i&&!this.selectionChanged&&t.inputState.lastFocusTime>Date.now()-200&&t.inputState.lastTouchTime<Date.now()-300&&nu(this.dom,e)?(this.view.inputState.lastFocusTime=0,t.docView.updateSelection(),!1):(this.selectionRange.setRange(e),i&&(this.selectionChanged=!0),!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(i.nodeType==1)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=e)i.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,ic),Or&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){!this.active||(this.active=!1,this.observer.disconnect(),Or&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){var i;this.delayedAndroidKey||this.view.win.requestAnimationFrame(()=>{let n=this.delayedAndroidKey;this.delayedAndroidKey=null,this.delayedFlush=-1,!this.flush()&&n.force&&_i(this.dom,n.key,n.keyCode)}),(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:e,force:this.lastChange<Date.now()-50||!!(!((i=this.delayedAndroidKey)===null||i===void 0)&&i.force)})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}processRecords(){let t=this.queue;for(let s of this.observer.takeRecords())t.push(s);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let s of t){let o=this.readMutation(s);!o||(o.typeOver&&(n=!0),e==-1?{from:e,to:i}=o:(e=Math.min(o.from,e),i=Math.max(o.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),s=this.selectionChanged&&dn(this.dom,this.selectionRange);if(e<0&&!s)return!1;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let o=this.view.state,l=this.onChange(e,i,n);return this.view.state==o&&this.view.update([]),l}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty(t.type=="attributes"),t.type=="attributes"&&(e.dirty|=4),t.type=="childList"){let i=Jo(e,t.previousSibling||t.target.previousSibling,-1),n=Jo(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}setWindow(t){t!=this.win&&(this.removeWindowListeners(this.win),this.win=t,this.addWindowListeners(this.win))}addWindowListeners(t){t.addEventListener("resize",this.onResize),t.addEventListener("beforeprint",this.onPrint),t.addEventListener("scroll",this.onScroll),t.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(t){t.removeEventListener("scroll",this.onScroll),t.removeEventListener("resize",this.onResize),t.removeEventListener("beforeprint",this.onPrint),t.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var t,e,i;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(e=this.gapIntersection)===null||e===void 0||e.disconnect(),(i=this.resize)===null||i===void 0||i.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function Jo(r,t,e){for(;t;){let i=Z.get(t);if(i&&i.parent==r)return i;let n=t.parentNode;t=n!=r.dom?n:e>0?t.nextSibling:t.previousSibling}return null}function rc(r){let t=null;function e(h){h.preventDefault(),h.stopImmediatePropagation(),t=h.getTargetRanges()[0]}if(r.contentDOM.addEventListener("beforeinput",e,!0),r.dom.ownerDocument.execCommand("indent"),r.contentDOM.removeEventListener("beforeinput",e,!0),!t)return null;let i=t.startContainer,n=t.startOffset,s=t.endContainer,o=t.endOffset,l=r.docView.domAtPos(r.state.selection.main.anchor);return _n(l.node,l.offset,s,o)&&([i,n,s,o]=[s,o,i,n]),{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:o}}function sc(r,t,e,i){let n,s,o=r.state.selection.main;if(t>-1){let l=r.docView.domBoundsAround(t,e,0);if(!l||r.state.readOnly)return!1;let{from:h,to:a}=l,f=r.docView.impreciseHead||r.docView.impreciseAnchor?[]:lc(r),u=new Ih(f,r.state);u.readRange(l.startDOM,l.endDOM);let c=o.from,d=null;(r.inputState.lastKeyCode===8&&r.inputState.lastKeyTime>Date.now()-100||M.android&&u.text.length<a-h)&&(c=o.to,d="end");let p=oc(r.state.doc.sliceString(h,a,Ce),u.text,c-h,d);p&&(M.chrome&&r.inputState.lastKeyCode==13&&p.toB==p.from+2&&u.text.slice(p.from,p.toB)==Ce+Ce&&p.toB--,n={from:h+p.from,to:h+p.toA,insert:G.of(u.text.slice(p.from,p.toB).split(Ce))}),s=hc(f,h)}else if(r.hasFocus||!r.state.facet(hr)){let l=r.observer.selectionRange,{impreciseHead:h,impreciseAnchor:a}=r.docView,f=h&&h.node==l.focusNode&&h.offset==l.focusOffset||!ni(r.contentDOM,l.focusNode)?r.state.selection.main.head:r.docView.posFromDOM(l.focusNode,l.focusOffset),u=a&&a.node==l.anchorNode&&a.offset==l.anchorOffset||!ni(r.contentDOM,l.anchorNode)?r.state.selection.main.anchor:r.docView.posFromDOM(l.anchorNode,l.anchorOffset);(f!=o.head||u!=o.anchor)&&(s=O.single(u,f))}if(!n&&!s)return!1;if(!n&&i&&!o.empty&&s&&s.main.empty?n={from:o.from,to:o.to,insert:r.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4?n={from:o.from,to:o.to,insert:r.state.doc.slice(o.from,n.from).append(n.insert).append(r.state.doc.slice(n.to,o.to))}:(M.mac||M.android)&&n&&n.from==n.to&&n.from==o.head-1&&n.insert.toString()=="."&&(n={from:o.from,to:o.to,insert:G.of([" "])}),n){let l=r.state;if(M.ios&&r.inputState.flushIOSKey(r)||M.android&&(n.from==o.from&&n.to==o.to&&n.insert.length==1&&n.insert.lines==2&&_i(r.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&n.insert.length==0&&_i(r.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&n.insert.length==0&&_i(r.contentDOM,"Delete",46)))return!0;let h=n.insert.toString();if(r.state.facet(Th).some(u=>u(r,n.from,n.to,h)))return!0;r.inputState.composing>=0&&r.inputState.composing++;let a;if(n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!s||s.main.empty&&s.main.from==n.from+n.insert.length)&&r.inputState.composing<0){let u=o.from<n.from?l.sliceDoc(o.from,n.from):"",c=o.to>n.to?l.sliceDoc(n.to,o.to):"";a=l.replaceSelection(r.state.toText(u+n.insert.sliceString(0,void 0,r.state.lineBreak)+c))}else{let u=l.changes(n),c=s&&!l.selection.main.eq(s.main)&&s.main.to<=u.newLength?s.main:void 0;if(l.selection.ranges.length>1&&r.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let d=r.state.sliceDoc(n.from,n.to),p=Eh(r)||r.state.doc.lineAt(o.head),x=o.to-n.to,S=o.to-o.from;a=l.changeByRange(k=>{if(k.from==o.from&&k.to==o.to)return{changes:u,range:c||k.map(u)};let B=k.to-x,C=B-d.length;if(k.to-k.from!=S||r.state.sliceDoc(C,B)!=d||p&&k.to>=p.from&&k.from<=p.to)return{range:k};let y=l.changes({from:C,to:B,insert:n.insert}),v=k.to-o.to;return{changes:y,range:c?O.range(Math.max(0,c.anchor+v),Math.max(0,c.head+v)):k.map(y)}})}else a={changes:u,selection:c&&l.selection.replaceRange(c)}}let f="input.type";return r.composing&&(f+=".compose",r.inputState.compositionFirstChange&&(f+=".start",r.inputState.compositionFirstChange=!1)),r.dispatch(a,{scrollIntoView:!0,userEvent:f}),!0}else if(s&&!s.main.eq(o)){let l=!1,h="select";return r.inputState.lastSelectionTime>Date.now()-50&&(r.inputState.lastSelectionOrigin=="select"&&(l=!0),h=r.inputState.lastSelectionOrigin),r.dispatch({selection:s,scrollIntoView:l,userEvent:h}),!0}else return!1}function oc(r,t,e,i){let n=Math.min(r.length,t.length),s=0;for(;s<n&&r.charCodeAt(s)==t.charCodeAt(s);)s++;if(s==n&&r.length==t.length)return null;let o=r.length,l=t.length;for(;o>0&&l>0&&r.charCodeAt(o-1)==t.charCodeAt(l-1);)o--,l--;if(i=="end"){let h=Math.max(0,s-Math.min(o,l));e-=o+h-s}return o<s&&r.length<t.length?(s-=e<=s&&e>=o?s-e:0,l=s+(l-o),o=s):l<s&&(s-=e<=s&&e>=l?s-e:0,o=s+(o-l),l=s),{from:s,toA:o,toB:l}}function lc(r){let t=[];if(r.root.activeElement!=r.contentDOM)return t;let{anchorNode:e,anchorOffset:i,focusNode:n,focusOffset:s}=r.observer.selectionRange;return e&&(t.push(new Lo(e,i)),(n!=e||s!=i)&&t.push(new Lo(n,s))),t}function hc(r,t){if(r.length==0)return null;let e=r[0].pos,i=r.length==2?r[1].pos:e;return e>-1&&i>-1?O.single(e+t,i+t):null}class F{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(e=>this.update([e])),this.dispatch=this.dispatch.bind(this),this._root=t.root||iu(t.parent)||document,this.viewState=new qo(t.state||j.create(t)),this.plugins=this.state.facet(ki).map(e=>new vr(e));for(let e of this.plugins)e.update(this);this.observer=new nc(this,(e,i,n)=>sc(this,e,i,n),e=>{this.inputState.runScrollHandlers(this,e),this.observer.intersecting&&this.measure()}),this.inputState=new Mu(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new Mo(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView}dispatch(...t){this._dispatch(t.length==1&&t[0]instanceof ft?t[0]:this.state.update(...t))}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,i=!1,n,s=this.state;for(let l of t){if(l.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=l.state}if(this.destroyed){this.viewState.state=s;return}if(this.observer.clear(),s.facet(j.phrases)!=this.state.facet(j.phrases))return this.setState(s);n=Bn.create(this,s,t);let o=this.viewState.scrollTarget;try{this.updateState=2;for(let l of t){if(o&&(o=o.map(l.changes)),l.scrollIntoView){let{main:h}=l.state.selection;o=new Mn(h.empty?h:O.cursor(h.head,h.head>h.anchor?-1:1))}for(let h of l.effects)h.is(To)&&(o=h.value)}this.viewState.update(n,o),this.bidiCache=Pn.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),e=this.docView.update(n),this.state.facet(vi)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(e,t.some(l=>l.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(qi)!=n.state.facet(qi)&&(this.viewState.mustMeasureContent=!0),(e||i||o||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!n.empty)for(let l of this.state.facet(us))l(n)}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let e=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new qo(t),this.plugins=t.facet(ki).map(i=>new vr(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new Mo(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(ki),i=t.state.facet(ki);if(e!=i){let n=[];for(let s of i){let o=e.indexOf(s);if(o<0)n.push(new vr(s));else{let l=this.plugins[o];l.mustUpdate=t,n.push(l)}}for(let s of this.plugins)s.mustUpdate!=t&&s.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let n of this.plugins)n.mustUpdate=t;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.forceFlush();let e=null,{scrollHeight:i,scrollTop:n,clientHeight:s}=this.scrollDOM,o=n>i-s-4?i:n;try{for(let l=0;;l++){this.updateState=1;let h=this.viewport,a=this.viewState.lineBlockAtHeight(o),f=this.viewState.measure(this);if(!f&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let u=[];f&4||([this.measureRequests,u]=[u,this.measureRequests]);let c=u.map(S=>{try{return S.read(this)}catch(k){return Zt(this.state,k),Xo}}),d=Bn.create(this,this.state,[]),p=!1,x=!1;d.flags|=f,e?e.flags|=f:e=d,this.updateState=2,d.empty||(this.updatePlugins(d),this.inputState.update(d),this.updateAttrs(),p=this.docView.update(d));for(let S=0;S<u.length;S++)if(c[S]!=Xo)try{let k=u[S];k.write&&k.write(c[S],this)}catch(k){Zt(this.state,k)}if(this.viewState.scrollTarget)this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,x=!0;else{let S=this.viewState.lineBlockAt(a.from).top-a.top;(S>1||S<-1)&&(this.scrollDOM.scrollTop+=S,x=!0)}if(p&&this.docView.updateSelection(!0),this.viewport.from==h.from&&this.viewport.to==h.to&&!x&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let l of this.state.facet(us))l(e)}get themeClasses(){return ys+" "+(this.state.facet(bs)?Kh:qh)+" "+this.state.facet(qi)}updateAttrs(){let t=Zo(this,Lh,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(hr)?"true":"false",class:"cm-content",style:`${M.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),Zo(this,Mh,e);let i=this.observer.ignore(()=>{let n=as(this.contentDOM,this.contentAttrs,e),s=as(this.dom,this.editorAttrs,t);return n||s});return this.editorAttrs=t,this.contentAttrs=e,i}showAnnouncements(t){let e=!0;for(let i of t)for(let n of i.effects)if(n.is(F.announce)){e&&(this.announceDOM.textContent=""),e=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(vi),ii.mount(this.root,this.styleModules.concat(ec).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),t){if(t.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key){this.measureRequests[e]=t;return}}this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(e===void 0||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find(i=>i.spec==t)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return Ar(this,t,Io(this,t,e,i))}moveByGroup(t,e){return Ar(this,t,Io(this,t,e,i=>_u(this,t.head,i)))}moveToLineBoundary(t,e,i=!0){return Tu(this,t,e,i)}moveVertically(t,e,i){return Ar(this,t,Lu(this,t,e,i))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),Vh(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),s=this.bidiSpans(n),o=s[ti.find(s,t-n.from,-1,e)];return sr(i,o.dir==ut.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(_h)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>ac)return Nh(t.length);let e=this.textDirectionAt(t.from);for(let n of this.bidiCache)if(n.from==t.from&&n.dir==e)return n.order;let i=du(t.text,e);return this.bidiCache.push(new Pn(t.from,t.to,e,i)),i}get hasFocus(){var t;return(this.dom.ownerDocument.hasFocus()||M.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{fh(this.contentDOM),this.docView.updateSelection()})}setRoot(t){this._root!=t&&(this._root=t,this.observer.setWindow((t.nodeType==9?t:t.ownerDocument).defaultView),this.mountStyles())}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return To.of(new Mn(typeof t=="number"?O.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return ne.define(()=>({}),{eventHandlers:t})}static theme(t,e){let i=ii.newName(),n=[qi.of(i),vi.of(ws(`.${i}`,t))];return e&&e.dark&&n.push(bs.of(!0)),n}static baseTheme(t){return Jl.lowest(vi.of(ws("."+ys,t,Yh)))}static findFromDOM(t){var e;let i=t.querySelector(".cm-content"),n=i&&Z.get(i)||Z.get(t);return((e=n==null?void 0:n.rootView)===null||e===void 0?void 0:e.view)||null}}F.styleModule=vi;F.inputHandler=Th;F.perLineTextDirection=_h;F.exceptionSink=Oh;F.updateListener=us;F.editable=hr;F.mouseSelectionStyle=Ch;F.dragMovesSelection=Ah;F.clickAddsSelectionRange=Sh;F.decorations=Ei;F.atomicRanges=Bh;F.scrollMargins=Ph;F.darkTheme=bs;F.contentAttributes=Mh;F.editorAttributes=Lh;F.lineWrapping=F.contentAttributes.of({class:"cm-lineWrapping"});F.announce=J.define();const ac=4096,Xo={};class Pn{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:ut.LTR;for(let s=Math.max(0,t.length-10);s<t.length;s++){let o=t[s];o.dir==n&&!e.touchesRange(o.from,o.to)&&i.push(new Pn(e.mapPos(o.from,1),e.mapPos(o.to,-1),o.dir,o.order))}return i}}function Zo(r,t,e){for(let i=r.state.facet(t),n=i.length-1;n>=0;n--){let s=i[n],o=typeof s=="function"?s(r):s;o&&hs(o,e)}return e}const fc=M.mac?"mac":M.windows?"win":M.linux?"linux":"key";function uc(r,t){const e=r.split(/-(?!$)/);let i=e[e.length-1];i=="Space"&&(i=" ");let n,s,o,l;for(let h=0;h<e.length-1;++h){const a=e[h];if(/^(cmd|meta|m)$/i.test(a))l=!0;else if(/^a(lt)?$/i.test(a))n=!0;else if(/^(c|ctrl|control)$/i.test(a))s=!0;else if(/^s(hift)?$/i.test(a))o=!0;else if(/^mod$/i.test(a))t=="mac"?l=!0:s=!0;else throw new Error("Unrecognized modifier name: "+a)}return n&&(i="Alt-"+i),s&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function Ki(r,t,e){return t.altKey&&(r="Alt-"+r),t.ctrlKey&&(r="Ctrl-"+r),t.metaKey&&(r="Meta-"+r),e!==!1&&t.shiftKey&&(r="Shift-"+r),r}const cc=Jl.default(F.domEventHandlers({keydown(r,t){return mc(dc(t.state),r,t,"editor")}})),Qh=P.define({enables:cc}),tl=new WeakMap;function dc(r){let t=r.facet(Qh),e=tl.get(t);return e||tl.set(t,e=gc(t.reduce((i,n)=>i.concat(n),[]))),e}let ve=null;const pc=4e3;function gc(r,t=fc){let e=Object.create(null),i=Object.create(null),n=(o,l)=>{let h=i[o];if(h==null)i[o]=l;else if(h!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},s=(o,l,h,a)=>{let f=e[o]||(e[o]=Object.create(null)),u=l.split(/ (?!$)/).map(p=>uc(p,t));for(let p=1;p<u.length;p++){let x=u.slice(0,p).join(" ");n(x,!0),f[x]||(f[x]={preventDefault:!0,commands:[S=>{let k=ve={view:S,prefix:x,scope:o};return setTimeout(()=>{ve==k&&(ve=null)},pc),!0}]})}let c=u.join(" ");n(c,!1);let d=f[c]||(f[c]={preventDefault:!1,commands:[]});d.commands.push(h),a&&(d.preventDefault=!0)};for(let o of r){let l=o[t]||o.key;if(!!l)for(let h of o.scope?o.scope.split(" "):["editor"])s(h,l,o.run,o.preventDefault),o.shift&&s(h,"Shift-"+l,o.shift,o.preventDefault)}return e}function mc(r,t,e,i){let n=Jf(t),s=un(n,0),o=jr(s)==n.length&&n!=" ",l="",h=!1;ve&&ve.view==e&&ve.scope==i&&(l=ve.prefix+" ",(h=Hh.indexOf(t.keyCode)<0)&&(ve=null));let a=d=>{if(d){for(let p of d.commands)if(p(e))return!0;d.preventDefault&&(h=!0)}return!1},f=r[i],u,c;if(f){if(a(f[l+Ki(n,t,!o)]))return!0;if(o&&(t.shiftKey||t.altKey||t.metaKey||s>127)&&(u=Be[t.keyCode])&&u!=n){if(a(f[l+Ki(u,t,!0)]))return!0;if(t.shiftKey&&(c=Ni[t.keyCode])!=n&&c!=u&&a(f[l+Ki(c,t,!1)]))return!0}else if(o&&t.shiftKey&&a(f[l+Ki(n,t,!0)]))return!0}return h}const bc=!M.ios,yc={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};bc&&(yc[".cm-line"].caretColor="transparent !important");const Tr="-10000px";class Jh{constructor(t,e,i){this.facet=e,this.createTooltipView=i,this.input=t.state.facet(e),this.tooltips=this.input.filter(n=>n),this.tooltipViews=this.tooltips.map(i)}update(t){let e=t.state.facet(this.facet),i=e.filter(s=>s);if(e===this.input){for(let s of this.tooltipViews)s.update&&s.update(t);return!1}let n=[];for(let s=0;s<i.length;s++){let o=i[s],l=-1;if(!!o){for(let h=0;h<this.tooltips.length;h++){let a=this.tooltips[h];a&&a.create==o.create&&(l=h)}if(l<0)n[s]=this.createTooltipView(o);else{let h=n[s]=this.tooltipViews[l];h.update&&h.update(t)}}}for(let s of this.tooltipViews)n.indexOf(s)<0&&s.dom.remove();return this.input=e,this.tooltips=i,this.tooltipViews=n,!0}}function wc(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}const _r=P.define({combine:r=>{var t,e,i;return{position:M.ios?"absolute":((t=r.find(n=>n.position))===null||t===void 0?void 0:t.position)||"fixed",parent:((e=r.find(n=>n.parent))===null||e===void 0?void 0:e.parent)||null,tooltipSpace:((i=r.find(n=>n.tooltipSpace))===null||i===void 0?void 0:i.tooltipSpace)||wc}}}),xc=ne.fromClass(class{constructor(r){this.view=r,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let t=r.state.facet(_r);this.position=t.position,this.parent=t.parent,this.classes=r.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new Jh(r,Is,e=>this.createTooltip(e)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(e=>{Date.now()>this.lastTransaction-50&&e.length>0&&e[e.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),r.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let r of this.manager.tooltipViews)this.intersectionObserver.observe(r.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(r){r.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(r);t&&this.observeIntersection();let e=t||r.geometryChanged,i=r.state.facet(_r);if(i.position!=this.position){this.position=i.position;for(let n of this.manager.tooltipViews)n.dom.style.position=this.position;e=!0}if(i.parent!=this.parent){this.parent&&this.container.remove(),this.parent=i.parent,this.createContainer();for(let n of this.manager.tooltipViews)this.container.appendChild(n.dom);e=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);e&&this.maybeMeasure()}createTooltip(r){let t=r.create(this.view);if(t.dom.classList.add("cm-tooltip"),r.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let e=document.createElement("div");e.className="cm-tooltip-arrow",t.dom.appendChild(e)}return t.dom.style.position=this.position,t.dom.style.top=Tr,this.container.appendChild(t.dom),t.mount&&t.mount(this.view),t}destroy(){var r;this.view.win.removeEventListener("resize",this.measureSoon);for(let{dom:t}of this.manager.tooltipViews)t.remove();(r=this.intersectionObserver)===null||r===void 0||r.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let r=this.view.dom.getBoundingClientRect();return{editor:r,parent:this.parent?this.container.getBoundingClientRect():r,pos:this.manager.tooltips.map((t,e)=>{let i=this.manager.tooltipViews[e];return i.getCoords?i.getCoords(t.pos):this.view.coordsAtPos(t.pos)}),size:this.manager.tooltipViews.map(({dom:t})=>t.getBoundingClientRect()),space:this.view.state.facet(_r).tooltipSpace(this.view)}}writeMeasure(r){let{editor:t,space:e}=r,i=[];for(let n=0;n<this.manager.tooltips.length;n++){let s=this.manager.tooltips[n],o=this.manager.tooltipViews[n],{dom:l}=o,h=r.pos[n],a=r.size[n];if(!h||h.bottom<=Math.max(t.top,e.top)||h.top>=Math.min(t.bottom,e.bottom)||h.right<Math.max(t.left,e.left)-.1||h.left>Math.min(t.right,e.right)+.1){l.style.top=Tr;continue}let f=s.arrow?o.dom.querySelector(".cm-tooltip-arrow"):null,u=f?7:0,c=a.right-a.left,d=a.bottom-a.top,p=o.offset||vc,x=this.view.textDirection==ut.LTR,S=a.width>e.right-e.left?x?e.left:e.right-a.width:x?Math.min(h.left-(f?14:0)+p.x,e.right-c):Math.max(e.left,h.left-c+(f?14:0)-p.x),k=!!s.above;!s.strictSide&&(k?h.top-(a.bottom-a.top)-p.y<e.top:h.bottom+(a.bottom-a.top)+p.y>e.bottom)&&k==e.bottom-h.bottom>h.top-e.top&&(k=!k);let B=k?h.top-d-u-p.y:h.bottom+u+p.y,C=S+c;if(o.overlap!==!0)for(let y of i)y.left<C&&y.right>S&&y.top<B+d&&y.bottom>B&&(B=k?y.top-d-2-u:y.bottom+u+2);this.position=="absolute"?(l.style.top=B-r.parent.top+"px",l.style.left=S-r.parent.left+"px"):(l.style.top=B+"px",l.style.left=S+"px"),f&&(f.style.left=`${h.left+(x?p.x:-p.x)-(S+14-7)}px`),o.overlap!==!0&&i.push({left:S,top:B,right:C,bottom:B+d}),l.classList.toggle("cm-tooltip-above",k),l.classList.toggle("cm-tooltip-below",!k),o.positioned&&o.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let r of this.manager.tooltipViews)r.dom.style.top=Tr}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),kc=F.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:`${7}px`,width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:`${7}px solid transparent`,borderRight:`${7}px solid transparent`},".cm-tooltip-above &":{bottom:`-${7}px`,"&:before":{borderTop:`${7}px solid #bbb`},"&:after":{borderTop:`${7}px solid #f5f5f5`,bottom:"1px"}},".cm-tooltip-below &":{top:`-${7}px`,"&:before":{borderBottom:`${7}px solid #bbb`},"&:after":{borderBottom:`${7}px solid #f5f5f5`,top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),vc={x:0,y:0},Is=P.define({enables:[xc,kc]}),Dn=P.define();class Es{constructor(t){this.view=t,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new Jh(t,Dn,e=>this.createHostedView(e))}static create(t){return new Es(t)}createHostedView(t){let e=t.create(this.view);return e.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(e.dom),this.mounted&&e.mount&&e.mount(this.view),e}mount(t){for(let e of this.manager.tooltipViews)e.mount&&e.mount(t);this.mounted=!0}positioned(){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned()}update(t){this.manager.update(t)}}const Sc=Is.compute([Dn],r=>{let t=r.facet(Dn).filter(e=>e);return t.length===0?null:{pos:Math.min(...t.map(e=>e.pos)),end:Math.max(...t.filter(e=>e.end!=null).map(e=>e.end)),create:Es.create,above:t[0].above,arrow:t.some(e=>e.arrow)}});class Ac{constructor(t,e,i,n,s){this.view=t,this.source=e,this.field=i,this.setHover=n,this.hoverTime=s,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:t.dom,time:0},this.checkHover=this.checkHover.bind(this),t.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),t.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let t=Date.now()-this.lastMove.time;t<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-t):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{lastMove:t}=this,e=this.view.contentDOM.contains(t.target)?this.view.posAtCoords(t):null;if(e==null)return;let i=this.view.coordsAtPos(e);if(i==null||t.y<i.top||t.y>i.bottom||t.x<i.left-this.view.defaultCharacterWidth||t.x>i.right+this.view.defaultCharacterWidth)return;let n=this.view.bidiSpans(this.view.state.doc.lineAt(e)).find(l=>l.from<=e&&l.to>=e),s=n&&n.dir==ut.RTL?-1:1,o=this.source(this.view,e,t.x<i.left?-s:s);if(o!=null&&o.then){let l=this.pending={pos:e};o.then(h=>{this.pending==l&&(this.pending=null,h&&this.view.dispatch({effects:this.setHover.of(h)}))},h=>Zt(this.view.state,h,"hover tooltip"))}else o&&this.view.dispatch({effects:this.setHover.of(o)})}mousemove(t){var e;this.lastMove={x:t.clientX,y:t.clientY,target:t.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let i=this.active;if(i&&!Cc(this.lastMove.target)||this.pending){let{pos:n}=i||this.pending,s=(e=i==null?void 0:i.end)!==null&&e!==void 0?e:n;(n==s?this.view.posAtCoords(this.lastMove)!=n:!Oc(this.view,n,s,t.clientX,t.clientY,6))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function Cc(r){for(let t=r;t;t=t.parentNode)if(t.nodeType==1&&t.classList.contains("cm-tooltip"))return!0;return!1}function Oc(r,t,e,i,n,s){let o=document.createRange(),l=r.domAtPos(t),h=r.domAtPos(e);o.setEnd(h.node,h.offset),o.setStart(l.node,l.offset);let a=o.getClientRects();o.detach();for(let f=0;f<a.length;f++){let u=a[f];if(Math.max(u.top-n,n-u.bottom,u.left-i,i-u.right)<=s)return!0}return!1}function Tc(r,t={}){let e=J.define(),i=Rt.define({create(){return null},update(n,s){if(n&&(t.hideOnChange&&(s.docChanged||s.selection)||t.hideOn&&t.hideOn(s,n)))return null;if(n&&s.docChanged){let o=s.changes.mapPos(n.pos,-1,Ct.TrackDel);if(o==null)return null;let l=Object.assign(Object.create(null),n);l.pos=o,n.end!=null&&(l.end=s.changes.mapPos(n.end)),n=l}for(let o of s.effects)o.is(e)&&(n=o.value),o.is(_c)&&(n=null);return n},provide:n=>Dn.from(n)});return[i,ne.define(n=>new Ac(n,r,i,e,t.hoverTime||300)),Sc]}const _c=J.define(),el=P.define({combine(r){let t,e;for(let i of r)t=t||i.topContainer,e=e||i.bottomContainer;return{topContainer:t,bottomContainer:e}}}),Lc=ne.fromClass(class{constructor(r){this.input=r.state.facet(xs),this.specs=this.input.filter(e=>e),this.panels=this.specs.map(e=>e(r));let t=r.state.facet(el);this.top=new Yi(r,!0,t.topContainer),this.bottom=new Yi(r,!1,t.bottomContainer),this.top.sync(this.panels.filter(e=>e.top)),this.bottom.sync(this.panels.filter(e=>!e.top));for(let e of this.panels)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}update(r){let t=r.state.facet(el);this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new Yi(r.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new Yi(r.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let e=r.state.facet(xs);if(e!=this.input){let i=e.filter(h=>h),n=[],s=[],o=[],l=[];for(let h of i){let a=this.specs.indexOf(h),f;a<0?(f=h(r.view),l.push(f)):(f=this.panels[a],f.update&&f.update(r)),n.push(f),(f.top?s:o).push(f)}this.specs=i,this.panels=n,this.top.sync(s),this.bottom.sync(o);for(let h of l)h.dom.classList.add("cm-panel"),h.mount&&h.mount()}else for(let i of this.panels)i.update&&i.update(r)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:r=>F.scrollMargins.of(t=>{let e=t.plugin(r);return e&&{top:e.top.scrollMargin(),bottom:e.bottom.scrollMargin()}})});class Yi{constructor(t,e,i){this.view=t,this.top=e,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(t){for(let e of this.panels)e.destroy&&t.indexOf(e)<0&&e.destroy();this.panels=t,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let e=this.container||this.view.dom;e.insertBefore(this.dom,this.top?e.firstChild:null)}let t=this.dom.firstChild;for(let e of this.panels)if(e.dom.parentNode==this.dom){for(;t!=e.dom;)t=il(t);t=t.nextSibling}else this.dom.insertBefore(e.dom,t);for(;t;)t=il(t)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let t of this.classes.split(" "))t&&this.container.classList.remove(t);for(let t of(this.classes=this.view.themeClasses).split(" "))t&&this.container.classList.add(t)}}}function il(r){let t=r.nextSibling;return r.remove(),t}const xs=P.define({enables:Lc});class me extends ei{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}}me.prototype.elementClass="";me.prototype.toDOM=void 0;me.prototype.mapMode=Ct.TrackBefore;me.prototype.startSide=me.prototype.endSide=-1;me.prototype.point=!0;const gn=P.define(),Mc={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>q.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Li=P.define();function Bc(r){return[Xh(),Li.of(Object.assign(Object.assign({},Mc),r))]}const ks=P.define({combine:r=>r.some(t=>t)});function Xh(r){let t=[Pc];return r&&r.fixed===!1&&t.push(ks.of(!0)),t}const Pc=ne.fromClass(class{constructor(r){this.view=r,this.prevViewport=r.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=r.state.facet(Li).map(t=>new rl(r,t));for(let t of this.gutters)this.dom.appendChild(t.dom);this.fixed=!r.state.facet(ks),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),r.scrollDOM.insertBefore(this.dom,r.contentDOM)}update(r){if(this.updateGutters(r)){let t=this.prevViewport,e=r.view.viewport,i=Math.min(t.to,e.to)-Math.max(t.from,e.from);this.syncGutters(i<(e.to-e.from)*.8)}r.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(ks)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=r.view.viewport}syncGutters(r){let t=this.dom.nextSibling;r&&this.dom.remove();let e=q.iter(this.view.state.facet(gn),this.view.viewport.from),i=[],n=this.gutters.map(s=>new Dc(s,this.view.viewport,-this.view.documentPadding.top));for(let s of this.view.viewportLineBlocks){let o;if(Array.isArray(s.type)){for(let l of s.type)if(l.type==ot.Text){o=l;break}}else o=s.type==ot.Text?s:void 0;if(!!o){i.length&&(i=[]),Zh(e,i,s.from);for(let l of n)l.line(this.view,o,i)}}for(let s of n)s.finish();r&&this.view.scrollDOM.insertBefore(this.dom,t)}updateGutters(r){let t=r.startState.facet(Li),e=r.state.facet(Li),i=r.docChanged||r.heightChanged||r.viewportChanged||!q.eq(r.startState.facet(gn),r.state.facet(gn),r.view.viewport.from,r.view.viewport.to);if(t==e)for(let n of this.gutters)n.update(r)&&(i=!0);else{i=!0;let n=[];for(let s of e){let o=t.indexOf(s);o<0?n.push(new rl(this.view,s)):(this.gutters[o].update(r),n.push(this.gutters[o]))}for(let s of this.gutters)s.dom.remove(),n.indexOf(s)<0&&s.destroy();for(let s of n)this.dom.appendChild(s.dom);this.gutters=n}return i}destroy(){for(let r of this.gutters)r.destroy();this.dom.remove()}},{provide:r=>F.scrollMargins.of(t=>{let e=t.plugin(r);return!e||e.gutters.length==0||!e.fixed?null:t.textDirection==ut.LTR?{left:e.dom.offsetWidth}:{right:e.dom.offsetWidth}})});function nl(r){return Array.isArray(r)?r:[r]}function Zh(r,t,e){for(;r.value&&r.from<=e;)r.from==e&&t.push(r.value),r.next()}class Dc{constructor(t,e,i){this.gutter=t,this.height=i,this.localMarkers=[],this.i=0,this.cursor=q.iter(t.markers,e.from)}line(t,e,i){this.localMarkers.length&&(this.localMarkers=[]),Zh(this.cursor,this.localMarkers,e.from);let n=i.length?this.localMarkers.concat(i):this.localMarkers,s=this.gutter.config.lineMarker(t,e,n);s&&n.unshift(s);let o=this.gutter;if(n.length==0&&!o.config.renderEmptyElements)return;let l=e.top-this.height;if(this.i==o.elements.length){let h=new ta(t,e.height,l,n);o.elements.push(h),o.dom.appendChild(h.dom)}else o.elements[this.i].update(t,e.height,l,n);this.height=e.bottom,this.i++}finish(){let t=this.gutter;for(;t.elements.length>this.i;){let e=t.elements.pop();t.dom.removeChild(e.dom),e.destroy()}}}class rl{constructor(t,e){this.view=t,this.config=e,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in e.domEventHandlers)this.dom.addEventListener(i,n=>{let s=t.lineBlockAtHeight(n.clientY-t.documentTop);e.domEventHandlers[i](t,s,n)&&n.preventDefault()});this.markers=nl(e.markers(t)),e.initialSpacer&&(this.spacer=new ta(t,0,0,[e.initialSpacer(t)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(t){let e=this.markers;if(this.markers=nl(this.config.markers(t.view)),this.spacer&&this.config.updateSpacer){let n=this.config.updateSpacer(this.spacer.markers[0],t);n!=this.spacer.markers[0]&&this.spacer.update(t.view,0,0,[n])}let i=t.view.viewport;return!q.eq(this.markers,e,i.from,i.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(t):!1)}destroy(){for(let t of this.elements)t.destroy()}}class ta{constructor(t,e,i,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(t,e,i,n)}update(t,e,i,n){this.height!=e&&(this.dom.style.height=(this.height=e)+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),Nc(this.markers,n)||this.setMarkers(t,n)}setMarkers(t,e){let i="cm-gutterElement",n=this.dom.firstChild;for(let s=0,o=0;;){let l=o,h=s<e.length?e[s++]:null,a=!1;if(h){let f=h.elementClass;f&&(i+=" "+f);for(let u=o;u<this.markers.length;u++)if(this.markers[u].compare(h)){l=u,a=!0;break}}else l=this.markers.length;for(;o<l;){let f=this.markers[o++];if(f.toDOM){f.destroy(n);let u=n.nextSibling;n.remove(),n=u}}if(!h)break;h.toDOM&&(a?n=n.nextSibling:this.dom.insertBefore(h.toDOM(t),n)),a&&o++}this.dom.className=i,this.markers=e}destroy(){this.setMarkers(null,[])}}function Nc(r,t){if(r.length!=t.length)return!1;for(let e=0;e<r.length;e++)if(!r[e].compare(t[e]))return!1;return!0}const Rc=P.define(),Qe=P.define({combine(r){return rr(r,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(t,e){let i=Object.assign({},t);for(let n in e){let s=i[n],o=e[n];i[n]=s?(l,h,a)=>s(l,h,a)||o(l,h,a):o}return i}})}});class Lr extends me{constructor(t){super(),this.number=t}eq(t){return this.number==t.number}toDOM(){return document.createTextNode(this.number)}}function Mr(r,t){return r.state.facet(Qe).formatNumber(t,r.state)}const Ic=Li.compute([Qe],r=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(t){return t.state.facet(Rc)},lineMarker(t,e,i){return i.some(n=>n.toDOM)?null:new Lr(Mr(t,t.state.doc.lineAt(e.from).number))},lineMarkerChange:t=>t.startState.facet(Qe)!=t.state.facet(Qe),initialSpacer(t){return new Lr(Mr(t,sl(t.state.doc.lines)))},updateSpacer(t,e){let i=Mr(e.view,sl(e.view.state.doc.lines));return i==t.number?t:new Lr(i)},domEventHandlers:r.facet(Qe).domEventHandlers}));function Ec(r={}){return[Qe.of(r),Xh(),Ic]}function sl(r){let t=9;for(;t<r;)t=t*10+9;return t}const zc=new class extends me{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},Vc=gn.compute(["selection"],r=>{let t=[],e=-1;for(let i of r.selection.ranges)if(i.empty){let n=r.doc.lineAt(i.head).from;n>e&&(e=n,t.push(zc.range(n)))}return q.of(t)});function Fc(){return Vc}const Hc=1024;let Uc=0;class Br{constructor(t,e){this.from=t,this.to=e}}class K{constructor(t={}){this.id=Uc++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof t!="function"&&(t=Nt.match(t)),e=>{let i=t(e);return i===void 0?null:[this,i]}}}K.closedBy=new K({deserialize:r=>r.split(" ")});K.openedBy=new K({deserialize:r=>r.split(" ")});K.group=new K({deserialize:r=>r.split(" ")});K.contextHash=new K({perNode:!0});K.lookAhead=new K({perNode:!0});K.mounted=new K({perNode:!0});const Wc=Object.create(null);class Nt{constructor(t,e,i,n=0){this.name=t,this.props=e,this.id=i,this.flags=n}static define(t){let e=t.props&&t.props.length?Object.create(null):Wc,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(t.name==null?8:0),n=new Nt(t.name||"",e,t.id,i);if(t.props){for(let s of t.props)if(Array.isArray(s)||(s=s(n)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[s[0].id]=s[1]}}return n}prop(t){return this.props[t.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(t){if(typeof t=="string"){if(this.name==t)return!0;let e=this.prop(K.group);return e?e.indexOf(t)>-1:!1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let n of i.split(" "))e[n]=t[i];return i=>{for(let n=i.prop(K.group),s=-1;s<(n?n.length:0);s++){let o=e[s<0?i.name:n[s]];if(o)return o}}}}Nt.none=new Nt("",Object.create(null),0,8);const Qi=new WeakMap,ol=new WeakMap;var mt;(function(r){r[r.ExcludeBuffers=1]="ExcludeBuffers",r[r.IncludeAnonymous=2]="IncludeAnonymous",r[r.IgnoreMounts=4]="IgnoreMounts",r[r.IgnoreOverlays=8]="IgnoreOverlays"})(mt||(mt={}));class wt{constructor(t,e,i,n,s){if(this.type=t,this.children=e,this.positions=i,this.length=n,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,l]of s)this.props[typeof o=="number"?o:o.id]=l}}toString(){let t=this.prop(K.mounted);if(t&&!t.overlay)return t.tree.toString();let e="";for(let i of this.children){let n=i.toString();n&&(e&&(e+=","),e+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t=0){return new In(this.topNode,t)}cursorAt(t,e=0,i=0){let n=Qi.get(this)||this.topNode,s=new In(n);return s.moveTo(t,e),Qi.set(this,s._tree),s}get topNode(){return new ce(this,0,0,null)}resolve(t,e=0){let i=oi(Qi.get(this)||this.topNode,t,e,!1);return Qi.set(this,i),i}resolveInner(t,e=0){let i=oi(ol.get(this)||this.topNode,t,e,!0);return ol.set(this,i),i}iterate(t){let{enter:e,leave:i,from:n=0,to:s=this.length}=t;for(let o=this.cursor((t.mode||0)|mt.IncludeAnonymous);;){let l=!1;if(o.from<=s&&o.to>=n&&(o.type.isAnonymous||e(o)!==!1)){if(o.firstChild())continue;l=!0}for(;l&&i&&!o.type.isAnonymous&&i(o),!o.nextSibling();){if(!o.parent())return;l=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:Fs(Nt.none,this.children,this.positions,0,this.children.length,0,this.length,(e,i,n)=>new wt(this.type,e,i,n,this.propValues),t.makeTree||((e,i,n)=>new wt(Nt.none,e,i,n)))}static build(t){return jc(t)}}wt.empty=new wt(Nt.none,[],[],0);class zs{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new zs(this.buffer,this.index)}}class je{constructor(t,e,i){this.buffer=t,this.length=e,this.set=i}get type(){return Nt.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],n=this.set.types[e],s=n.name;if(/\W/.test(s)&&!n.isError&&(s=JSON.stringify(s)),t+=4,i==t)return s;let o=[];for(;t<i;)o.push(this.childString(t)),t=this.buffer[t+3];return s+"("+o.join(",")+")"}findChild(t,e,i,n,s){let{buffer:o}=this,l=-1;for(let h=t;h!=e&&!(ea(s,n,o[h+1],o[h+2])&&(l=h,i>0));h=o[h+3]);return l}slice(t,e,i,n){let s=this.buffer,o=new Uint16Array(e-t);for(let l=t,h=0;l<e;)o[h++]=s[l++],o[h++]=s[l++]-i,o[h++]=s[l++]-i,o[h++]=s[l++]-t;return new je(o,n-i,this.set)}}function ea(r,t,e,i){switch(r){case-2:return e<t;case-1:return i>=t&&e<t;case 0:return e<t&&i>t;case 1:return e<=t&&i>t;case 2:return i>t;case 4:return!0}}function ia(r,t){let e=r.childBefore(t);for(;e;){let i=e.lastChild;if(!i||i.to!=e.to)break;i.type.isError&&i.from==i.to?(r=e,e=i.prevSibling):e=i}return r}function oi(r,t,e,i){for(var n;r.from==r.to||(e<1?r.from>=t:r.from>t)||(e>-1?r.to<=t:r.to<t);){let o=!i&&r instanceof ce&&r.index<0?null:r.parent;if(!o)return r;r=o}let s=i?0:mt.IgnoreOverlays;if(i)for(let o=r,l=o.parent;l;o=l,l=o.parent)o instanceof ce&&o.index<0&&((n=l.enter(t,e,s))===null||n===void 0?void 0:n.from)!=o.from&&(r=l);for(;;){let o=r.enter(t,e,s);if(!o)return r;r=o}}class ce{constructor(t,e,i,n){this._tree=t,this.from=e,this.index=i,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(t,e,i,n,s=0){for(let o=this;;){for(let{children:l,positions:h}=o._tree,a=e>0?l.length:-1;t!=a;t+=e){let f=l[t],u=h[t]+o.from;if(!!ea(n,i,u,u+f.length)){if(f instanceof je){if(s&mt.ExcludeBuffers)continue;let c=f.findChild(0,f.buffer.length,e,i-u,n);if(c>-1)return new Te(new $c(o,f,t,u),null,c)}else if(s&mt.IncludeAnonymous||!f.type.isAnonymous||Vs(f)){let c;if(!(s&mt.IgnoreMounts)&&f.props&&(c=f.prop(K.mounted))&&!c.overlay)return new ce(c.tree,u,t,o);let d=new ce(f,u,t,o);return s&mt.IncludeAnonymous||!d.type.isAnonymous?d:d.nextChild(e<0?f.children.length-1:0,e,i,n)}}}if(s&mt.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?t=o.index+e:t=e<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this._tree.children.length-1,-1,t,-2)}enter(t,e,i=0){let n;if(!(i&mt.IgnoreOverlays)&&(n=this._tree.prop(K.mounted))&&n.overlay){let s=t-this.from;for(let{from:o,to:l}of n.overlay)if((e>0?o<=s:o<s)&&(e<0?l>=s:l>s))return new ce(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,i)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(t=0){return new In(this,t)}get tree(){return this._tree}toTree(){return this._tree}resolve(t,e=0){return oi(this,t,e,!1)}resolveInner(t,e=0){return oi(this,t,e,!0)}enterUnfinishedNodesBefore(t){return ia(this,t)}getChild(t,e=null,i=null){let n=Nn(this,t,e,i);return n.length?n[0]:null}getChildren(t,e=null,i=null){return Nn(this,t,e,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(t){return Rn(this,t)}}function Nn(r,t,e,i){let n=r.cursor(),s=[];if(!n.firstChild())return s;if(e!=null){for(;!n.type.is(e);)if(!n.nextSibling())return s}for(;;){if(i!=null&&n.type.is(i))return s;if(n.type.is(t)&&s.push(n.node),!n.nextSibling())return i==null?s:[]}}function Rn(r,t,e=t.length-1){for(let i=r.parent;e>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(t[e]&&t[e]!=i.name)return!1;e--}}return!0}class $c{constructor(t,e,i,n){this.parent=t,this.buffer=e,this.index=i,this.start=n}}class Te{constructor(t,e,i){this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(t,e,i){let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.context.start,i);return s<0?null:new Te(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,i=0){if(i&mt.ExcludeBuffers)return null;let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return s<0?null:new Te(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new Te(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new Te(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}cursor(t=0){return new In(this,t)}get tree(){return null}toTree(){let t=[],e=[],{buffer:i}=this.context,n=this.index+4,s=i.buffer[this.index+3];if(s>n){let o=i.buffer[this.index+1],l=i.buffer[this.index+2];t.push(i.slice(n,s,o,l)),e.push(0)}return new wt(this.type,t,e,this.to-this.from)}resolve(t,e=0){return oi(this,t,e,!1)}resolveInner(t,e=0){return oi(this,t,e,!0)}enterUnfinishedNodesBefore(t){return ia(this,t)}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,i=null){let n=Nn(this,t,e,i);return n.length?n[0]:null}getChildren(t,e=null,i=null){return Nn(this,t,e,i)}get node(){return this}matchContext(t){return Rn(this,t)}}class In{constructor(t,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof ce)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let i=t._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=t,this.yieldBuf(t.index)}}get name(){return this.type.name}yieldNode(t){return t?(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0):!1}yieldBuf(t,e){this.index=t;let{start:i,buffer:n}=this.buffer;return this.type=e||n.set.types[n.buffer[t]],this.from=i+n.buffer[t+1],this.to=i+n.buffer[t+2],!0}yield(t){return t?t instanceof ce?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,i){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree._tree.children.length-1:0,t,e,i,this.mode));let{buffer:n}=this.buffer,s=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.buffer.start,i);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,i=this.mode){return this.buffer?i&mt.ExcludeBuffers?!1:this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&mt.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.mode&mt.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode)):!1;let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let n=i<0?0:this.stack[i]+4;if(this.index!=n)return this.yieldBuf(e.findChild(n,this.index,-1,0,4))}else{let n=e.buffer[this.index+3];if(n<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(n)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:n}=this;if(n){if(t>0){if(this.index<n.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(n.buffer.buffer[s+3]<this.index)return!1;({index:e,parent:i}=n)}else({index:e,_parent:i}=this._tree);for(;i;{index:e,_parent:i}=i)if(e>-1)for(let s=e+t,o=t<0?-1:i._tree.children.length;s!=o;s+=t){let l=i._tree.children[s];if(this.mode&mt.IncludeAnonymous||l instanceof je||!l.type.isAnonymous||Vs(l))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer){t:for(let n=this.index,s=this.stack.length;s>=0;){for(let o=t;o;o=o._parent)if(o.index==n){if(n==this.index)return o;e=o,i=s+1;break t}n=this.stack[--s]}}for(let n=i;n<this.stack.length;n++)e=new Te(this.buffer,e,this.stack[n]);return this.bufferNode=new Te(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(t,e){for(let i=0;;){let n=!1;if(this.type.isAnonymous||t(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(n=!0)}for(;n&&e&&e(this),n=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,n=!0}}}matchContext(t){if(!this.buffer)return Rn(this.node,t);let{buffer:e}=this.buffer,{types:i}=e.set;for(let n=t.length-1,s=this.stack.length-1;n>=0;s--){if(s<0)return Rn(this.node,t,n);let o=i[e.buffer[this.stack[s]]];if(!o.isAnonymous){if(t[n]&&t[n]!=o.name)return!1;n--}}return!0}}function Vs(r){return r.children.some(t=>t instanceof je||!t.type.isAnonymous||Vs(t))}function jc(r){var t;let{buffer:e,nodeSet:i,maxBufferLength:n=Hc,reused:s=[],minRepeatType:o=i.types.length}=r,l=Array.isArray(e)?new zs(e,e.length):e,h=i.types,a=0,f=0;function u(y,v,g,b,_){let{id:w,start:m,end:A,size:L}=l,D=f;for(;L<0;)if(l.next(),L==-1){let U=s[w];g.push(U),b.push(m-y);return}else if(L==-3){a=w;return}else if(L==-4){f=w;return}else throw new RangeError(`Unrecognized record size: ${L}`);let Y=h[w],H,E,Et=m-y;if(A-m<=n&&(E=x(l.pos-v,_))){let U=new Uint16Array(E.size-E.skip),N=l.pos-E.size,z=U.length;for(;l.pos>N;)z=S(E.start,U,z);H=new je(U,A-E.start,i),Et=E.start-y}else{let U=l.pos-L;l.next();let N=[],z=[],W=w>=o?w:-1,Q=0,lt=A;for(;l.pos>U;)W>=0&&l.id==W&&l.size>=0?(l.end<=lt-n&&(d(N,z,m,Q,l.end,lt,W,D),Q=N.length,lt=l.end),l.next()):u(m,U,N,z,W);if(W>=0&&Q>0&&Q<N.length&&d(N,z,m,Q,m,lt,W,D),N.reverse(),z.reverse(),W>-1&&Q>0){let zt=c(Y);H=Fs(Y,N,z,0,N.length,0,A-m,zt,zt)}else H=p(Y,N,z,A-m,D-A)}g.push(H),b.push(Et)}function c(y){return(v,g,b)=>{let _=0,w=v.length-1,m,A;if(w>=0&&(m=v[w])instanceof wt){if(!w&&m.type==y&&m.length==b)return m;(A=m.prop(K.lookAhead))&&(_=g[w]+m.length+A)}return p(y,v,g,b,_)}}function d(y,v,g,b,_,w,m,A){let L=[],D=[];for(;y.length>b;)L.push(y.pop()),D.push(v.pop()+g-_);y.push(p(i.types[m],L,D,w-_,A-w)),v.push(_-g)}function p(y,v,g,b,_=0,w){if(a){let m=[K.contextHash,a];w=w?[m].concat(w):[m]}if(_>25){let m=[K.lookAhead,_];w=w?[m].concat(w):[m]}return new wt(y,v,g,b,w)}function x(y,v){let g=l.fork(),b=0,_=0,w=0,m=g.end-n,A={size:0,start:0,skip:0};t:for(let L=g.pos-y;g.pos>L;){let D=g.size;if(g.id==v&&D>=0){A.size=b,A.start=_,A.skip=w,w+=4,b+=4,g.next();continue}let Y=g.pos-D;if(D<0||Y<L||g.start<m)break;let H=g.id>=o?4:0,E=g.start;for(g.next();g.pos>Y;){if(g.size<0)if(g.size==-3)H+=4;else break t;else g.id>=o&&(H+=4);g.next()}_=E,b+=D,w+=H}return(v<0||b==y)&&(A.size=b,A.start=_,A.skip=w),A.size>4?A:void 0}function S(y,v,g){let{id:b,start:_,end:w,size:m}=l;if(l.next(),m>=0&&b<o){let A=g;if(m>4){let L=l.pos-(m-4);for(;l.pos>L;)g=S(y,v,g)}v[--g]=A,v[--g]=w-y,v[--g]=_-y,v[--g]=b}else m==-3?a=b:m==-4&&(f=b);return g}let k=[],B=[];for(;l.pos>0;)u(r.start||0,r.bufferStart||0,k,B,-1);let C=(t=r.length)!==null&&t!==void 0?t:k.length?B[0]+k[0].length:0;return new wt(h[r.topID],k.reverse(),B.reverse(),C)}const ll=new WeakMap;function mn(r,t){if(!r.isAnonymous||t instanceof je||t.type!=r)return 1;let e=ll.get(t);if(e==null){e=1;for(let i of t.children){if(i.type!=r||!(i instanceof wt)){e=1;break}e+=mn(r,i)}ll.set(t,e)}return e}function Fs(r,t,e,i,n,s,o,l,h){let a=0;for(let p=i;p<n;p++)a+=mn(r,t[p]);let f=Math.ceil(a*1.5/8),u=[],c=[];function d(p,x,S,k,B){for(let C=S;C<k;){let y=C,v=x[C],g=mn(r,p[C]);for(C++;C<k;C++){let b=mn(r,p[C]);if(g+b>=f)break;g+=b}if(C==y+1){if(g>f){let b=p[y];d(b.children,b.positions,0,b.children.length,x[y]+B);continue}u.push(p[y])}else{let b=x[C-1]+p[C-1].length-v;u.push(Fs(r,p,x,y,C,v,b,null,h))}c.push(v+B-s)}}return d(t,e,i,n,0),(l||h)(u,c,o)}class Ue{constructor(t,e,i,n,s=!1,o=!1){this.from=t,this.to=e,this.tree=i,this.offset=n,this.open=(s?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(t,e=[],i=!1){let n=[new Ue(0,t.length,t,0,!1,i)];for(let s of e)s.to>t.length&&n.push(s);return n}static applyChanges(t,e,i=128){if(!e.length)return t;let n=[],s=1,o=t.length?t[0]:null;for(let l=0,h=0,a=0;;l++){let f=l<e.length?e[l]:null,u=f?f.fromA:1e9;if(u-h>=i)for(;o&&o.from<u;){let c=o;if(h>=c.from||u<=c.to||a){let d=Math.max(c.from,h)-a,p=Math.min(c.to,u)-a;c=d>=p?null:new Ue(d,p,c.tree,c.offset+a,l>0,!!f)}if(c&&n.push(c),o.to>u)break;o=s<t.length?t[s++]:null}if(!f)break;h=f.toA,a=f.toA-f.toB}return n}}class Gc{startParse(t,e,i){return typeof t=="string"&&(t=new qc(t)),i=i?i.length?i.map(n=>new Br(n.from,n.to)):[new Br(0,0)]:[new Br(0,t.length)],this.createParse(t,e||[],i)}parse(t,e,i){let n=this.startParse(t,e,i);for(;;){let s=n.advance();if(s)return s}}}class qc{constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,e){return this.string.slice(t,e)}}new K({perNode:!0});const Kc=1024;let Yc=0;class rt{constructor(t={}){this.id=Yc++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof t!="function"&&(t=be.match(t)),e=>{let i=t(e);return i===void 0?null:[this,i]}}}rt.closedBy=new rt({deserialize:r=>r.split(" ")});rt.openedBy=new rt({deserialize:r=>r.split(" ")});rt.group=new rt({deserialize:r=>r.split(" ")});rt.contextHash=new rt({perNode:!0});rt.lookAhead=new rt({perNode:!0});rt.mounted=new rt({perNode:!0});const Qc=Object.create(null);class be{constructor(t,e,i,n=0){this.name=t,this.props=e,this.id=i,this.flags=n}static define(t){let e=t.props&&t.props.length?Object.create(null):Qc,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(t.name==null?8:0),n=new be(t.name||"",e,t.id,i);if(t.props){for(let s of t.props)if(Array.isArray(s)||(s=s(n)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[s[0].id]=s[1]}}return n}prop(t){return this.props[t.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(t){if(typeof t=="string"){if(this.name==t)return!0;let e=this.prop(rt.group);return e?e.indexOf(t)>-1:!1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let n of i.split(" "))e[n]=t[i];return i=>{for(let n=i.prop(rt.group),s=-1;s<(n?n.length:0);s++){let o=e[s<0?i.name:n[s]];if(o)return o}}}}be.none=new be("",Object.create(null),0,8);const Ji=new WeakMap,hl=new WeakMap;var vt;(function(r){r[r.ExcludeBuffers=1]="ExcludeBuffers",r[r.IncludeAnonymous=2]="IncludeAnonymous",r[r.IgnoreMounts=4]="IgnoreMounts",r[r.IgnoreOverlays=8]="IgnoreOverlays"})(vt||(vt={}));class te{constructor(t,e,i,n,s){if(this.type=t,this.children=e,this.positions=i,this.length=n,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,l]of s)this.props[typeof o=="number"?o:o.id]=l}}toString(){let t=this.prop(rt.mounted);if(t&&!t.overlay)return t.tree.toString();let e="";for(let i of this.children){let n=i.toString();n&&(e&&(e+=","),e+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t=0){return new Vn(this.topNode,t)}cursorAt(t,e=0,i=0){let n=Ji.get(this)||this.topNode,s=new Vn(n);return s.moveTo(t,e),Ji.set(this,s._tree),s}get topNode(){return new de(this,0,0,null)}resolve(t,e=0){let i=li(Ji.get(this)||this.topNode,t,e,!1);return Ji.set(this,i),i}resolveInner(t,e=0){let i=li(hl.get(this)||this.topNode,t,e,!0);return hl.set(this,i),i}iterate(t){let{enter:e,leave:i,from:n=0,to:s=this.length}=t;for(let o=this.cursor((t.mode||0)|vt.IncludeAnonymous);;){let l=!1;if(o.from<=s&&o.to>=n&&(o.type.isAnonymous||e(o)!==!1)){if(o.firstChild())continue;l=!0}for(;l&&i&&!o.type.isAnonymous&&i(o),!o.nextSibling();){if(!o.parent())return;l=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:Ws(be.none,this.children,this.positions,0,this.children.length,0,this.length,(e,i,n)=>new te(this.type,e,i,n,this.propValues),t.makeTree||((e,i,n)=>new te(be.none,e,i,n)))}static build(t){return Xc(t)}}te.empty=new te(be.none,[],[],0);class Hs{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Hs(this.buffer,this.index)}}class Ge{constructor(t,e,i){this.buffer=t,this.length=e,this.set=i}get type(){return be.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],n=this.set.types[e],s=n.name;if(/\W/.test(s)&&!n.isError&&(s=JSON.stringify(s)),t+=4,i==t)return s;let o=[];for(;t<i;)o.push(this.childString(t)),t=this.buffer[t+3];return s+"("+o.join(",")+")"}findChild(t,e,i,n,s){let{buffer:o}=this,l=-1;for(let h=t;h!=e&&!(na(s,n,o[h+1],o[h+2])&&(l=h,i>0));h=o[h+3]);return l}slice(t,e,i,n){let s=this.buffer,o=new Uint16Array(e-t);for(let l=t,h=0;l<e;)o[h++]=s[l++],o[h++]=s[l++]-i,o[h++]=s[l++]-i,o[h++]=s[l++]-t;return new Ge(o,n-i,this.set)}}function na(r,t,e,i){switch(r){case-2:return e<t;case-1:return i>=t&&e<t;case 0:return e<t&&i>t;case 1:return e<=t&&i>t;case 2:return i>t;case 4:return!0}}function ra(r,t){let e=r.childBefore(t);for(;e;){let i=e.lastChild;if(!i||i.to!=e.to)break;i.type.isError&&i.from==i.to?(r=e,e=i.prevSibling):e=i}return r}function li(r,t,e,i){for(var n;r.from==r.to||(e<1?r.from>=t:r.from>t)||(e>-1?r.to<=t:r.to<t);){let o=!i&&r instanceof de&&r.index<0?null:r.parent;if(!o)return r;r=o}let s=i?0:vt.IgnoreOverlays;if(i)for(let o=r,l=o.parent;l;o=l,l=o.parent)o instanceof de&&o.index<0&&((n=l.enter(t,e,s))===null||n===void 0?void 0:n.from)!=o.from&&(r=l);for(;;){let o=r.enter(t,e,s);if(!o)return r;r=o}}class de{constructor(t,e,i,n){this._tree=t,this.from=e,this.index=i,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(t,e,i,n,s=0){for(let o=this;;){for(let{children:l,positions:h}=o._tree,a=e>0?l.length:-1;t!=a;t+=e){let f=l[t],u=h[t]+o.from;if(!!na(n,i,u,u+f.length)){if(f instanceof Ge){if(s&vt.ExcludeBuffers)continue;let c=f.findChild(0,f.buffer.length,e,i-u,n);if(c>-1)return new _e(new Jc(o,f,t,u),null,c)}else if(s&vt.IncludeAnonymous||!f.type.isAnonymous||Us(f)){let c;if(!(s&vt.IgnoreMounts)&&f.props&&(c=f.prop(rt.mounted))&&!c.overlay)return new de(c.tree,u,t,o);let d=new de(f,u,t,o);return s&vt.IncludeAnonymous||!d.type.isAnonymous?d:d.nextChild(e<0?f.children.length-1:0,e,i,n)}}}if(s&vt.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?t=o.index+e:t=e<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this._tree.children.length-1,-1,t,-2)}enter(t,e,i=0){let n;if(!(i&vt.IgnoreOverlays)&&(n=this._tree.prop(rt.mounted))&&n.overlay){let s=t-this.from;for(let{from:o,to:l}of n.overlay)if((e>0?o<=s:o<s)&&(e<0?l>=s:l>s))return new de(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,i)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(t=0){return new Vn(this,t)}get tree(){return this._tree}toTree(){return this._tree}resolve(t,e=0){return li(this,t,e,!1)}resolveInner(t,e=0){return li(this,t,e,!0)}enterUnfinishedNodesBefore(t){return ra(this,t)}getChild(t,e=null,i=null){let n=En(this,t,e,i);return n.length?n[0]:null}getChildren(t,e=null,i=null){return En(this,t,e,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(t){return zn(this,t)}}function En(r,t,e,i){let n=r.cursor(),s=[];if(!n.firstChild())return s;if(e!=null){for(;!n.type.is(e);)if(!n.nextSibling())return s}for(;;){if(i!=null&&n.type.is(i))return s;if(n.type.is(t)&&s.push(n.node),!n.nextSibling())return i==null?s:[]}}function zn(r,t,e=t.length-1){for(let i=r.parent;e>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(t[e]&&t[e]!=i.name)return!1;e--}}return!0}class Jc{constructor(t,e,i,n){this.parent=t,this.buffer=e,this.index=i,this.start=n}}class _e{constructor(t,e,i){this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(t,e,i){let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.context.start,i);return s<0?null:new _e(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,i=0){if(i&vt.ExcludeBuffers)return null;let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return s<0?null:new _e(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new _e(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new _e(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}cursor(t=0){return new Vn(this,t)}get tree(){return null}toTree(){let t=[],e=[],{buffer:i}=this.context,n=this.index+4,s=i.buffer[this.index+3];if(s>n){let o=i.buffer[this.index+1],l=i.buffer[this.index+2];t.push(i.slice(n,s,o,l)),e.push(0)}return new te(this.type,t,e,this.to-this.from)}resolve(t,e=0){return li(this,t,e,!1)}resolveInner(t,e=0){return li(this,t,e,!0)}enterUnfinishedNodesBefore(t){return ra(this,t)}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,i=null){let n=En(this,t,e,i);return n.length?n[0]:null}getChildren(t,e=null,i=null){return En(this,t,e,i)}get node(){return this}matchContext(t){return zn(this,t)}}class Vn{constructor(t,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof de)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let i=t._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=t,this.yieldBuf(t.index)}}get name(){return this.type.name}yieldNode(t){return t?(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0):!1}yieldBuf(t,e){this.index=t;let{start:i,buffer:n}=this.buffer;return this.type=e||n.set.types[n.buffer[t]],this.from=i+n.buffer[t+1],this.to=i+n.buffer[t+2],!0}yield(t){return t?t instanceof de?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,i){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree._tree.children.length-1:0,t,e,i,this.mode));let{buffer:n}=this.buffer,s=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.buffer.start,i);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,i=this.mode){return this.buffer?i&vt.ExcludeBuffers?!1:this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&vt.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.mode&vt.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode)):!1;let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let n=i<0?0:this.stack[i]+4;if(this.index!=n)return this.yieldBuf(e.findChild(n,this.index,-1,0,4))}else{let n=e.buffer[this.index+3];if(n<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(n)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:n}=this;if(n){if(t>0){if(this.index<n.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(n.buffer.buffer[s+3]<this.index)return!1;({index:e,parent:i}=n)}else({index:e,_parent:i}=this._tree);for(;i;{index:e,_parent:i}=i)if(e>-1)for(let s=e+t,o=t<0?-1:i._tree.children.length;s!=o;s+=t){let l=i._tree.children[s];if(this.mode&vt.IncludeAnonymous||l instanceof Ge||!l.type.isAnonymous||Us(l))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer){t:for(let n=this.index,s=this.stack.length;s>=0;){for(let o=t;o;o=o._parent)if(o.index==n){if(n==this.index)return o;e=o,i=s+1;break t}n=this.stack[--s]}}for(let n=i;n<this.stack.length;n++)e=new _e(this.buffer,e,this.stack[n]);return this.bufferNode=new _e(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(t,e){for(let i=0;;){let n=!1;if(this.type.isAnonymous||t(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(n=!0)}for(;n&&e&&e(this),n=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,n=!0}}}matchContext(t){if(!this.buffer)return zn(this.node,t);let{buffer:e}=this.buffer,{types:i}=e.set;for(let n=t.length-1,s=this.stack.length-1;n>=0;s--){if(s<0)return zn(this.node,t,n);let o=i[e.buffer[this.stack[s]]];if(!o.isAnonymous){if(t[n]&&t[n]!=o.name)return!1;n--}}return!0}}function Us(r){return r.children.some(t=>t instanceof Ge||!t.type.isAnonymous||Us(t))}function Xc(r){var t;let{buffer:e,nodeSet:i,maxBufferLength:n=Kc,reused:s=[],minRepeatType:o=i.types.length}=r,l=Array.isArray(e)?new Hs(e,e.length):e,h=i.types,a=0,f=0;function u(y,v,g,b,_){let{id:w,start:m,end:A,size:L}=l,D=f;for(;L<0;)if(l.next(),L==-1){let U=s[w];g.push(U),b.push(m-y);return}else if(L==-3){a=w;return}else if(L==-4){f=w;return}else throw new RangeError(`Unrecognized record size: ${L}`);let Y=h[w],H,E,Et=m-y;if(A-m<=n&&(E=x(l.pos-v,_))){let U=new Uint16Array(E.size-E.skip),N=l.pos-E.size,z=U.length;for(;l.pos>N;)z=S(E.start,U,z);H=new Ge(U,A-E.start,i),Et=E.start-y}else{let U=l.pos-L;l.next();let N=[],z=[],W=w>=o?w:-1,Q=0,lt=A;for(;l.pos>U;)W>=0&&l.id==W&&l.size>=0?(l.end<=lt-n&&(d(N,z,m,Q,l.end,lt,W,D),Q=N.length,lt=l.end),l.next()):u(m,U,N,z,W);if(W>=0&&Q>0&&Q<N.length&&d(N,z,m,Q,m,lt,W,D),N.reverse(),z.reverse(),W>-1&&Q>0){let zt=c(Y);H=Ws(Y,N,z,0,N.length,0,A-m,zt,zt)}else H=p(Y,N,z,A-m,D-A)}g.push(H),b.push(Et)}function c(y){return(v,g,b)=>{let _=0,w=v.length-1,m,A;if(w>=0&&(m=v[w])instanceof te){if(!w&&m.type==y&&m.length==b)return m;(A=m.prop(rt.lookAhead))&&(_=g[w]+m.length+A)}return p(y,v,g,b,_)}}function d(y,v,g,b,_,w,m,A){let L=[],D=[];for(;y.length>b;)L.push(y.pop()),D.push(v.pop()+g-_);y.push(p(i.types[m],L,D,w-_,A-w)),v.push(_-g)}function p(y,v,g,b,_=0,w){if(a){let m=[rt.contextHash,a];w=w?[m].concat(w):[m]}if(_>25){let m=[rt.lookAhead,_];w=w?[m].concat(w):[m]}return new te(y,v,g,b,w)}function x(y,v){let g=l.fork(),b=0,_=0,w=0,m=g.end-n,A={size:0,start:0,skip:0};t:for(let L=g.pos-y;g.pos>L;){let D=g.size;if(g.id==v&&D>=0){A.size=b,A.start=_,A.skip=w,w+=4,b+=4,g.next();continue}let Y=g.pos-D;if(D<0||Y<L||g.start<m)break;let H=g.id>=o?4:0,E=g.start;for(g.next();g.pos>Y;){if(g.size<0)if(g.size==-3)H+=4;else break t;else g.id>=o&&(H+=4);g.next()}_=E,b+=D,w+=H}return(v<0||b==y)&&(A.size=b,A.start=_,A.skip=w),A.size>4?A:void 0}function S(y,v,g){let{id:b,start:_,end:w,size:m}=l;if(l.next(),m>=0&&b<o){let A=g;if(m>4){let L=l.pos-(m-4);for(;l.pos>L;)g=S(y,v,g)}v[--g]=A,v[--g]=w-y,v[--g]=_-y,v[--g]=b}else m==-3?a=b:m==-4&&(f=b);return g}let k=[],B=[];for(;l.pos>0;)u(r.start||0,r.bufferStart||0,k,B,-1);let C=(t=r.length)!==null&&t!==void 0?t:k.length?B[0]+k[0].length:0;return new te(h[r.topID],k.reverse(),B.reverse(),C)}const al=new WeakMap;function bn(r,t){if(!r.isAnonymous||t instanceof Ge||t.type!=r)return 1;let e=al.get(t);if(e==null){e=1;for(let i of t.children){if(i.type!=r||!(i instanceof te)){e=1;break}e+=bn(r,i)}al.set(t,e)}return e}function Ws(r,t,e,i,n,s,o,l,h){let a=0;for(let p=i;p<n;p++)a+=bn(r,t[p]);let f=Math.ceil(a*1.5/8),u=[],c=[];function d(p,x,S,k,B){for(let C=S;C<k;){let y=C,v=x[C],g=bn(r,p[C]);for(C++;C<k;C++){let b=bn(r,p[C]);if(g+b>=f)break;g+=b}if(C==y+1){if(g>f){let b=p[y];d(b.children,b.positions,0,b.children.length,x[y]+B);continue}u.push(p[y])}else{let b=x[C-1]+p[C-1].length-v;u.push(Ws(r,p,x,y,C,v,b,null,h))}c.push(v+B-s)}}return d(t,e,i,n,0),(l||h)(u,c,o)}new rt({perNode:!0});let Zc=0;class qt{constructor(t,e,i){this.set=t,this.base=e,this.modified=i,this.id=Zc++}static define(t){if(t!=null&&t.base)throw new Error("Can not derive from a modified tag");let e=new qt([],null,[]);if(e.set.push(e),t)for(let i of t.set)e.set.push(i);return e}static defineModifier(){let t=new Fn;return e=>e.modified.indexOf(t)>-1?e:Fn.get(e.base||e,e.modified.concat(t).sort((i,n)=>i.id-n.id))}}let td=0;class Fn{constructor(){this.instances=[],this.id=td++}static get(t,e){if(!e.length)return t;let i=e[0].instances.find(l=>l.base==t&&ed(e,l.modified));if(i)return i;let n=[],s=new qt(n,t,e);for(let l of e)l.instances.push(s);let o=sa(e);for(let l of t.set)for(let h of o)n.push(Fn.get(l,h));return s}}function ed(r,t){return r.length==t.length&&r.every((e,i)=>e==t[i])}function sa(r){let t=[r];for(let e=0;e<r.length;e++)for(let i of sa(r.slice(0,e).concat(r.slice(e+1))))t.push(i);return t}function oa(r){let t=Object.create(null);for(let e in r){let i=r[e];Array.isArray(i)||(i=[i]);for(let n of e.split(" "))if(n){let s=[],o=2,l=n;for(let u=0;;){if(l=="..."&&u>0&&u+3==n.length){o=1;break}let c=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!c)throw new RangeError("Invalid path: "+n);if(s.push(c[0]=="*"?"":c[0][0]=='"'?JSON.parse(c[0]):c[0]),u+=c[0].length,u==n.length)break;let d=n[u++];if(u==n.length&&d=="!"){o=0;break}if(d!="/")throw new RangeError("Invalid path: "+n);l=n.slice(u)}let h=s.length-1,a=s[h];if(!a)throw new RangeError("Invalid path: "+n);let f=new nd(i,o,h>0?s.slice(0,h):null);t[a]=f.sort(t[a])}}return id.add(t)}const id=new rt;class nd{constructor(t,e,i,n){this.tags=t,this.mode=e,this.context=i,this.next=n}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}function rd(r,t){let e=Object.create(null);for(let s of r)if(!Array.isArray(s.tag))e[s.tag.id]=s.class;else for(let o of s.tag)e[o.id]=s.class;let{scope:i,all:n=null}=t||{};return{style:s=>{let o=n;for(let l of s)for(let h of l.set){let a=e[h.id];if(a){o=o?o+" "+a:a;break}}return o},scope:i}}const T=qt.define,Xi=T(),xe=T(),fl=T(xe),ul=T(xe),ke=T(),Zi=T(ke),Pr=T(ke),Gt=T(),Re=T(Gt),$t=T(),jt=T(),vs=T(),mi=T(vs),tn=T(),R={comment:Xi,lineComment:T(Xi),blockComment:T(Xi),docComment:T(Xi),name:xe,variableName:T(xe),typeName:fl,tagName:T(fl),propertyName:ul,attributeName:T(ul),className:T(xe),labelName:T(xe),namespace:T(xe),macroName:T(xe),literal:ke,string:Zi,docString:T(Zi),character:T(Zi),attributeValue:T(Zi),number:Pr,integer:T(Pr),float:T(Pr),bool:T(ke),regexp:T(ke),escape:T(ke),color:T(ke),url:T(ke),keyword:$t,self:T($t),null:T($t),atom:T($t),unit:T($t),modifier:T($t),operatorKeyword:T($t),controlKeyword:T($t),definitionKeyword:T($t),moduleKeyword:T($t),operator:jt,derefOperator:T(jt),arithmeticOperator:T(jt),logicOperator:T(jt),bitwiseOperator:T(jt),compareOperator:T(jt),updateOperator:T(jt),definitionOperator:T(jt),typeOperator:T(jt),controlOperator:T(jt),punctuation:vs,separator:T(vs),bracket:mi,angleBracket:T(mi),squareBracket:T(mi),paren:T(mi),brace:T(mi),content:Gt,heading:Re,heading1:T(Re),heading2:T(Re),heading3:T(Re),heading4:T(Re),heading5:T(Re),heading6:T(Re),contentSeparator:T(Gt),list:T(Gt),quote:T(Gt),emphasis:T(Gt),strong:T(Gt),link:T(Gt),monospace:T(Gt),strikethrough:T(Gt),inserted:T(),deleted:T(),changed:T(),invalid:T(),meta:tn,documentMeta:T(tn),annotation:T(tn),processingInstruction:T(tn),definition:qt.defineModifier(),constant:qt.defineModifier(),function:qt.defineModifier(),standard:qt.defineModifier(),local:qt.defineModifier(),special:qt.defineModifier()};rd([{tag:R.link,class:"tok-link"},{tag:R.heading,class:"tok-heading"},{tag:R.emphasis,class:"tok-emphasis"},{tag:R.strong,class:"tok-strong"},{tag:R.keyword,class:"tok-keyword"},{tag:R.atom,class:"tok-atom"},{tag:R.bool,class:"tok-bool"},{tag:R.url,class:"tok-url"},{tag:R.labelName,class:"tok-labelName"},{tag:R.inserted,class:"tok-inserted"},{tag:R.deleted,class:"tok-deleted"},{tag:R.literal,class:"tok-literal"},{tag:R.string,class:"tok-string"},{tag:R.number,class:"tok-number"},{tag:[R.regexp,R.escape,R.special(R.string)],class:"tok-string2"},{tag:R.variableName,class:"tok-variableName"},{tag:R.local(R.variableName),class:"tok-variableName tok-local"},{tag:R.definition(R.variableName),class:"tok-variableName tok-definition"},{tag:R.special(R.variableName),class:"tok-variableName2"},{tag:R.definition(R.propertyName),class:"tok-propertyName tok-definition"},{tag:R.typeName,class:"tok-typeName"},{tag:R.namespace,class:"tok-namespace"},{tag:R.className,class:"tok-className"},{tag:R.macroName,class:"tok-macroName"},{tag:R.propertyName,class:"tok-propertyName"},{tag:R.operator,class:"tok-operator"},{tag:R.comment,class:"tok-comment"},{tag:R.meta,class:"tok-meta"},{tag:R.invalid,class:"tok-invalid"},{tag:R.punctuation,class:"tok-punctuation"}]);var Dr;const Hn=new K;function sd(r){return P.define({combine:r?t=>t.concat(r):void 0})}class Qt{constructor(t,e,i=[]){this.data=t,j.prototype.hasOwnProperty("tree")||Object.defineProperty(j.prototype,"tree",{get(){return De(this)}}),this.parser=e,this.extension=[ai.of(this),j.languageData.of((n,s,o)=>n.facet(cl(n,s,o)))].concat(i)}isActiveAt(t,e,i=-1){return cl(t,e,i)==this.data}findRegions(t){let e=t.facet(ai);if((e==null?void 0:e.data)==this.data)return[{from:0,to:t.doc.length}];if(!e||!e.allowsNesting)return[];let i=[],n=(s,o)=>{if(s.prop(Hn)==this.data){i.push({from:o,to:o+s.length});return}let l=s.prop(K.mounted);if(l){if(l.tree.prop(Hn)==this.data){if(l.overlay)for(let h of l.overlay)i.push({from:h.from+o,to:h.to+o});else i.push({from:o,to:o+s.length});return}else if(l.overlay){let h=i.length;if(n(l.tree,l.overlay[0].from+o),i.length>h)return}}for(let h=0;h<s.children.length;h++){let a=s.children[h];a instanceof wt&&n(a,s.positions[h]+o)}};return n(De(t),0),i}get allowsNesting(){return!0}}Qt.setState=J.define();function cl(r,t,e){let i=r.facet(ai);if(!i)return null;let n=i.data;if(i.allowsNesting)for(let s=De(r).topNode;s;s=s.enter(t,e,mt.ExcludeBuffers))n=s.type.prop(Hn)||n;return n}class Un extends Qt{constructor(t,e){super(t,e),this.parser=e}static define(t){let e=sd(t.languageData);return new Un(e,t.parser.configure({props:[Hn.add(i=>i.isTop?e:void 0)]}))}configure(t){return new Un(this.data,this.parser.configure(t))}get allowsNesting(){return this.parser.hasWrappers()}}function De(r){let t=r.field(Qt.state,!1);return t?t.tree:wt.empty}class od{constructor(t,e=t.length){this.doc=t,this.length=e,this.cursorPos=0,this.string="",this.cursor=t.iter()}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let i=this.cursorPos-this.string.length;return t<i||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-i,e-i)}}let bi=null;class Wn{constructor(t,e,i=[],n,s,o,l,h){this.parser=t,this.state=e,this.fragments=i,this.tree=n,this.treeLen=s,this.viewport=o,this.skipped=l,this.scheduleOn=h,this.parse=null,this.tempSkipped=[]}static create(t,e,i){return new Wn(t,e,[],wt.empty,0,i,[],null)}startParse(){return this.parser.startParse(new od(this.state.doc),this.fragments)}work(t,e){return e!=null&&e>=this.state.doc.length&&(e=void 0),this.tree!=wt.empty&&this.isDone(e!=null?e:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if(typeof t=="number"){let n=Date.now()+t;t=()=>Date.now()>n}for(this.parse||(this.parse=this.startParse()),e!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&e<this.state.doc.length&&this.parse.stopAt(e);;){let n=this.parse.advance();if(n)if(this.fragments=this.withoutTempSkipped(Ue.addTree(n,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=n,this.parse=null,this.treeLen<(e!=null?e:this.state.doc.length))this.parse=this.startParse();else return!0;if(t())return!1}})}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext(()=>{for(;!(e=this.parse.advance()););}),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(Ue.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=bi;bi=this;try{return t()}finally{bi=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=dl(t,e.from,e.to);return t}changes(t,e){let{fragments:i,tree:n,treeLen:s,viewport:o,skipped:l}=this;if(this.takeTree(),!t.empty){let h=[];if(t.iterChangedRanges((a,f,u,c)=>h.push({fromA:a,toA:f,fromB:u,toB:c})),i=Ue.applyChanges(i,h),n=wt.empty,s=0,o={from:t.mapPos(o.from,-1),to:t.mapPos(o.to,1)},this.skipped.length){l=[];for(let a of this.skipped){let f=t.mapPos(a.from,1),u=t.mapPos(a.to,-1);f<u&&l.push({from:f,to:u})}}}return new Wn(this.parser,e,i,n,s,o,l,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:n,to:s}=this.skipped[i];n<t.to&&s>t.from&&(this.fragments=dl(this.fragments,n,s),this.skipped.splice(i--,1))}return this.skipped.length>=e?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(t){return new class extends Gc{createParse(e,i,n){let s=n[0].from,o=n[n.length-1].to;return{parsedPos:s,advance(){let h=bi;if(h){for(let a of n)h.tempSkipped.push(a);t&&(h.scheduleOn=h.scheduleOn?Promise.all([h.scheduleOn,t]):t)}return this.parsedPos=o,new wt(Nt.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&e[0].from==0&&e[0].to>=t}static get(){return bi}}function dl(r,t,e){return Ue.applyChanges(r,[{fromA:t,toA:e,fromB:t,toB:e}])}class hi{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let e=this.context.changes(t.changes,t.state),i=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,i)||e.takeTree(),new hi(e)}static init(t){let e=Math.min(3e3,t.doc.length),i=Wn.create(t.facet(ai).parser,t,{from:0,to:e});return i.work(20,e)||i.takeTree(),new hi(i)}}Qt.state=Rt.define({create:hi.init,update(r,t){for(let e of t.effects)if(e.is(Qt.setState))return e.value;return t.startState.facet(ai)!=t.state.facet(ai)?hi.init(t.state):r.apply(t)}});let la=r=>{let t=setTimeout(()=>r(),500);return()=>clearTimeout(t)};typeof requestIdleCallback<"u"&&(la=r=>{let t=-1,e=setTimeout(()=>{t=requestIdleCallback(r,{timeout:500-100})},100);return()=>t<0?clearTimeout(e):cancelIdleCallback(t)});const Nr=typeof navigator<"u"&&((Dr=navigator.scheduling)===null||Dr===void 0?void 0:Dr.isInputPending)?()=>navigator.scheduling.isInputPending():null,ld=ne.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let e=this.view.state.field(Qt.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),t.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:t}=this.view,e=t.field(Qt.state);(e.tree!=e.context.tree||!e.context.isDone(t.doc.length))&&(this.working=la(this.work))}work(t){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:n}}=this.view,s=i.field(Qt.state);if(s.tree==s.context.tree&&s.context.isDone(n+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,t&&!Nr?Math.max(25,t.timeRemaining()-5):1e9),l=s.context.treeLen<n&&i.doc.length>n+1e3,h=s.context.work(()=>Nr&&Nr()||Date.now()>o,n+(l?0:1e5));this.chunkBudget-=Date.now()-e,(h||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Qt.setState.of(new hi(s.context))})),this.chunkBudget>0&&!(h&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then(()=>this.scheduleWork()).catch(e=>Zt(this.view.state,e)).then(()=>this.workScheduled--),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),ai=P.define({combine(r){return r.length?r[0]:null},enables:[Qt.state,ld]});class hd{constructor(t,e=[]){this.language=t,this.support=e,this.extension=[t,e]}}const ad=P.define(),$s=P.define({combine:r=>{if(!r.length)return"  ";if(!/^(?: +|\t+)$/.test(r[0]))throw new Error("Invalid indent unit: "+JSON.stringify(r[0]));return r[0]}});function $n(r){let t=r.facet($s);return t.charCodeAt(0)==9?r.tabSize*t.length:t.length}function jn(r,t){let e="",i=r.tabSize;if(r.facet($s).charCodeAt(0)==9)for(;t>=i;)e+="	",t-=i;for(let n=0;n<t;n++)e+=" ";return e}function ha(r,t){r instanceof j&&(r=new ar(r));for(let i of r.state.facet(ad)){let n=i(r,t);if(n!=null)return n}let e=De(r.state);return e?fd(r,e,t):null}class ar{constructor(t,e={}){this.state=t,this.options=e,this.unit=$n(t)}lineAt(t,e=1){let i=this.state.doc.lineAt(t),{simulateBreak:n,simulateDoubleBreak:s}=this.options;return n!=null&&n>=i.from&&n<=i.to?s&&n==t?{text:"",from:t}:(e<0?n<t:n<=t)?{text:i.text.slice(n-i.from),from:n}:{text:i.text.slice(0,n-i.from),from:i.from}:i}textAfterPos(t,e=1){if(this.options.simulateDoubleBreak&&t==this.options.simulateBreak)return"";let{text:i,from:n}=this.lineAt(t,e);return i.slice(t-n,Math.min(i.length,t+100-n))}column(t,e=1){let{text:i,from:n}=this.lineAt(t,e),s=this.countColumn(i,t-n),o=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return o>-1&&(s+=o-this.countColumn(i,i.search(/\S|$/))),s}countColumn(t,e=t.length){return Ms(t,this.state.tabSize,e)}lineIndent(t,e=1){let{text:i,from:n}=this.lineAt(t,e),s=this.options.overrideIndentation;if(s){let o=s(n);if(o>-1)return o}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const aa=new K;function fd(r,t,e){return fa(t.resolveInner(e).enterUnfinishedNodesBefore(e),e,r)}function ud(r){return r.pos==r.options.simulateBreak&&r.options.simulateDoubleBreak}function cd(r){let t=r.type.prop(aa);if(t)return t;let e=r.firstChild,i;if(e&&(i=e.type.prop(K.closedBy))){let n=r.lastChild,s=n&&i.indexOf(n.name)>-1;return o=>md(o,!0,1,void 0,s&&!ud(o)?n.from:void 0)}return r.parent==null?dd:null}function fa(r,t,e){for(;r;r=r.parent){let i=cd(r);if(i)return i(js.create(e,t,r))}return null}function dd(){return 0}class js extends ar{constructor(t,e,i){super(t.state,t.options),this.base=t,this.pos=e,this.node=i}static create(t,e,i){return new js(t,e,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let t=this.state.doc.lineAt(this.node.from);for(;;){let e=this.node.resolve(t.from);for(;e.parent&&e.parent.from==e.from;)e=e.parent;if(pd(e,this.node))break;t=this.state.doc.lineAt(e.from)}return this.lineIndent(t.from)}continue(){let t=this.node.parent;return t?fa(t,this.pos,this.base):0}}function pd(r,t){for(let e=t;e;e=e.parent)if(r==e)return!0;return!1}function gd(r){let t=r.node,e=t.childAfter(t.from),i=t.lastChild;if(!e)return null;let n=r.options.simulateBreak,s=r.state.doc.lineAt(e.from),o=n==null||n<=s.from?s.to:Math.min(s.to,n);for(let l=e.to;;){let h=t.childAfter(l);if(!h||h==i)return null;if(!h.type.isSkipped)return h.from<o?e:null;l=h.to}}function md(r,t,e,i,n){let s=r.textAfter,o=s.match(/^\s*/)[0].length,l=i&&s.slice(o,o+i.length)==i||n==r.pos+o,h=t?gd(r):null;return h?l?r.column(h.from):r.column(h.to):r.baseIndent+(l?0:r.unit*e)}function pl({except:r,units:t=1}={}){return e=>{let i=r&&r.test(e.textAfter);return e.baseIndent+(i?0:t*e.unit)}}const bd=new K;function yd(r){let t=r.firstChild,e=r.lastChild;return t&&t.to<e.from?{from:t.to,to:e.type.isError?r.to:e.from}:null}const wd=1e4,xd="()[]{}";function Ss(r,t,e){let i=r.prop(t<0?K.openedBy:K.closedBy);if(i)return i;if(r.name.length==1){let n=e.indexOf(r.name);if(n>-1&&n%2==(t<0?1:0))return[e[n+t]]}return null}function Je(r,t,e,i={}){let n=i.maxScanDistance||wd,s=i.brackets||xd,o=De(r),l=o.resolveInner(t,e);for(let h=l;h;h=h.parent){let a=Ss(h.type,e,s);if(a&&h.from<h.to)return kd(r,t,e,h,a,s)}return vd(r,t,e,o,l.type,n,s)}function kd(r,t,e,i,n,s){let o=i.parent,l={from:i.from,to:i.to},h=0,a=o==null?void 0:o.cursor();if(a&&(e<0?a.childBefore(i.from):a.childAfter(i.to)))do if(e<0?a.to<=i.from:a.from>=i.to){if(h==0&&n.indexOf(a.type.name)>-1&&a.from<a.to)return{start:l,end:{from:a.from,to:a.to},matched:!0};if(Ss(a.type,e,s))h++;else if(Ss(a.type,-e,s)){if(h==0)return{start:l,end:a.from==a.to?void 0:{from:a.from,to:a.to},matched:!1};h--}}while(e<0?a.prevSibling():a.nextSibling());return{start:l,matched:!1}}function vd(r,t,e,i,n,s,o){let l=e<0?r.sliceDoc(t-1,t):r.sliceDoc(t,t+1),h=o.indexOf(l);if(h<0||h%2==0!=e>0)return null;let a={from:e<0?t-1:t,to:e>0?t+1:t},f=r.doc.iterRange(t,e>0?r.doc.length:0),u=0;for(let c=0;!f.next().done&&c<=s;){let d=f.value;e<0&&(c+=d.length);let p=t+c*e;for(let x=e>0?0:d.length-1,S=e>0?d.length:-1;x!=S;x+=e){let k=o.indexOf(d[x]);if(!(k<0||i.resolveInner(p+x,1).type!=n))if(k%2==0==e>0)u++;else{if(u==1)return{start:a,end:{from:p+x,to:p+x+1},matched:k>>1==h>>1};u--}}e>0&&(c+=d.length)}return f.done?{start:a,matched:!1}:null}const Sd=Object.create(null),gl=[Nt.none],ml=[],Ad=Object.create(null);for(let[r,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Ad[r]=Cd(Sd,t);function Rr(r,t){ml.indexOf(r)>-1||(ml.push(r),console.warn(t))}function Cd(r,t){let e=null;for(let s of t.split(".")){let o=r[s]||R[s];o?typeof o=="function"?e?e=o(e):Rr(s,`Modifier ${s} used at start of tag`):e?Rr(s,`Tag ${s} used as modifier`):e=o:Rr(s,`Unknown highlighting tag ${s}`)}if(!e)return 0;let i=t.replace(/ /g,"_"),n=Nt.define({id:gl.length,name:i,props:[oa({[i]:e})]});return gl.push(n),n.id}const Od=1024;let Td=0;class et{constructor(t={}){this.id=Td++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof t!="function"&&(t=ye.match(t)),e=>{let i=t(e);return i===void 0?null:[this,i]}}}et.closedBy=new et({deserialize:r=>r.split(" ")});et.openedBy=new et({deserialize:r=>r.split(" ")});et.group=new et({deserialize:r=>r.split(" ")});et.contextHash=new et({perNode:!0});et.lookAhead=new et({perNode:!0});et.mounted=new et({perNode:!0});const _d=Object.create(null);class ye{constructor(t,e,i,n=0){this.name=t,this.props=e,this.id=i,this.flags=n}static define(t){let e=t.props&&t.props.length?Object.create(null):_d,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(t.name==null?8:0),n=new ye(t.name||"",e,t.id,i);if(t.props){for(let s of t.props)if(Array.isArray(s)||(s=s(n)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[s[0].id]=s[1]}}return n}prop(t){return this.props[t.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(t){if(typeof t=="string"){if(this.name==t)return!0;let e=this.prop(et.group);return e?e.indexOf(t)>-1:!1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let n of i.split(" "))e[n]=t[i];return i=>{for(let n=i.prop(et.group),s=-1;s<(n?n.length:0);s++){let o=e[s<0?i.name:n[s]];if(o)return o}}}}ye.none=new ye("",Object.create(null),0,8);const en=new WeakMap,bl=new WeakMap;var St;(function(r){r[r.ExcludeBuffers=1]="ExcludeBuffers",r[r.IncludeAnonymous=2]="IncludeAnonymous",r[r.IgnoreMounts=4]="IgnoreMounts",r[r.IgnoreOverlays=8]="IgnoreOverlays"})(St||(St={}));class ee{constructor(t,e,i,n,s){if(this.type=t,this.children=e,this.positions=i,this.length=n,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,l]of s)this.props[typeof o=="number"?o:o.id]=l}}toString(){let t=this.prop(et.mounted);if(t&&!t.overlay)return t.tree.toString();let e="";for(let i of this.children){let n=i.toString();n&&(e&&(e+=","),e+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t=0){return new Kn(this.topNode,t)}cursorAt(t,e=0,i=0){let n=en.get(this)||this.topNode,s=new Kn(n);return s.moveTo(t,e),en.set(this,s._tree),s}get topNode(){return new pe(this,0,0,null)}resolve(t,e=0){let i=fi(en.get(this)||this.topNode,t,e,!1);return en.set(this,i),i}resolveInner(t,e=0){let i=fi(bl.get(this)||this.topNode,t,e,!0);return bl.set(this,i),i}iterate(t){let{enter:e,leave:i,from:n=0,to:s=this.length}=t;for(let o=this.cursor((t.mode||0)|St.IncludeAnonymous);;){let l=!1;if(o.from<=s&&o.to>=n&&(o.type.isAnonymous||e(o)!==!1)){if(o.firstChild())continue;l=!0}for(;l&&i&&!o.type.isAnonymous&&i(o),!o.nextSibling();){if(!o.parent())return;l=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:Ks(ye.none,this.children,this.positions,0,this.children.length,0,this.length,(e,i,n)=>new ee(this.type,e,i,n,this.propValues),t.makeTree||((e,i,n)=>new ee(ye.none,e,i,n)))}static build(t){return Md(t)}}ee.empty=new ee(ye.none,[],[],0);class Gs{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Gs(this.buffer,this.index)}}class qe{constructor(t,e,i){this.buffer=t,this.length=e,this.set=i}get type(){return ye.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],n=this.set.types[e],s=n.name;if(/\W/.test(s)&&!n.isError&&(s=JSON.stringify(s)),t+=4,i==t)return s;let o=[];for(;t<i;)o.push(this.childString(t)),t=this.buffer[t+3];return s+"("+o.join(",")+")"}findChild(t,e,i,n,s){let{buffer:o}=this,l=-1;for(let h=t;h!=e&&!(ua(s,n,o[h+1],o[h+2])&&(l=h,i>0));h=o[h+3]);return l}slice(t,e,i,n){let s=this.buffer,o=new Uint16Array(e-t);for(let l=t,h=0;l<e;)o[h++]=s[l++],o[h++]=s[l++]-i,o[h++]=s[l++]-i,o[h++]=s[l++]-t;return new qe(o,n-i,this.set)}}function ua(r,t,e,i){switch(r){case-2:return e<t;case-1:return i>=t&&e<t;case 0:return e<t&&i>t;case 1:return e<=t&&i>t;case 2:return i>t;case 4:return!0}}function ca(r,t){let e=r.childBefore(t);for(;e;){let i=e.lastChild;if(!i||i.to!=e.to)break;i.type.isError&&i.from==i.to?(r=e,e=i.prevSibling):e=i}return r}function fi(r,t,e,i){for(var n;r.from==r.to||(e<1?r.from>=t:r.from>t)||(e>-1?r.to<=t:r.to<t);){let o=!i&&r instanceof pe&&r.index<0?null:r.parent;if(!o)return r;r=o}let s=i?0:St.IgnoreOverlays;if(i)for(let o=r,l=o.parent;l;o=l,l=o.parent)o instanceof pe&&o.index<0&&((n=l.enter(t,e,s))===null||n===void 0?void 0:n.from)!=o.from&&(r=l);for(;;){let o=r.enter(t,e,s);if(!o)return r;r=o}}class pe{constructor(t,e,i,n){this._tree=t,this.from=e,this.index=i,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(t,e,i,n,s=0){for(let o=this;;){for(let{children:l,positions:h}=o._tree,a=e>0?l.length:-1;t!=a;t+=e){let f=l[t],u=h[t]+o.from;if(!!ua(n,i,u,u+f.length)){if(f instanceof qe){if(s&St.ExcludeBuffers)continue;let c=f.findChild(0,f.buffer.length,e,i-u,n);if(c>-1)return new Le(new Ld(o,f,t,u),null,c)}else if(s&St.IncludeAnonymous||!f.type.isAnonymous||qs(f)){let c;if(!(s&St.IgnoreMounts)&&f.props&&(c=f.prop(et.mounted))&&!c.overlay)return new pe(c.tree,u,t,o);let d=new pe(f,u,t,o);return s&St.IncludeAnonymous||!d.type.isAnonymous?d:d.nextChild(e<0?f.children.length-1:0,e,i,n)}}}if(s&St.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?t=o.index+e:t=e<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this._tree.children.length-1,-1,t,-2)}enter(t,e,i=0){let n;if(!(i&St.IgnoreOverlays)&&(n=this._tree.prop(et.mounted))&&n.overlay){let s=t-this.from;for(let{from:o,to:l}of n.overlay)if((e>0?o<=s:o<s)&&(e<0?l>=s:l>s))return new pe(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,i)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(t=0){return new Kn(this,t)}get tree(){return this._tree}toTree(){return this._tree}resolve(t,e=0){return fi(this,t,e,!1)}resolveInner(t,e=0){return fi(this,t,e,!0)}enterUnfinishedNodesBefore(t){return ca(this,t)}getChild(t,e=null,i=null){let n=Gn(this,t,e,i);return n.length?n[0]:null}getChildren(t,e=null,i=null){return Gn(this,t,e,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(t){return qn(this,t)}}function Gn(r,t,e,i){let n=r.cursor(),s=[];if(!n.firstChild())return s;if(e!=null){for(;!n.type.is(e);)if(!n.nextSibling())return s}for(;;){if(i!=null&&n.type.is(i))return s;if(n.type.is(t)&&s.push(n.node),!n.nextSibling())return i==null?s:[]}}function qn(r,t,e=t.length-1){for(let i=r.parent;e>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(t[e]&&t[e]!=i.name)return!1;e--}}return!0}class Ld{constructor(t,e,i,n){this.parent=t,this.buffer=e,this.index=i,this.start=n}}class Le{constructor(t,e,i){this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(t,e,i){let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.context.start,i);return s<0?null:new Le(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,i=0){if(i&St.ExcludeBuffers)return null;let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return s<0?null:new Le(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new Le(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new Le(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}cursor(t=0){return new Kn(this,t)}get tree(){return null}toTree(){let t=[],e=[],{buffer:i}=this.context,n=this.index+4,s=i.buffer[this.index+3];if(s>n){let o=i.buffer[this.index+1],l=i.buffer[this.index+2];t.push(i.slice(n,s,o,l)),e.push(0)}return new ee(this.type,t,e,this.to-this.from)}resolve(t,e=0){return fi(this,t,e,!1)}resolveInner(t,e=0){return fi(this,t,e,!0)}enterUnfinishedNodesBefore(t){return ca(this,t)}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,i=null){let n=Gn(this,t,e,i);return n.length?n[0]:null}getChildren(t,e=null,i=null){return Gn(this,t,e,i)}get node(){return this}matchContext(t){return qn(this,t)}}class Kn{constructor(t,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof pe)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let i=t._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=t,this.yieldBuf(t.index)}}get name(){return this.type.name}yieldNode(t){return t?(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0):!1}yieldBuf(t,e){this.index=t;let{start:i,buffer:n}=this.buffer;return this.type=e||n.set.types[n.buffer[t]],this.from=i+n.buffer[t+1],this.to=i+n.buffer[t+2],!0}yield(t){return t?t instanceof pe?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,i){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree._tree.children.length-1:0,t,e,i,this.mode));let{buffer:n}=this.buffer,s=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.buffer.start,i);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,i=this.mode){return this.buffer?i&St.ExcludeBuffers?!1:this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&St.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.mode&St.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode)):!1;let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let n=i<0?0:this.stack[i]+4;if(this.index!=n)return this.yieldBuf(e.findChild(n,this.index,-1,0,4))}else{let n=e.buffer[this.index+3];if(n<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(n)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:n}=this;if(n){if(t>0){if(this.index<n.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(n.buffer.buffer[s+3]<this.index)return!1;({index:e,parent:i}=n)}else({index:e,_parent:i}=this._tree);for(;i;{index:e,_parent:i}=i)if(e>-1)for(let s=e+t,o=t<0?-1:i._tree.children.length;s!=o;s+=t){let l=i._tree.children[s];if(this.mode&St.IncludeAnonymous||l instanceof qe||!l.type.isAnonymous||qs(l))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer){t:for(let n=this.index,s=this.stack.length;s>=0;){for(let o=t;o;o=o._parent)if(o.index==n){if(n==this.index)return o;e=o,i=s+1;break t}n=this.stack[--s]}}for(let n=i;n<this.stack.length;n++)e=new Le(this.buffer,e,this.stack[n]);return this.bufferNode=new Le(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(t,e){for(let i=0;;){let n=!1;if(this.type.isAnonymous||t(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(n=!0)}for(;n&&e&&e(this),n=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,n=!0}}}matchContext(t){if(!this.buffer)return qn(this.node,t);let{buffer:e}=this.buffer,{types:i}=e.set;for(let n=t.length-1,s=this.stack.length-1;n>=0;s--){if(s<0)return qn(this.node,t,n);let o=i[e.buffer[this.stack[s]]];if(!o.isAnonymous){if(t[n]&&t[n]!=o.name)return!1;n--}}return!0}}function qs(r){return r.children.some(t=>t instanceof qe||!t.type.isAnonymous||qs(t))}function Md(r){var t;let{buffer:e,nodeSet:i,maxBufferLength:n=Od,reused:s=[],minRepeatType:o=i.types.length}=r,l=Array.isArray(e)?new Gs(e,e.length):e,h=i.types,a=0,f=0;function u(y,v,g,b,_){let{id:w,start:m,end:A,size:L}=l,D=f;for(;L<0;)if(l.next(),L==-1){let U=s[w];g.push(U),b.push(m-y);return}else if(L==-3){a=w;return}else if(L==-4){f=w;return}else throw new RangeError(`Unrecognized record size: ${L}`);let Y=h[w],H,E,Et=m-y;if(A-m<=n&&(E=x(l.pos-v,_))){let U=new Uint16Array(E.size-E.skip),N=l.pos-E.size,z=U.length;for(;l.pos>N;)z=S(E.start,U,z);H=new qe(U,A-E.start,i),Et=E.start-y}else{let U=l.pos-L;l.next();let N=[],z=[],W=w>=o?w:-1,Q=0,lt=A;for(;l.pos>U;)W>=0&&l.id==W&&l.size>=0?(l.end<=lt-n&&(d(N,z,m,Q,l.end,lt,W,D),Q=N.length,lt=l.end),l.next()):u(m,U,N,z,W);if(W>=0&&Q>0&&Q<N.length&&d(N,z,m,Q,m,lt,W,D),N.reverse(),z.reverse(),W>-1&&Q>0){let zt=c(Y);H=Ks(Y,N,z,0,N.length,0,A-m,zt,zt)}else H=p(Y,N,z,A-m,D-A)}g.push(H),b.push(Et)}function c(y){return(v,g,b)=>{let _=0,w=v.length-1,m,A;if(w>=0&&(m=v[w])instanceof ee){if(!w&&m.type==y&&m.length==b)return m;(A=m.prop(et.lookAhead))&&(_=g[w]+m.length+A)}return p(y,v,g,b,_)}}function d(y,v,g,b,_,w,m,A){let L=[],D=[];for(;y.length>b;)L.push(y.pop()),D.push(v.pop()+g-_);y.push(p(i.types[m],L,D,w-_,A-w)),v.push(_-g)}function p(y,v,g,b,_=0,w){if(a){let m=[et.contextHash,a];w=w?[m].concat(w):[m]}if(_>25){let m=[et.lookAhead,_];w=w?[m].concat(w):[m]}return new ee(y,v,g,b,w)}function x(y,v){let g=l.fork(),b=0,_=0,w=0,m=g.end-n,A={size:0,start:0,skip:0};t:for(let L=g.pos-y;g.pos>L;){let D=g.size;if(g.id==v&&D>=0){A.size=b,A.start=_,A.skip=w,w+=4,b+=4,g.next();continue}let Y=g.pos-D;if(D<0||Y<L||g.start<m)break;let H=g.id>=o?4:0,E=g.start;for(g.next();g.pos>Y;){if(g.size<0)if(g.size==-3)H+=4;else break t;else g.id>=o&&(H+=4);g.next()}_=E,b+=D,w+=H}return(v<0||b==y)&&(A.size=b,A.start=_,A.skip=w),A.size>4?A:void 0}function S(y,v,g){let{id:b,start:_,end:w,size:m}=l;if(l.next(),m>=0&&b<o){let A=g;if(m>4){let L=l.pos-(m-4);for(;l.pos>L;)g=S(y,v,g)}v[--g]=A,v[--g]=w-y,v[--g]=_-y,v[--g]=b}else m==-3?a=b:m==-4&&(f=b);return g}let k=[],B=[];for(;l.pos>0;)u(r.start||0,r.bufferStart||0,k,B,-1);let C=(t=r.length)!==null&&t!==void 0?t:k.length?B[0]+k[0].length:0;return new ee(h[r.topID],k.reverse(),B.reverse(),C)}const yl=new WeakMap;function yn(r,t){if(!r.isAnonymous||t instanceof qe||t.type!=r)return 1;let e=yl.get(t);if(e==null){e=1;for(let i of t.children){if(i.type!=r||!(i instanceof ee)){e=1;break}e+=yn(r,i)}yl.set(t,e)}return e}function Ks(r,t,e,i,n,s,o,l,h){let a=0;for(let p=i;p<n;p++)a+=yn(r,t[p]);let f=Math.ceil(a*1.5/8),u=[],c=[];function d(p,x,S,k,B){for(let C=S;C<k;){let y=C,v=x[C],g=yn(r,p[C]);for(C++;C<k;C++){let b=yn(r,p[C]);if(g+b>=f)break;g+=b}if(C==y+1){if(g>f){let b=p[y];d(b.children,b.positions,0,b.children.length,x[y]+B);continue}u.push(p[y])}else{let b=x[C-1]+p[C-1].length-v;u.push(Ks(r,p,x,y,C,v,b,null,h))}c.push(v+B-s)}}return d(t,e,i,n,0),(l||h)(u,c,o)}new et({perNode:!0});const Bd=r=>{let t=Qs(r.state);return t.line?Pd(r):t.block?Nd(r):!1};function Ys(r,t){return({state:e,dispatch:i})=>{if(e.readOnly)return!1;let n=r(t,e);return n?(i(e.update(n)),!0):!1}}const Pd=Ys(Ed,0),Dd=Ys(da,0),Nd=Ys((r,t)=>da(r,t,Id(t)),0);function Qs(r,t=r.selection.main.head){let e=r.languageDataAt("commentTokens",t);return e.length?e[0]:{}}const yi=50;function Rd(r,{open:t,close:e},i,n){let s=r.sliceDoc(i-yi,i),o=r.sliceDoc(n,n+yi),l=/\s*$/.exec(s)[0].length,h=/^\s*/.exec(o)[0].length,a=s.length-l;if(s.slice(a-t.length,a)==t&&o.slice(h,h+e.length)==e)return{open:{pos:i-l,margin:l&&1},close:{pos:n+h,margin:h&&1}};let f,u;n-i<=2*yi?f=u=r.sliceDoc(i,n):(f=r.sliceDoc(i,i+yi),u=r.sliceDoc(n-yi,n));let c=/^\s*/.exec(f)[0].length,d=/\s*$/.exec(u)[0].length,p=u.length-d-e.length;return f.slice(c,c+t.length)==t&&u.slice(p,p+e.length)==e?{open:{pos:i+c+t.length,margin:/\s/.test(f.charAt(c+t.length))?1:0},close:{pos:n-d-e.length,margin:/\s/.test(u.charAt(p-1))?1:0}}:null}function Id(r){let t=[];for(let e of r.selection.ranges){let i=r.doc.lineAt(e.from),n=e.to<=i.to?i:r.doc.lineAt(e.to),s=t.length-1;s>=0&&t[s].to>i.from?t[s].to=n.to:t.push({from:i.from,to:n.to})}return t}function da(r,t,e=t.selection.ranges){let i=e.map(s=>Qs(t,s.from).block);if(!i.every(s=>s))return null;let n=e.map((s,o)=>Rd(t,i[o],s.from,s.to));if(r!=2&&!n.every(s=>s))return{changes:t.changes(e.map((s,o)=>n[o]?[]:[{from:s.from,insert:i[o].open+" "},{from:s.to,insert:" "+i[o].close}]))};if(r!=1&&n.some(s=>s)){let s=[];for(let o=0,l;o<n.length;o++)if(l=n[o]){let h=i[o],{open:a,close:f}=l;s.push({from:a.pos-h.open.length,to:a.pos+a.margin},{from:f.pos-f.margin,to:f.pos+h.close.length})}return{changes:s}}return null}function Ed(r,t,e=t.selection.ranges){let i=[],n=-1;for(let{from:s,to:o}of e){let l=i.length,h=1e9;for(let a=s;a<=o;){let f=t.doc.lineAt(a);if(f.from>n&&(s==o||o>f.from)){n=f.from;let u=Qs(t,a).line;if(!u)continue;let c=/^\s*/.exec(f.text)[0].length,d=c==f.length,p=f.text.slice(c,c+u.length)==u?c:-1;c<f.text.length&&c<h&&(h=c),i.push({line:f,comment:p,token:u,indent:c,empty:d,single:!1})}a=f.to+1}if(h<1e9)for(let a=l;a<i.length;a++)i[a].indent<i[a].line.text.length&&(i[a].indent=h);i.length==l+1&&(i[l].single=!0)}if(r!=2&&i.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:l,token:h,indent:a,empty:f,single:u}of i)(u||!f)&&s.push({from:l.from+a,insert:h+" "});let o=t.changes(s);return{changes:o,selection:t.selection.map(o,1)}}else if(r!=1&&i.some(s=>s.comment>=0)){let s=[];for(let{line:o,comment:l,token:h}of i)if(l>=0){let a=o.from+l,f=a+h.length;o.text[f-o.from]==" "&&f++,s.push({from:a,to:f})}return{changes:s}}return null}const As=$e.define(),zd=$e.define(),Vd=P.define(),pa=P.define({combine(r){return rr(r,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});function Fd(r){let t=0;return r.iterChangedRanges((e,i)=>t=i),t}const ga=Rt.define({create(){return Jt.empty},update(r,t){let e=t.state.facet(pa),i=t.annotation(As);if(i){let h=t.docChanged?O.single(Fd(t.changes)):void 0,a=Ot.fromTransaction(t,h),f=i.side,u=f==0?r.undone:r.done;return a?u=Yn(u,u.length,e.minDepth,a):u=ya(u,t.startState.selection),new Jt(f==0?i.rest:u,f==0?u:i.rest)}let n=t.annotation(zd);if((n=="full"||n=="before")&&(r=r.isolate()),t.annotation(ft.addToHistory)===!1)return t.changes.empty?r:r.addMapping(t.changes.desc);let s=Ot.fromTransaction(t),o=t.annotation(ft.time),l=t.annotation(ft.userEvent);return s?r=r.addChanges(s,o,l,e.newGroupDelay,e.minDepth):t.selection&&(r=r.addSelection(t.startState.selection,o,l,e.newGroupDelay)),(n=="full"||n=="after")&&(r=r.isolate()),r},toJSON(r){return{done:r.done.map(t=>t.toJSON()),undone:r.undone.map(t=>t.toJSON())}},fromJSON(r){return new Jt(r.done.map(Ot.fromJSON),r.undone.map(Ot.fromJSON))}});function Hd(r={}){return[ga,pa.of(r),F.domEventHandlers({beforeinput(t,e){let i=t.inputType=="historyUndo"?Ud:t.inputType=="historyRedo"?Wd:null;return i?(t.preventDefault(),i(e)):!1}})]}function ma(r,t){return function({state:e,dispatch:i}){if(!t&&e.readOnly)return!1;let n=e.field(ga,!1);if(!n)return!1;let s=n.pop(r,e,t);return s?(i(s),!0):!1}}const Ud=ma(0,!1),Wd=ma(1,!1);class Ot{constructor(t,e,i,n,s){this.changes=t,this.effects=e,this.mapped=i,this.startSelection=n,this.selectionsAfter=s}setSelAfter(t){return new Ot(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,e,i;return{changes:(t=this.changes)===null||t===void 0?void 0:t.toJSON(),mapped:(e=this.mapped)===null||e===void 0?void 0:e.toJSON(),startSelection:(i=this.startSelection)===null||i===void 0?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map(n=>n.toJSON())}}static fromJSON(t){return new Ot(t.changes&&at.fromJSON(t.changes),[],t.mapped&&Xt.fromJSON(t.mapped),t.startSelection&&O.fromJSON(t.startSelection),t.selectionsAfter.map(O.fromJSON))}static fromTransaction(t,e){let i=Dt;for(let n of t.startState.facet(Vd)){let s=n(t);s.length&&(i=i.concat(s))}return!i.length&&t.changes.empty?null:new Ot(t.changes.invert(t.startState.doc),i,void 0,e||t.startState.selection,Dt)}static selection(t){return new Ot(void 0,Dt,void 0,void 0,t)}}function Yn(r,t,e,i){let n=t+1>e+20?t-e-1:0,s=r.slice(n,t);return s.push(i),s}function $d(r,t){let e=[],i=!1;return r.iterChangedRanges((n,s)=>e.push(n,s)),t.iterChangedRanges((n,s,o,l)=>{for(let h=0;h<e.length;){let a=e[h++],f=e[h++];l>=a&&o<=f&&(i=!0)}}),i}function jd(r,t){return r.ranges.length==t.ranges.length&&r.ranges.filter((e,i)=>e.empty!=t.ranges[i].empty).length===0}function ba(r,t){return r.length?t.length?r.concat(t):r:t}const Dt=[],Gd=200;function ya(r,t){if(r.length){let e=r[r.length-1],i=e.selectionsAfter.slice(Math.max(0,e.selectionsAfter.length-Gd));return i.length&&i[i.length-1].eq(t)?r:(i.push(t),Yn(r,r.length-1,1e9,e.setSelAfter(i)))}else return[Ot.selection([t])]}function qd(r){let t=r[r.length-1],e=r.slice();return e[r.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),e}function Ir(r,t){if(!r.length)return r;let e=r.length,i=Dt;for(;e;){let n=Kd(r[e-1],t,i);if(n.changes&&!n.changes.empty||n.effects.length){let s=r.slice(0,e);return s[e-1]=n,s}else t=n.mapped,e--,i=n.selectionsAfter}return i.length?[Ot.selection(i)]:Dt}function Kd(r,t,e){let i=ba(r.selectionsAfter.length?r.selectionsAfter.map(l=>l.map(t)):Dt,e);if(!r.changes)return Ot.selection(i);let n=r.changes.map(t),s=t.mapDesc(r.changes,!0),o=r.mapped?r.mapped.composeDesc(s):s;return new Ot(n,J.mapEffects(r.effects,t),o,r.startSelection.map(s),i)}const Yd=/^(input\.type|delete)($|\.)/;class Jt{constructor(t,e,i=0,n=void 0){this.done=t,this.undone=e,this.prevTime=i,this.prevUserEvent=n}isolate(){return this.prevTime?new Jt(this.done,this.undone):this}addChanges(t,e,i,n,s){let o=this.done,l=o[o.length-1];return l&&l.changes&&!l.changes.empty&&t.changes&&(!i||Yd.test(i))&&(!l.selectionsAfter.length&&e-this.prevTime<n&&$d(l.changes,t.changes)||i=="input.type.compose")?o=Yn(o,o.length-1,s,new Ot(t.changes.compose(l.changes),ba(t.effects,l.effects),l.mapped,l.startSelection,Dt)):o=Yn(o,o.length,s,t),new Jt(o,Dt,e,i)}addSelection(t,e,i,n){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:Dt;return s.length>0&&e-this.prevTime<n&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&jd(s[s.length-1],t)?this:new Jt(ya(this.done,t),this.undone,e,i)}addMapping(t){return new Jt(Ir(this.done,t),Ir(this.undone,t),this.prevTime,this.prevUserEvent)}pop(t,e,i){let n=t==0?this.done:this.undone;if(n.length==0)return null;let s=n[n.length-1];if(i&&s.selectionsAfter.length)return e.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:As.of({side:t,rest:qd(n)}),userEvent:t==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let o=n.length==1?Dt:n.slice(0,n.length-1);return s.mapped&&(o=Ir(o,s.mapped)),e.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:As.of({side:t,rest:o}),filter:!1,userEvent:t==0?"undo":"redo",scrollIntoView:!0})}else return null}}Jt.empty=new Jt(Dt,Dt);function di(r,t){return O.create(r.ranges.map(t),r.mainIndex)}function re(r,t){return r.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function Ut({state:r,dispatch:t},e){let i=di(r.selection,e);return i.eq(r.selection)?!1:(t(re(r,i)),!0)}function fr(r,t){return O.cursor(t?r.to:r.from)}function wa(r,t){return Ut(r,e=>e.empty?r.moveByChar(e,t):fr(e,t))}function xt(r){return r.textDirectionAt(r.state.selection.main.head)==ut.LTR}const xa=r=>wa(r,!xt(r)),ka=r=>wa(r,xt(r));function va(r,t){return Ut(r,e=>e.empty?r.moveByGroup(e,t):fr(e,t))}const Qd=r=>va(r,!xt(r)),Jd=r=>va(r,xt(r));function Xd(r,t,e){if(t.type.prop(e))return!0;let i=t.to-t.from;return i&&(i>2||/[^\s,.;:]/.test(r.sliceDoc(t.from,t.to)))||t.firstChild}function ur(r,t,e){let i=De(r).resolveInner(t.head),n=e?et.closedBy:et.openedBy;for(let h=t.head;;){let a=e?i.childAfter(h):i.childBefore(h);if(!a)break;Xd(r,a,n)?i=a:h=e?a.to:a.from}let s=i.type.prop(n),o,l;return s&&(o=e?Je(r,i.from,1):Je(r,i.to,-1))&&o.matched?l=e?o.end.to:o.end.from:l=e?i.to:i.from,O.cursor(l,e?-1:1)}const Zd=r=>Ut(r,t=>ur(r.state,t,!xt(r))),tp=r=>Ut(r,t=>ur(r.state,t,xt(r)));function Sa(r,t){return Ut(r,e=>{if(!e.empty)return fr(e,t);let i=r.moveVertically(e,t);return i.head!=e.head?i:r.moveToLineBoundary(e,t)})}const Aa=r=>Sa(r,!1),Ca=r=>Sa(r,!0);function Oa(r){return Math.max(r.defaultLineHeight,Math.min(r.dom.clientHeight,innerHeight)-5)}function Ta(r,t){let{state:e}=r,i=di(e.selection,l=>l.empty?r.moveVertically(l,t,Oa(r)):fr(l,t));if(i.eq(e.selection))return!1;let n=r.coordsAtPos(e.selection.main.head),s=r.scrollDOM.getBoundingClientRect(),o;return n&&n.top>s.top&&n.bottom<s.bottom&&n.top-s.top<=r.scrollDOM.scrollHeight-r.scrollDOM.scrollTop-r.scrollDOM.clientHeight&&(o=F.scrollIntoView(i.main.head,{y:"start",yMargin:n.top-s.top})),r.dispatch(re(e,i),{effects:o}),!0}const wl=r=>Ta(r,!1),Cs=r=>Ta(r,!0);function Ne(r,t,e){let i=r.lineBlockAt(t.head),n=r.moveToLineBoundary(t,e);if(n.head==t.head&&n.head!=(e?i.to:i.from)&&(n=r.moveToLineBoundary(t,e,!1)),!e&&n.head==i.from&&i.length){let s=/^\s*/.exec(r.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length;s&&t.head!=i.from+s&&(n=O.cursor(i.from+s))}return n}const ep=r=>Ut(r,t=>Ne(r,t,!0)),ip=r=>Ut(r,t=>Ne(r,t,!1)),np=r=>Ut(r,t=>Ne(r,t,!xt(r))),rp=r=>Ut(r,t=>Ne(r,t,xt(r))),sp=r=>Ut(r,t=>O.cursor(r.lineBlockAt(t.head).from,1)),op=r=>Ut(r,t=>O.cursor(r.lineBlockAt(t.head).to,-1));function lp(r,t,e){let i=!1,n=di(r.selection,s=>{let o=Je(r,s.head,-1)||Je(r,s.head,1)||s.head>0&&Je(r,s.head-1,1)||s.head<r.doc.length&&Je(r,s.head+1,-1);if(!o||!o.end)return s;i=!0;let l=o.start.from==s.head?o.end.to:o.end.from;return e?O.range(s.anchor,l):O.cursor(l)});return i?(t(re(r,n)),!0):!1}const hp=({state:r,dispatch:t})=>lp(r,t,!1);function It(r,t){let e=di(r.state.selection,i=>{let n=t(i);return O.range(i.anchor,n.head,n.goalColumn)});return e.eq(r.state.selection)?!1:(r.dispatch(re(r.state,e)),!0)}function _a(r,t){return It(r,e=>r.moveByChar(e,t))}const La=r=>_a(r,!xt(r)),Ma=r=>_a(r,xt(r));function Ba(r,t){return It(r,e=>r.moveByGroup(e,t))}const ap=r=>Ba(r,!xt(r)),fp=r=>Ba(r,xt(r)),up=r=>It(r,t=>ur(r.state,t,!xt(r))),cp=r=>It(r,t=>ur(r.state,t,xt(r)));function Pa(r,t){return It(r,e=>r.moveVertically(e,t))}const Da=r=>Pa(r,!1),Na=r=>Pa(r,!0);function Ra(r,t){return It(r,e=>r.moveVertically(e,t,Oa(r)))}const xl=r=>Ra(r,!1),kl=r=>Ra(r,!0),dp=r=>It(r,t=>Ne(r,t,!0)),pp=r=>It(r,t=>Ne(r,t,!1)),gp=r=>It(r,t=>Ne(r,t,!xt(r))),mp=r=>It(r,t=>Ne(r,t,xt(r))),bp=r=>It(r,t=>O.cursor(r.lineBlockAt(t.head).from)),yp=r=>It(r,t=>O.cursor(r.lineBlockAt(t.head).to)),vl=({state:r,dispatch:t})=>(t(re(r,{anchor:0})),!0),Sl=({state:r,dispatch:t})=>(t(re(r,{anchor:r.doc.length})),!0),Al=({state:r,dispatch:t})=>(t(re(r,{anchor:r.selection.main.anchor,head:0})),!0),Cl=({state:r,dispatch:t})=>(t(re(r,{anchor:r.selection.main.anchor,head:r.doc.length})),!0),wp=({state:r,dispatch:t})=>(t(r.update({selection:{anchor:0,head:r.doc.length},userEvent:"select"})),!0),xp=({state:r,dispatch:t})=>{let e=pr(r).map(({from:i,to:n})=>O.range(i,Math.min(n+1,r.doc.length)));return t(r.update({selection:O.create(e),userEvent:"select"})),!0},kp=({state:r,dispatch:t})=>{let e=di(r.selection,i=>{var n;let s=De(r).resolveInner(i.head,1);for(;!(s.from<i.from&&s.to>=i.to||s.to>i.to&&s.from<=i.from||!(!((n=s.parent)===null||n===void 0)&&n.parent));)s=s.parent;return O.range(s.to,s.from)});return t(re(r,e)),!0},vp=({state:r,dispatch:t})=>{let e=r.selection,i=null;return e.ranges.length>1?i=O.create([e.main]):e.main.empty||(i=O.create([O.cursor(e.main.head)])),i?(t(re(r,i)),!0):!1};function cr({state:r,dispatch:t},e){if(r.readOnly)return!1;let i="delete.selection",n=r.changeByRange(s=>{let{from:o,to:l}=s;if(o==l){let h=e(o);h<o?i="delete.backward":h>o&&(i="delete.forward"),o=Math.min(o,h),l=Math.max(l,h)}return o==l?{range:s}:{changes:{from:o,to:l},range:O.cursor(o)}});return n.changes.empty?!1:(t(r.update(n,{scrollIntoView:!0,userEvent:i,effects:i=="delete.selection"?F.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function dr(r,t,e){if(r instanceof F)for(let i of r.state.facet(F.atomicRanges).map(n=>n(r)))i.between(t,t,(n,s)=>{n<t&&s>t&&(t=e?s:n)});return t}const Ia=(r,t)=>cr(r,e=>{let{state:i}=r,n=i.doc.lineAt(e),s,o;if(!t&&e>n.from&&e<n.from+200&&!/[^ \t]/.test(s=n.text.slice(0,e-n.from))){if(s[s.length-1]=="	")return e-1;let l=Ms(s,i.tabSize),h=l%$n(i)||$n(i);for(let a=0;a<h&&s[s.length-1-a]==" ";a++)e--;o=e}else o=Bt(n.text,e-n.from,t,t)+n.from,o==e&&n.number!=(t?i.doc.lines:1)&&(o+=t?1:-1);return dr(r,o,t)}),Os=r=>Ia(r,!1),Ea=r=>Ia(r,!0),za=(r,t)=>cr(r,e=>{let i=e,{state:n}=r,s=n.doc.lineAt(i),o=n.charCategorizer(i);for(let l=null;;){if(i==(t?s.to:s.from)){i==e&&s.number!=(t?n.doc.lines:1)&&(i+=t?1:-1);break}let h=Bt(s.text,i-s.from,t)+s.from,a=s.text.slice(Math.min(i,h)-s.from,Math.max(i,h)-s.from),f=o(a);if(l!=null&&f!=l)break;(a!=" "||i!=e)&&(l=f),i=h}return dr(r,i,t)}),Va=r=>za(r,!1),Sp=r=>za(r,!0),Fa=r=>cr(r,t=>{let e=r.lineBlockAt(t).to;return dr(r,t<e?e:Math.min(r.state.doc.length,t+1),!0)}),Ap=r=>cr(r,t=>{let e=r.lineBlockAt(t).from;return dr(r,t>e?e:Math.max(0,t-1),!1)}),Cp=({state:r,dispatch:t})=>{if(r.readOnly)return!1;let e=r.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:G.of(["",""])},range:O.cursor(i.from)}));return t(r.update(e,{scrollIntoView:!0,userEvent:"input"})),!0},Op=({state:r,dispatch:t})=>{if(r.readOnly)return!1;let e=r.changeByRange(i=>{if(!i.empty||i.from==0||i.from==r.doc.length)return{range:i};let n=i.from,s=r.doc.lineAt(n),o=n==s.from?n-1:Bt(s.text,n-s.from,!1)+s.from,l=n==s.to?n+1:Bt(s.text,n-s.from,!0)+s.from;return{changes:{from:o,to:l,insert:r.doc.slice(n,l).append(r.doc.slice(o,n))},range:O.cursor(l)}});return e.changes.empty?!1:(t(r.update(e,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function pr(r){let t=[],e=-1;for(let i of r.selection.ranges){let n=r.doc.lineAt(i.from),s=r.doc.lineAt(i.to);if(!i.empty&&i.to==s.from&&(s=r.doc.lineAt(i.to-1)),e>=n.number){let o=t[t.length-1];o.to=s.to,o.ranges.push(i)}else t.push({from:n.from,to:s.to,ranges:[i]});e=s.number+1}return t}function Ha(r,t,e){if(r.readOnly)return!1;let i=[],n=[];for(let s of pr(r)){if(e?s.to==r.doc.length:s.from==0)continue;let o=r.doc.lineAt(e?s.to+1:s.from-1),l=o.length+1;if(e){i.push({from:s.to,to:o.to},{from:s.from,insert:o.text+r.lineBreak});for(let h of s.ranges)n.push(O.range(Math.min(r.doc.length,h.anchor+l),Math.min(r.doc.length,h.head+l)))}else{i.push({from:o.from,to:s.from},{from:s.to,insert:r.lineBreak+o.text});for(let h of s.ranges)n.push(O.range(h.anchor-l,h.head-l))}}return i.length?(t(r.update({changes:i,scrollIntoView:!0,selection:O.create(n,r.selection.mainIndex),userEvent:"move.line"})),!0):!1}const Tp=({state:r,dispatch:t})=>Ha(r,t,!1),_p=({state:r,dispatch:t})=>Ha(r,t,!0);function Ua(r,t,e){if(r.readOnly)return!1;let i=[];for(let n of pr(r))e?i.push({from:n.from,insert:r.doc.slice(n.from,n.to)+r.lineBreak}):i.push({from:n.to,insert:r.lineBreak+r.doc.slice(n.from,n.to)});return t(r.update({changes:i,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const Lp=({state:r,dispatch:t})=>Ua(r,t,!1),Mp=({state:r,dispatch:t})=>Ua(r,t,!0),Bp=r=>{if(r.state.readOnly)return!1;let{state:t}=r,e=t.changes(pr(t).map(({from:n,to:s})=>(n>0?n--:s<t.doc.length&&s++,{from:n,to:s}))),i=di(t.selection,n=>r.moveVertically(n,!0)).map(e);return r.dispatch({changes:e,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0};function Pp(r,t){if(/\(\)|\[\]|\{\}/.test(r.sliceDoc(t-1,t+1)))return{from:t,to:t};let e=De(r).resolveInner(t),i=e.childBefore(t),n=e.childAfter(t),s;return i&&n&&i.to<=t&&n.from>=t&&(s=i.type.prop(et.closedBy))&&s.indexOf(n.name)>-1&&r.doc.lineAt(i.to).from==r.doc.lineAt(n.from).from?{from:i.to,to:n.from}:null}const Dp=Wa(!1),Np=Wa(!0);function Wa(r){return({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange(n=>{let{from:s,to:o}=n,l=t.doc.lineAt(s),h=!r&&s==o&&Pp(t,s);r&&(s=o=(o<=l.to?l:t.doc.lineAt(o)).to);let a=new ar(t,{simulateBreak:s,simulateDoubleBreak:!!h}),f=ha(a,s);for(f==null&&(f=/^\s*/.exec(t.doc.lineAt(s).text)[0].length);o<l.to&&/\s/.test(l.text[o-l.from]);)o++;h?{from:s,to:o}=h:s>l.from&&s<l.from+100&&!/\S/.test(l.text.slice(0,s))&&(s=l.from);let u=["",jn(t,f)];return h&&u.push(jn(t,a.lineIndent(l.from,-1))),{changes:{from:s,to:o,insert:G.of(u)},range:O.cursor(s+1+u[1].length)}});return e(t.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}}function Js(r,t){let e=-1;return r.changeByRange(i=>{let n=[];for(let o=i.from;o<=i.to;){let l=r.doc.lineAt(o);l.number>e&&(i.empty||i.to>l.from)&&(t(l,n,i),e=l.number),o=l.to+1}let s=r.changes(n);return{changes:n,range:O.range(s.mapPos(i.anchor,1),s.mapPos(i.head,1))}})}const Rp=({state:r,dispatch:t})=>{if(r.readOnly)return!1;let e=Object.create(null),i=new ar(r,{overrideIndentation:s=>{let o=e[s];return o==null?-1:o}}),n=Js(r,(s,o,l)=>{let h=ha(i,s.from);if(h==null)return;/\S/.test(s.text)||(h=0);let a=/^\s*/.exec(s.text)[0],f=jn(r,h);(a!=f||l.from<s.from+a.length)&&(e[s.from]=h,o.push({from:s.from,to:s.from+a.length,insert:f}))});return n.changes.empty||t(r.update(n,{userEvent:"indent"})),!0},Ip=({state:r,dispatch:t})=>r.readOnly?!1:(t(r.update(Js(r,(e,i)=>{i.push({from:e.from,insert:r.facet($s)})}),{userEvent:"input.indent"})),!0),Ep=({state:r,dispatch:t})=>r.readOnly?!1:(t(r.update(Js(r,(e,i)=>{let n=/^\s*/.exec(e.text)[0];if(!n)return;let s=Ms(n,r.tabSize),o=0,l=jn(r,Math.max(0,s-$n(r)));for(;o<n.length&&o<l.length&&n.charCodeAt(o)==l.charCodeAt(o);)o++;i.push({from:e.from+o,to:e.from+n.length,insert:l.slice(o)})}),{userEvent:"delete.dedent"})),!0),zp=[{key:"Ctrl-b",run:xa,shift:La,preventDefault:!0},{key:"Ctrl-f",run:ka,shift:Ma},{key:"Ctrl-p",run:Aa,shift:Da},{key:"Ctrl-n",run:Ca,shift:Na},{key:"Ctrl-a",run:sp,shift:bp},{key:"Ctrl-e",run:op,shift:yp},{key:"Ctrl-d",run:Ea},{key:"Ctrl-h",run:Os},{key:"Ctrl-k",run:Fa},{key:"Ctrl-Alt-h",run:Va},{key:"Ctrl-o",run:Cp},{key:"Ctrl-t",run:Op},{key:"Ctrl-v",run:Cs}],Vp=[{key:"ArrowLeft",run:xa,shift:La,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:Qd,shift:ap,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:np,shift:gp,preventDefault:!0},{key:"ArrowRight",run:ka,shift:Ma,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:Jd,shift:fp,preventDefault:!0},{mac:"Cmd-ArrowRight",run:rp,shift:mp,preventDefault:!0},{key:"ArrowUp",run:Aa,shift:Da,preventDefault:!0},{mac:"Cmd-ArrowUp",run:vl,shift:Al},{mac:"Ctrl-ArrowUp",run:wl,shift:xl},{key:"ArrowDown",run:Ca,shift:Na,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Sl,shift:Cl},{mac:"Ctrl-ArrowDown",run:Cs,shift:kl},{key:"PageUp",run:wl,shift:xl},{key:"PageDown",run:Cs,shift:kl},{key:"Home",run:ip,shift:pp,preventDefault:!0},{key:"Mod-Home",run:vl,shift:Al},{key:"End",run:ep,shift:dp,preventDefault:!0},{key:"Mod-End",run:Sl,shift:Cl},{key:"Enter",run:Dp},{key:"Mod-a",run:wp},{key:"Backspace",run:Os,shift:Os},{key:"Delete",run:Ea},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Va},{key:"Mod-Delete",mac:"Alt-Delete",run:Sp},{mac:"Mod-Backspace",run:Ap},{mac:"Mod-Delete",run:Fa}].concat(zp.map(r=>({mac:r.key,run:r.run,shift:r.shift}))),Fp=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:Zd,shift:up},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:tp,shift:cp},{key:"Alt-ArrowUp",run:Tp},{key:"Shift-Alt-ArrowUp",run:Lp},{key:"Alt-ArrowDown",run:_p},{key:"Shift-Alt-ArrowDown",run:Mp},{key:"Escape",run:vp},{key:"Mod-Enter",run:Np},{key:"Alt-l",mac:"Ctrl-l",run:xp},{key:"Mod-i",run:kp,preventDefault:!0},{key:"Mod-[",run:Ep},{key:"Mod-]",run:Ip},{key:"Mod-Alt-\\",run:Rp},{key:"Shift-Mod-k",run:Bp},{key:"Shift-Mod-\\",run:hp},{key:"Mod-/",run:Bd},{key:"Alt-A",run:Dd}].concat(Vp),$a=1024;let Hp=0;class Er{constructor(t,e){this.from=t,this.to=e}}class it{constructor(t={}){this.id=Hp++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof t!="function"&&(t=Ht.match(t)),e=>{let i=t(e);return i===void 0?null:[this,i]}}}it.closedBy=new it({deserialize:r=>r.split(" ")});it.openedBy=new it({deserialize:r=>r.split(" ")});it.group=new it({deserialize:r=>r.split(" ")});it.contextHash=new it({perNode:!0});it.lookAhead=new it({perNode:!0});it.mounted=new it({perNode:!0});const Up=Object.create(null);class Ht{constructor(t,e,i,n=0){this.name=t,this.props=e,this.id=i,this.flags=n}static define(t){let e=t.props&&t.props.length?Object.create(null):Up,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(t.name==null?8:0),n=new Ht(t.name||"",e,t.id,i);if(t.props){for(let s of t.props)if(Array.isArray(s)||(s=s(n)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[s[0].id]=s[1]}}return n}prop(t){return this.props[t.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(t){if(typeof t=="string"){if(this.name==t)return!0;let e=this.prop(it.group);return e?e.indexOf(t)>-1:!1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let n of i.split(" "))e[n]=t[i];return i=>{for(let n=i.prop(it.group),s=-1;s<(n?n.length:0);s++){let o=e[s<0?i.name:n[s]];if(o)return o}}}}Ht.none=new Ht("",Object.create(null),0,8);class Xs{constructor(t){this.types=t;for(let e=0;e<t.length;e++)if(t[e].id!=e)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...t){let e=[];for(let i of this.types){let n=null;for(let s of t){let o=s(i);o&&(n||(n=Object.assign({},i.props)),n[o[0].id]=o[1])}e.push(n?new Ht(i.name,n,i.id,i.flags):i)}return new Xs(e)}}const nn=new WeakMap,Ol=new WeakMap;var bt;(function(r){r[r.ExcludeBuffers=1]="ExcludeBuffers",r[r.IncludeAnonymous=2]="IncludeAnonymous",r[r.IgnoreMounts=4]="IgnoreMounts",r[r.IgnoreOverlays=8]="IgnoreOverlays"})(bt||(bt={}));class _t{constructor(t,e,i,n,s){if(this.type=t,this.children=e,this.positions=i,this.length=n,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,l]of s)this.props[typeof o=="number"?o:o.id]=l}}toString(){let t=this.prop(it.mounted);if(t&&!t.overlay)return t.tree.toString();let e="";for(let i of this.children){let n=i.toString();n&&(e&&(e+=","),e+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t=0){return new Xn(this.topNode,t)}cursorAt(t,e=0,i=0){let n=nn.get(this)||this.topNode,s=new Xn(n);return s.moveTo(t,e),nn.set(this,s._tree),s}get topNode(){return new ge(this,0,0,null)}resolve(t,e=0){let i=ui(nn.get(this)||this.topNode,t,e,!1);return nn.set(this,i),i}resolveInner(t,e=0){let i=ui(Ol.get(this)||this.topNode,t,e,!0);return Ol.set(this,i),i}iterate(t){let{enter:e,leave:i,from:n=0,to:s=this.length}=t;for(let o=this.cursor((t.mode||0)|bt.IncludeAnonymous);;){let l=!1;if(o.from<=s&&o.to>=n&&(o.type.isAnonymous||e(o)!==!1)){if(o.firstChild())continue;l=!0}for(;l&&i&&!o.type.isAnonymous&&i(o),!o.nextSibling();){if(!o.parent())return;l=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:eo(Ht.none,this.children,this.positions,0,this.children.length,0,this.length,(e,i,n)=>new _t(this.type,e,i,n,this.propValues),t.makeTree||((e,i,n)=>new _t(Ht.none,e,i,n)))}static build(t){return $p(t)}}_t.empty=new _t(Ht.none,[],[],0);class Zs{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Zs(this.buffer,this.index)}}class Ke{constructor(t,e,i){this.buffer=t,this.length=e,this.set=i}get type(){return Ht.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],n=this.set.types[e],s=n.name;if(/\W/.test(s)&&!n.isError&&(s=JSON.stringify(s)),t+=4,i==t)return s;let o=[];for(;t<i;)o.push(this.childString(t)),t=this.buffer[t+3];return s+"("+o.join(",")+")"}findChild(t,e,i,n,s){let{buffer:o}=this,l=-1;for(let h=t;h!=e&&!(ja(s,n,o[h+1],o[h+2])&&(l=h,i>0));h=o[h+3]);return l}slice(t,e,i,n){let s=this.buffer,o=new Uint16Array(e-t);for(let l=t,h=0;l<e;)o[h++]=s[l++],o[h++]=s[l++]-i,o[h++]=s[l++]-i,o[h++]=s[l++]-t;return new Ke(o,n-i,this.set)}}function ja(r,t,e,i){switch(r){case-2:return e<t;case-1:return i>=t&&e<t;case 0:return e<t&&i>t;case 1:return e<=t&&i>t;case 2:return i>t;case 4:return!0}}function Ga(r,t){let e=r.childBefore(t);for(;e;){let i=e.lastChild;if(!i||i.to!=e.to)break;i.type.isError&&i.from==i.to?(r=e,e=i.prevSibling):e=i}return r}function ui(r,t,e,i){for(var n;r.from==r.to||(e<1?r.from>=t:r.from>t)||(e>-1?r.to<=t:r.to<t);){let o=!i&&r instanceof ge&&r.index<0?null:r.parent;if(!o)return r;r=o}let s=i?0:bt.IgnoreOverlays;if(i)for(let o=r,l=o.parent;l;o=l,l=o.parent)o instanceof ge&&o.index<0&&((n=l.enter(t,e,s))===null||n===void 0?void 0:n.from)!=o.from&&(r=l);for(;;){let o=r.enter(t,e,s);if(!o)return r;r=o}}class ge{constructor(t,e,i,n){this._tree=t,this.from=e,this.index=i,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(t,e,i,n,s=0){for(let o=this;;){for(let{children:l,positions:h}=o._tree,a=e>0?l.length:-1;t!=a;t+=e){let f=l[t],u=h[t]+o.from;if(!!ja(n,i,u,u+f.length)){if(f instanceof Ke){if(s&bt.ExcludeBuffers)continue;let c=f.findChild(0,f.buffer.length,e,i-u,n);if(c>-1)return new Me(new Wp(o,f,t,u),null,c)}else if(s&bt.IncludeAnonymous||!f.type.isAnonymous||to(f)){let c;if(!(s&bt.IgnoreMounts)&&f.props&&(c=f.prop(it.mounted))&&!c.overlay)return new ge(c.tree,u,t,o);let d=new ge(f,u,t,o);return s&bt.IncludeAnonymous||!d.type.isAnonymous?d:d.nextChild(e<0?f.children.length-1:0,e,i,n)}}}if(s&bt.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?t=o.index+e:t=e<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this._tree.children.length-1,-1,t,-2)}enter(t,e,i=0){let n;if(!(i&bt.IgnoreOverlays)&&(n=this._tree.prop(it.mounted))&&n.overlay){let s=t-this.from;for(let{from:o,to:l}of n.overlay)if((e>0?o<=s:o<s)&&(e<0?l>=s:l>s))return new ge(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,i)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(t=0){return new Xn(this,t)}get tree(){return this._tree}toTree(){return this._tree}resolve(t,e=0){return ui(this,t,e,!1)}resolveInner(t,e=0){return ui(this,t,e,!0)}enterUnfinishedNodesBefore(t){return Ga(this,t)}getChild(t,e=null,i=null){let n=Qn(this,t,e,i);return n.length?n[0]:null}getChildren(t,e=null,i=null){return Qn(this,t,e,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(t){return Jn(this,t)}}function Qn(r,t,e,i){let n=r.cursor(),s=[];if(!n.firstChild())return s;if(e!=null){for(;!n.type.is(e);)if(!n.nextSibling())return s}for(;;){if(i!=null&&n.type.is(i))return s;if(n.type.is(t)&&s.push(n.node),!n.nextSibling())return i==null?s:[]}}function Jn(r,t,e=t.length-1){for(let i=r.parent;e>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(t[e]&&t[e]!=i.name)return!1;e--}}return!0}class Wp{constructor(t,e,i,n){this.parent=t,this.buffer=e,this.index=i,this.start=n}}class Me{constructor(t,e,i){this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(t,e,i){let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.context.start,i);return s<0?null:new Me(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,i=0){if(i&bt.ExcludeBuffers)return null;let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return s<0?null:new Me(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new Me(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new Me(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}cursor(t=0){return new Xn(this,t)}get tree(){return null}toTree(){let t=[],e=[],{buffer:i}=this.context,n=this.index+4,s=i.buffer[this.index+3];if(s>n){let o=i.buffer[this.index+1],l=i.buffer[this.index+2];t.push(i.slice(n,s,o,l)),e.push(0)}return new _t(this.type,t,e,this.to-this.from)}resolve(t,e=0){return ui(this,t,e,!1)}resolveInner(t,e=0){return ui(this,t,e,!0)}enterUnfinishedNodesBefore(t){return Ga(this,t)}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,i=null){let n=Qn(this,t,e,i);return n.length?n[0]:null}getChildren(t,e=null,i=null){return Qn(this,t,e,i)}get node(){return this}matchContext(t){return Jn(this,t)}}class Xn{constructor(t,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof ge)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let i=t._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=t,this.yieldBuf(t.index)}}get name(){return this.type.name}yieldNode(t){return t?(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0):!1}yieldBuf(t,e){this.index=t;let{start:i,buffer:n}=this.buffer;return this.type=e||n.set.types[n.buffer[t]],this.from=i+n.buffer[t+1],this.to=i+n.buffer[t+2],!0}yield(t){return t?t instanceof ge?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,i){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree._tree.children.length-1:0,t,e,i,this.mode));let{buffer:n}=this.buffer,s=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.buffer.start,i);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,i=this.mode){return this.buffer?i&bt.ExcludeBuffers?!1:this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&bt.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.mode&bt.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode)):!1;let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let n=i<0?0:this.stack[i]+4;if(this.index!=n)return this.yieldBuf(e.findChild(n,this.index,-1,0,4))}else{let n=e.buffer[this.index+3];if(n<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(n)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:n}=this;if(n){if(t>0){if(this.index<n.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(n.buffer.buffer[s+3]<this.index)return!1;({index:e,parent:i}=n)}else({index:e,_parent:i}=this._tree);for(;i;{index:e,_parent:i}=i)if(e>-1)for(let s=e+t,o=t<0?-1:i._tree.children.length;s!=o;s+=t){let l=i._tree.children[s];if(this.mode&bt.IncludeAnonymous||l instanceof Ke||!l.type.isAnonymous||to(l))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer){t:for(let n=this.index,s=this.stack.length;s>=0;){for(let o=t;o;o=o._parent)if(o.index==n){if(n==this.index)return o;e=o,i=s+1;break t}n=this.stack[--s]}}for(let n=i;n<this.stack.length;n++)e=new Me(this.buffer,e,this.stack[n]);return this.bufferNode=new Me(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(t,e){for(let i=0;;){let n=!1;if(this.type.isAnonymous||t(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(n=!0)}for(;n&&e&&e(this),n=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,n=!0}}}matchContext(t){if(!this.buffer)return Jn(this.node,t);let{buffer:e}=this.buffer,{types:i}=e.set;for(let n=t.length-1,s=this.stack.length-1;n>=0;s--){if(s<0)return Jn(this.node,t,n);let o=i[e.buffer[this.stack[s]]];if(!o.isAnonymous){if(t[n]&&t[n]!=o.name)return!1;n--}}return!0}}function to(r){return r.children.some(t=>t instanceof Ke||!t.type.isAnonymous||to(t))}function $p(r){var t;let{buffer:e,nodeSet:i,maxBufferLength:n=$a,reused:s=[],minRepeatType:o=i.types.length}=r,l=Array.isArray(e)?new Zs(e,e.length):e,h=i.types,a=0,f=0;function u(y,v,g,b,_){let{id:w,start:m,end:A,size:L}=l,D=f;for(;L<0;)if(l.next(),L==-1){let U=s[w];g.push(U),b.push(m-y);return}else if(L==-3){a=w;return}else if(L==-4){f=w;return}else throw new RangeError(`Unrecognized record size: ${L}`);let Y=h[w],H,E,Et=m-y;if(A-m<=n&&(E=x(l.pos-v,_))){let U=new Uint16Array(E.size-E.skip),N=l.pos-E.size,z=U.length;for(;l.pos>N;)z=S(E.start,U,z);H=new Ke(U,A-E.start,i),Et=E.start-y}else{let U=l.pos-L;l.next();let N=[],z=[],W=w>=o?w:-1,Q=0,lt=A;for(;l.pos>U;)W>=0&&l.id==W&&l.size>=0?(l.end<=lt-n&&(d(N,z,m,Q,l.end,lt,W,D),Q=N.length,lt=l.end),l.next()):u(m,U,N,z,W);if(W>=0&&Q>0&&Q<N.length&&d(N,z,m,Q,m,lt,W,D),N.reverse(),z.reverse(),W>-1&&Q>0){let zt=c(Y);H=eo(Y,N,z,0,N.length,0,A-m,zt,zt)}else H=p(Y,N,z,A-m,D-A)}g.push(H),b.push(Et)}function c(y){return(v,g,b)=>{let _=0,w=v.length-1,m,A;if(w>=0&&(m=v[w])instanceof _t){if(!w&&m.type==y&&m.length==b)return m;(A=m.prop(it.lookAhead))&&(_=g[w]+m.length+A)}return p(y,v,g,b,_)}}function d(y,v,g,b,_,w,m,A){let L=[],D=[];for(;y.length>b;)L.push(y.pop()),D.push(v.pop()+g-_);y.push(p(i.types[m],L,D,w-_,A-w)),v.push(_-g)}function p(y,v,g,b,_=0,w){if(a){let m=[it.contextHash,a];w=w?[m].concat(w):[m]}if(_>25){let m=[it.lookAhead,_];w=w?[m].concat(w):[m]}return new _t(y,v,g,b,w)}function x(y,v){let g=l.fork(),b=0,_=0,w=0,m=g.end-n,A={size:0,start:0,skip:0};t:for(let L=g.pos-y;g.pos>L;){let D=g.size;if(g.id==v&&D>=0){A.size=b,A.start=_,A.skip=w,w+=4,b+=4,g.next();continue}let Y=g.pos-D;if(D<0||Y<L||g.start<m)break;let H=g.id>=o?4:0,E=g.start;for(g.next();g.pos>Y;){if(g.size<0)if(g.size==-3)H+=4;else break t;else g.id>=o&&(H+=4);g.next()}_=E,b+=D,w+=H}return(v<0||b==y)&&(A.size=b,A.start=_,A.skip=w),A.size>4?A:void 0}function S(y,v,g){let{id:b,start:_,end:w,size:m}=l;if(l.next(),m>=0&&b<o){let A=g;if(m>4){let L=l.pos-(m-4);for(;l.pos>L;)g=S(y,v,g)}v[--g]=A,v[--g]=w-y,v[--g]=_-y,v[--g]=b}else m==-3?a=b:m==-4&&(f=b);return g}let k=[],B=[];for(;l.pos>0;)u(r.start||0,r.bufferStart||0,k,B,-1);let C=(t=r.length)!==null&&t!==void 0?t:k.length?B[0]+k[0].length:0;return new _t(h[r.topID],k.reverse(),B.reverse(),C)}const Tl=new WeakMap;function wn(r,t){if(!r.isAnonymous||t instanceof Ke||t.type!=r)return 1;let e=Tl.get(t);if(e==null){e=1;for(let i of t.children){if(i.type!=r||!(i instanceof _t)){e=1;break}e+=wn(r,i)}Tl.set(t,e)}return e}function eo(r,t,e,i,n,s,o,l,h){let a=0;for(let p=i;p<n;p++)a+=wn(r,t[p]);let f=Math.ceil(a*1.5/8),u=[],c=[];function d(p,x,S,k,B){for(let C=S;C<k;){let y=C,v=x[C],g=wn(r,p[C]);for(C++;C<k;C++){let b=wn(r,p[C]);if(g+b>=f)break;g+=b}if(C==y+1){if(g>f){let b=p[y];d(b.children,b.positions,0,b.children.length,x[y]+B);continue}u.push(p[y])}else{let b=x[C-1]+p[C-1].length-v;u.push(eo(r,p,x,y,C,v,b,null,h))}c.push(v+B-s)}}return d(t,e,i,n,0),(l||h)(u,c,o)}class jp{startParse(t,e,i){return typeof t=="string"&&(t=new Gp(t)),i=i?i.length?i.map(n=>new Er(n.from,n.to)):[new Er(0,0)]:[new Er(0,t.length)],this.createParse(t,e||[],i)}parse(t,e,i){let n=this.startParse(t,e,i);for(;;){let s=n.advance();if(s)return s}}}class Gp{constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,e){return this.string.slice(t,e)}}new it({perNode:!0});class Zn{constructor(t,e,i,n,s,o,l,h,a,f=0,u){this.p=t,this.stack=e,this.state=i,this.reducePos=n,this.pos=s,this.score=o,this.buffer=l,this.bufferBase=h,this.curContext=a,this.lookAhead=f,this.parent=u}toString(){return`[${this.stack.filter((t,e)=>e%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(t,e,i=0){let n=t.parser.context;return new Zn(t,[],e,i,i,0,[],0,n?new _l(n,n.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(t,e){this.stack.push(this.state,e,this.bufferBase+this.buffer.length),this.state=t}reduce(t){let e=t>>19,i=t&65535,{parser:n}=this.p,s=n.dynamicPrecedence(i);if(s&&(this.score+=s),e==0){this.pushState(n.getGoto(this.state,i,!0),this.reducePos),i<n.minRepeatTerm&&this.storeNode(i,this.reducePos,this.reducePos,4,!0),this.reduceContext(i,this.reducePos);return}let o=this.stack.length-(e-1)*3-(t&262144?6:0),l=this.stack[o-2],h=this.stack[o-1],a=this.bufferBase+this.buffer.length-h;if(i<n.minRepeatTerm||t&131072){let f=n.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(i,l,f,a+4,!0)}if(t&262144)this.state=this.stack[o];else{let f=this.stack[o-3];this.state=n.getGoto(f,i,!0)}for(;this.stack.length>o;)this.stack.pop();this.reduceContext(i,l)}storeNode(t,e,i,n=4,s=!1){if(t==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let o=this,l=this.buffer.length;if(l==0&&o.parent&&(l=o.bufferBase-o.parent.bufferBase,o=o.parent),l>0&&o.buffer[l-4]==0&&o.buffer[l-1]>-1){if(e==i)return;if(o.buffer[l-2]>=e){o.buffer[l-2]=i;return}}}if(!s||this.pos==i)this.buffer.push(t,e,i,n);else{let o=this.buffer.length;if(o>0&&this.buffer[o-4]!=0)for(;o>0&&this.buffer[o-2]>i;)this.buffer[o]=this.buffer[o-4],this.buffer[o+1]=this.buffer[o-3],this.buffer[o+2]=this.buffer[o-2],this.buffer[o+3]=this.buffer[o-1],o-=4,n>4&&(n-=4);this.buffer[o]=t,this.buffer[o+1]=e,this.buffer[o+2]=i,this.buffer[o+3]=n}}shift(t,e,i){let n=this.pos;if(t&131072)this.pushState(t&65535,this.pos);else if((t&262144)==0){let s=t,{parser:o}=this.p;(i>this.pos||e<=o.maxNode)&&(this.pos=i,o.stateFlag(s,1)||(this.reducePos=i)),this.pushState(s,n),this.shiftContext(e,n),e<=o.maxNode&&this.buffer.push(e,n,i,4)}else this.pos=i,this.shiftContext(e,n),e<=this.p.parser.maxNode&&this.buffer.push(e,n,i,4)}apply(t,e,i){t&65536?this.reduce(t):this.shift(t,e,i)}useNode(t,e){let i=this.p.reused.length-1;(i<0||this.p.reused[i]!=t)&&(this.p.reused.push(t),i++);let n=this.pos;this.reducePos=this.pos=n+t.length,this.pushState(e,n),this.buffer.push(i,n,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,t,this,this.p.stream.reset(this.pos-t.length)))}split(){let t=this,e=t.buffer.length;for(;e>0&&t.buffer[e-2]>t.reducePos;)e-=4;let i=t.buffer.slice(e),n=t.bufferBase+e;for(;t&&n==t.bufferBase;)t=t.parent;return new Zn(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,i,n,this.curContext,this.lookAhead,t)}recoverByDelete(t,e){let i=t<=this.p.parser.maxNode;i&&this.storeNode(t,this.pos,e,4),this.storeNode(0,this.pos,e,i?8:4),this.pos=this.reducePos=e,this.score-=190}canShift(t){for(let e=new qp(this);;){let i=this.p.parser.stateSlot(e.state,4)||this.p.parser.hasAction(e.state,t);if((i&65536)==0)return!0;if(i==0)return!1;e.reduce(i)}}recoverByInsert(t){if(this.stack.length>=300)return[];let e=this.p.parser.nextStates(this.state);if(e.length>4<<1||this.stack.length>=120){let n=[];for(let s=0,o;s<e.length;s+=2)(o=e[s+1])!=this.state&&this.p.parser.hasAction(o,t)&&n.push(e[s],o);if(this.stack.length<120)for(let s=0;n.length<4<<1&&s<e.length;s+=2){let o=e[s+1];n.some((l,h)=>h&1&&l==o)||n.push(e[s],o)}e=n}let i=[];for(let n=0;n<e.length&&i.length<4;n+=2){let s=e[n+1];if(s==this.state)continue;let o=this.split();o.pushState(s,this.pos),o.storeNode(0,o.pos,o.pos,4,!0),o.shiftContext(e[n],this.pos),o.score-=200,i.push(o)}return i}forceReduce(){let t=this.p.parser.stateSlot(this.state,5);if((t&65536)==0)return!1;let{parser:e}=this.p;if(!e.validAction(this.state,t)){let i=t>>19,n=t&65535,s=this.stack.length-i*3;if(s<0||e.getGoto(this.stack[s],n,!1)<0)return!1;this.storeNode(0,this.reducePos,this.reducePos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(t),!0}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:t}=this.p;return t.data[t.stateSlot(this.state,1)]==65535&&!t.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(t){if(this.state!=t.state||this.stack.length!=t.stack.length)return!1;for(let e=0;e<this.stack.length;e+=3)if(this.stack[e]!=t.stack[e])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(t){return this.p.parser.dialect.flags[t]}shiftContext(t,e){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,t,this,this.p.stream.reset(e)))}reduceContext(t,e){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,t,this,this.p.stream.reset(e)))}emitContext(){let t=this.buffer.length-1;(t<0||this.buffer[t]!=-3)&&this.buffer.push(this.curContext.hash,this.reducePos,this.reducePos,-3)}emitLookAhead(){let t=this.buffer.length-1;(t<0||this.buffer[t]!=-4)&&this.buffer.push(this.lookAhead,this.reducePos,this.reducePos,-4)}updateContext(t){if(t!=this.curContext.context){let e=new _l(this.curContext.tracker,t);e.hash!=this.curContext.hash&&this.emitContext(),this.curContext=e}}setLookAhead(t){t>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=t)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class _l{constructor(t,e){this.tracker=t,this.context=e,this.hash=t.strict?t.hash(e):0}}var Ll;(function(r){r[r.Insert=200]="Insert",r[r.Delete=190]="Delete",r[r.Reduce=100]="Reduce",r[r.MaxNext=4]="MaxNext",r[r.MaxInsertStackDepth=300]="MaxInsertStackDepth",r[r.DampenInsertStackDepth=120]="DampenInsertStackDepth"})(Ll||(Ll={}));class qp{constructor(t){this.start=t,this.state=t.state,this.stack=t.stack,this.base=this.stack.length}reduce(t){let e=t&65535,i=t>>19;i==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(i-1)*3;let n=this.start.p.parser.getGoto(this.stack[this.base-3],e,!0);this.state=n}}class tr{constructor(t,e,i){this.stack=t,this.pos=e,this.index=i,this.buffer=t.buffer,this.index==0&&this.maybeNext()}static create(t,e=t.bufferBase+t.buffer.length){return new tr(t,e,e-t.bufferBase)}maybeNext(){let t=this.stack.parent;t!=null&&(this.index=this.stack.bufferBase-t.bufferBase,this.stack=t,this.buffer=t.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new tr(this.stack,this.pos,this.index)}}class xn{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const Ml=new xn;class Kp{constructor(t,e){this.input=t,this.ranges=e,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=Ml,this.rangeIndex=0,this.pos=this.chunkPos=e[0].from,this.range=e[0],this.end=e[e.length-1].to,this.readNext()}resolveOffset(t,e){let i=this.range,n=this.rangeIndex,s=this.pos+t;for(;s<i.from;){if(!n)return null;let o=this.ranges[--n];s-=i.from-o.to,i=o}for(;e<0?s>i.to:s>=i.to;){if(n==this.ranges.length-1)return null;let o=this.ranges[++n];s+=o.from-i.to,i=o}return s}clipPos(t){if(t>=this.range.from&&t<this.range.to)return t;for(let e of this.ranges)if(e.to>t)return Math.max(t,e.from);return this.end}peek(t){let e=this.chunkOff+t,i,n;if(e>=0&&e<this.chunk.length)i=this.pos+t,n=this.chunk.charCodeAt(e);else{let s=this.resolveOffset(t,1);if(s==null)return-1;if(i=s,i>=this.chunk2Pos&&i<this.chunk2Pos+this.chunk2.length)n=this.chunk2.charCodeAt(i-this.chunk2Pos);else{let o=this.rangeIndex,l=this.range;for(;l.to<=i;)l=this.ranges[++o];this.chunk2=this.input.chunk(this.chunk2Pos=i),i+this.chunk2.length>l.to&&(this.chunk2=this.chunk2.slice(0,l.to-i)),n=this.chunk2.charCodeAt(0)}}return i>=this.token.lookAhead&&(this.token.lookAhead=i+1),n}acceptToken(t,e=0){let i=e?this.resolveOffset(e,-1):this.pos;if(i==null||i<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=t,this.token.end=i}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:t,chunkPos:e}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=t,this.chunk2Pos=e,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let t=this.input.chunk(this.pos),e=this.pos+t.length;this.chunk=e>this.range.to?t.slice(0,this.range.to-this.pos):t,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(t=1){for(this.chunkOff+=t;this.pos+t>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();t-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=t,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(t,e){if(e?(this.token=e,e.start=t,e.lookAhead=t+1,e.value=e.extended=-1):this.token=Ml,this.pos!=t){if(this.pos=t,t==this.end)return this.setDone(),this;for(;t<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;t>=this.range.to;)this.range=this.ranges[++this.rangeIndex];t>=this.chunkPos&&t<this.chunkPos+this.chunk.length?this.chunkOff=t-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(t,e){if(t>=this.chunkPos&&e<=this.chunkPos+this.chunk.length)return this.chunk.slice(t-this.chunkPos,e-this.chunkPos);if(t>=this.chunk2Pos&&e<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(t-this.chunk2Pos,e-this.chunk2Pos);if(t>=this.range.from&&e<=this.range.to)return this.input.read(t,e);let i="";for(let n of this.ranges){if(n.from>=e)break;n.to>t&&(i+=this.input.read(Math.max(n.from,t),Math.min(n.to,e)))}return i}}class kn{constructor(t,e){this.data=t,this.id=e}token(t,e){Yp(this.data,t,e,this.id)}}kn.prototype.contextual=kn.prototype.fallback=kn.prototype.extend=!1;function Yp(r,t,e,i){let n=0,s=1<<i,{parser:o}=e.p,{dialect:l}=o;t:for(;(s&r[n])!=0;){let h=r[n+1];for(let c=n+3;c<h;c+=2)if((r[c+1]&s)>0){let d=r[c];if(l.allows(d)&&(t.token.value==-1||t.token.value==d||o.overrides(d,t.token.value))){t.acceptToken(d);break}}let a=t.next,f=0,u=r[n+2];if(t.next<0&&u>f&&r[h+u*3-3]==65535){n=r[h+u*3-1];continue t}for(;f<u;){let c=f+u>>1,d=h+c+(c<<1),p=r[d],x=r[d+1];if(a<p)u=c;else if(a>=x)f=c+1;else{n=r[d+2],t.advance();continue t}}break}}function rn(r,t=Uint16Array){if(typeof r!="string")return r;let e=null;for(let i=0,n=0;i<r.length;){let s=0;for(;;){let o=r.charCodeAt(i++),l=!1;if(o==126){s=65535;break}o>=92&&o--,o>=34&&o--;let h=o-32;if(h>=46&&(h-=46,l=!0),s+=h,l)break;s*=46}e?e[n++]=s:e=new t(s)}return e}const Vt=typeof process<"u"&&process.env&&/\bparse\b/.test(process.env.LOG);let zr=null;var Bl;(function(r){r[r.Margin=25]="Margin"})(Bl||(Bl={}));function Pl(r,t,e){let i=r.cursor(bt.IncludeAnonymous);for(i.moveTo(t);;)if(!(e<0?i.childBefore(t):i.childAfter(t)))for(;;){if((e<0?i.to<t:i.from>t)&&!i.type.isError)return e<0?Math.max(0,Math.min(i.to-1,t-25)):Math.min(r.length,Math.max(i.from+1,t+25));if(e<0?i.prevSibling():i.nextSibling())break;if(!i.parent())return e<0?0:r.length}}class Qp{constructor(t,e){this.fragments=t,this.nodeSet=e,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let t=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(t){for(this.safeFrom=t.openStart?Pl(t.tree,t.from+t.offset,1)-t.offset:t.from,this.safeTo=t.openEnd?Pl(t.tree,t.to+t.offset,-1)-t.offset:t.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(t.tree),this.start.push(-t.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(t){if(t<this.nextStart)return null;for(;this.fragment&&this.safeTo<=t;)this.nextFragment();if(!this.fragment)return null;for(;;){let e=this.trees.length-1;if(e<0)return this.nextFragment(),null;let i=this.trees[e],n=this.index[e];if(n==i.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let s=i.children[n],o=this.start[e]+i.positions[n];if(o>t)return this.nextStart=o,null;if(s instanceof _t){if(o==t){if(o<this.safeFrom)return null;let l=o+s.length;if(l<=this.safeTo){let h=s.prop(it.lookAhead);if(!h||l+h<this.fragment.to)return s}}this.index[e]++,o+s.length>=Math.max(this.safeFrom,t)&&(this.trees.push(s),this.start.push(o),this.index.push(0))}else this.index[e]++,this.nextStart=o+s.length}}}class Jp{constructor(t,e){this.stream=e,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=t.tokenizers.map(i=>new xn)}getActions(t){let e=0,i=null,{parser:n}=t.p,{tokenizers:s}=n,o=n.stateSlot(t.state,3),l=t.curContext?t.curContext.hash:0,h=0;for(let a=0;a<s.length;a++){if((1<<a&o)==0)continue;let f=s[a],u=this.tokens[a];if(!(i&&!f.fallback)&&((f.contextual||u.start!=t.pos||u.mask!=o||u.context!=l)&&(this.updateCachedToken(u,f,t),u.mask=o,u.context=l),u.lookAhead>u.end+25&&(h=Math.max(u.lookAhead,h)),u.value!=0)){let c=e;if(u.extended>-1&&(e=this.addActions(t,u.extended,u.end,e)),e=this.addActions(t,u.value,u.end,e),!f.extend&&(i=u,e>c))break}}for(;this.actions.length>e;)this.actions.pop();return h&&t.setLookAhead(h),!i&&t.pos==this.stream.end&&(i=new xn,i.value=t.p.parser.eofTerm,i.start=i.end=t.pos,e=this.addActions(t,i.value,i.end,e)),this.mainToken=i,this.actions}getMainToken(t){if(this.mainToken)return this.mainToken;let e=new xn,{pos:i,p:n}=t;return e.start=i,e.end=Math.min(i+1,n.stream.end),e.value=i==n.stream.end?n.parser.eofTerm:0,e}updateCachedToken(t,e,i){let n=this.stream.clipPos(i.pos);if(e.token(this.stream.reset(n,t),i),t.value>-1){let{parser:s}=i.p;for(let o=0;o<s.specialized.length;o++)if(s.specialized[o]==t.value){let l=s.specializers[o](this.stream.read(t.start,t.end),i);if(l>=0&&i.p.parser.dialect.allows(l>>1)){(l&1)==0?t.value=l>>1:t.extended=l>>1;break}}}else t.value=0,t.end=this.stream.clipPos(n+1)}putAction(t,e,i,n){for(let s=0;s<n;s+=3)if(this.actions[s]==t)return n;return this.actions[n++]=t,this.actions[n++]=e,this.actions[n++]=i,n}addActions(t,e,i,n){let{state:s}=t,{parser:o}=t.p,{data:l}=o;for(let h=0;h<2;h++)for(let a=o.stateSlot(s,h?2:1);;a+=3){if(l[a]==65535)if(l[a+1]==1)a=he(l,a+2);else{n==0&&l[a+1]==2&&(n=this.putAction(he(l,a+2),e,i,n));break}l[a]==e&&(n=this.putAction(he(l,a+1),e,i,n))}return n}}var Dl;(function(r){r[r.Distance=5]="Distance",r[r.MaxRemainingPerStep=3]="MaxRemainingPerStep",r[r.MinBufferLengthPrune=500]="MinBufferLengthPrune",r[r.ForceReduceLimit=10]="ForceReduceLimit",r[r.CutDepth=15e3]="CutDepth",r[r.CutTo=9e3]="CutTo"})(Dl||(Dl={}));class Xp{constructor(t,e,i,n){this.parser=t,this.input=e,this.ranges=n,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.stream=new Kp(e,n),this.tokens=new Jp(t,this.stream),this.topTerm=t.top[1];let{from:s}=n[0];this.stacks=[Zn.start(this,t.top[0],s)],this.fragments=i.length&&this.stream.end-s>t.bufferLength*4?new Qp(i,t.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let t=this.stacks,e=this.minStackPos,i=this.stacks=[],n,s;for(let o=0;o<t.length;o++){let l=t[o];for(;;){if(this.tokens.mainToken=null,l.pos>e)i.push(l);else{if(this.advanceStack(l,i,t))continue;{n||(n=[],s=[]),n.push(l);let h=this.tokens.getMainToken(l);s.push(h.value,h.end)}}break}}if(!i.length){let o=n&&tg(n);if(o)return this.stackToTree(o);if(this.parser.strict)throw Vt&&n&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+e);this.recovering||(this.recovering=5)}if(this.recovering&&n){let o=this.stoppedAt!=null&&n[0].pos>this.stoppedAt?n[0]:this.runRecovery(n,s,i);if(o)return this.stackToTree(o.forceAll())}if(this.recovering){let o=this.recovering==1?1:this.recovering*3;if(i.length>o)for(i.sort((l,h)=>h.score-l.score);i.length>o;)i.pop();i.some(l=>l.reducePos>e)&&this.recovering--}else if(i.length>1){t:for(let o=0;o<i.length-1;o++){let l=i[o];for(let h=o+1;h<i.length;h++){let a=i[h];if(l.sameState(a)||l.buffer.length>500&&a.buffer.length>500)if((l.score-a.score||l.buffer.length-a.buffer.length)>0)i.splice(h--,1);else{i.splice(o--,1);continue t}}}}this.minStackPos=i[0].pos;for(let o=1;o<i.length;o++)i[o].pos<this.minStackPos&&(this.minStackPos=i[o].pos);return null}stopAt(t){if(this.stoppedAt!=null&&this.stoppedAt<t)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=t}advanceStack(t,e,i){let n=t.pos,{parser:s}=this,o=Vt?this.stackID(t)+" -> ":"";if(this.stoppedAt!=null&&n>this.stoppedAt)return t.forceReduce()?t:null;if(this.fragments){let a=t.curContext&&t.curContext.tracker.strict,f=a?t.curContext.hash:0;for(let u=this.fragments.nodeAt(n);u;){let c=this.parser.nodeSet.types[u.type.id]==u.type?s.getGoto(t.state,u.type.id):-1;if(c>-1&&u.length&&(!a||(u.prop(it.contextHash)||0)==f))return t.useNode(u,c),Vt&&console.log(o+this.stackID(t)+` (via reuse of ${s.getName(u.type.id)})`),!0;if(!(u instanceof _t)||u.children.length==0||u.positions[0]>0)break;let d=u.children[0];if(d instanceof _t&&u.positions[0]==0)u=d;else break}}let l=s.stateSlot(t.state,4);if(l>0)return t.reduce(l),Vt&&console.log(o+this.stackID(t)+` (via always-reduce ${s.getName(l&65535)})`),!0;if(t.stack.length>=15e3)for(;t.stack.length>9e3&&t.forceReduce(););let h=this.tokens.getActions(t);for(let a=0;a<h.length;){let f=h[a++],u=h[a++],c=h[a++],d=a==h.length||!i,p=d?t:t.split();if(p.apply(f,u,c),Vt&&console.log(o+this.stackID(p)+` (via ${(f&65536)==0?"shift":`reduce of ${s.getName(f&65535)}`} for ${s.getName(u)} @ ${n}${p==t?"":", split"})`),d)return!0;p.pos>n?e.push(p):i.push(p)}return!1}advanceFully(t,e){let i=t.pos;for(;;){if(!this.advanceStack(t,null,null))return!1;if(t.pos>i)return Nl(t,e),!0}}runRecovery(t,e,i){let n=null,s=!1;for(let o=0;o<t.length;o++){let l=t[o],h=e[o<<1],a=e[(o<<1)+1],f=Vt?this.stackID(l)+" -> ":"";if(l.deadEnd&&(s||(s=!0,l.restart(),Vt&&console.log(f+this.stackID(l)+" (restarted)"),this.advanceFully(l,i))))continue;let u=l.split(),c=f;for(let d=0;u.forceReduce()&&d<10&&(Vt&&console.log(c+this.stackID(u)+" (via force-reduce)"),!this.advanceFully(u,i));d++)Vt&&(c=this.stackID(u)+" -> ");for(let d of l.recoverByInsert(h))Vt&&console.log(f+this.stackID(d)+" (via recover-insert)"),this.advanceFully(d,i);this.stream.end>l.pos?(a==l.pos&&(a++,h=0),l.recoverByDelete(h,a),Vt&&console.log(f+this.stackID(l)+` (via recover-delete ${this.parser.getName(h)})`),Nl(l,i)):(!n||n.score<l.score)&&(n=l)}return n}stackToTree(t){return t.close(),_t.build({buffer:tr.create(t),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:t.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(t){let e=(zr||(zr=new WeakMap)).get(t);return e||zr.set(t,e=String.fromCodePoint(this.nextStackID++)),e+t}}function Nl(r,t){for(let e=0;e<t.length;e++){let i=t[e];if(i.pos==r.pos&&i.sameState(r)){t[e].score<r.score&&(t[e]=r);return}}t.push(r)}class Zp{constructor(t,e,i){this.source=t,this.flags=e,this.disabled=i}allows(t){return!this.disabled||this.disabled[t]==0}}class er extends jp{constructor(t){if(super(),this.wrappers=[],t.version!=14)throw new RangeError(`Parser version (${t.version}) doesn't match runtime version (${14})`);let e=t.nodeNames.split(" ");this.minRepeatTerm=e.length;for(let l=0;l<t.repeatNodeCount;l++)e.push("");let i=Object.keys(t.topRules).map(l=>t.topRules[l][1]),n=[];for(let l=0;l<e.length;l++)n.push([]);function s(l,h,a){n[l].push([h,h.deserialize(String(a))])}if(t.nodeProps)for(let l of t.nodeProps){let h=l[0];typeof h=="string"&&(h=it[h]);for(let a=1;a<l.length;){let f=l[a++];if(f>=0)s(f,h,l[a++]);else{let u=l[a+-f];for(let c=-f;c>0;c--)s(l[a++],h,u);a++}}}this.nodeSet=new Xs(e.map((l,h)=>Ht.define({name:h>=this.minRepeatTerm?void 0:l,id:h,props:n[h],top:i.indexOf(h)>-1,error:h==0,skipped:t.skippedNodes&&t.skippedNodes.indexOf(h)>-1}))),t.propSources&&(this.nodeSet=this.nodeSet.extend(...t.propSources)),this.strict=!1,this.bufferLength=$a;let o=rn(t.tokenData);this.context=t.context,this.specializerSpecs=t.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let l=0;l<this.specializerSpecs.length;l++)this.specialized[l]=this.specializerSpecs[l].term;this.specializers=this.specializerSpecs.map(Il),this.states=rn(t.states,Uint32Array),this.data=rn(t.stateData),this.goto=rn(t.goto),this.maxTerm=t.maxTerm,this.tokenizers=t.tokenizers.map(l=>typeof l=="number"?new kn(o,l):l),this.topRules=t.topRules,this.dialects=t.dialects||{},this.dynamicPrecedences=t.dynamicPrecedences||null,this.tokenPrecTable=t.tokenPrec,this.termNames=t.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(t,e,i){let n=new Xp(this,t,e,i);for(let s of this.wrappers)n=s(n,t,e,i);return n}getGoto(t,e,i=!1){let n=this.goto;if(e>=n[0])return-1;for(let s=n[e+1];;){let o=n[s++],l=o&1,h=n[s++];if(l&&i)return h;for(let a=s+(o>>1);s<a;s++)if(n[s]==t)return h;if(l)return-1}}hasAction(t,e){let i=this.data;for(let n=0;n<2;n++)for(let s=this.stateSlot(t,n?2:1),o;;s+=3){if((o=i[s])==65535)if(i[s+1]==1)o=i[s=he(i,s+2)];else{if(i[s+1]==2)return he(i,s+2);break}if(o==e||o==0)return he(i,s+1)}return 0}stateSlot(t,e){return this.states[t*6+e]}stateFlag(t,e){return(this.stateSlot(t,0)&e)>0}validAction(t,e){if(e==this.stateSlot(t,4))return!0;for(let i=this.stateSlot(t,1);;i+=3){if(this.data[i]==65535)if(this.data[i+1]==1)i=he(this.data,i+2);else return!1;if(e==he(this.data,i+1))return!0}}nextStates(t){let e=[];for(let i=this.stateSlot(t,1);;i+=3){if(this.data[i]==65535)if(this.data[i+1]==1)i=he(this.data,i+2);else break;if((this.data[i+2]&1)==0){let n=this.data[i+1];e.some((s,o)=>o&1&&s==n)||e.push(this.data[i],n)}}return e}overrides(t,e){let i=Rl(this.data,this.tokenPrecTable,e);return i<0||Rl(this.data,this.tokenPrecTable,t)<i}configure(t){let e=Object.assign(Object.create(er.prototype),this);if(t.props&&(e.nodeSet=this.nodeSet.extend(...t.props)),t.top){let i=this.topRules[t.top];if(!i)throw new RangeError(`Invalid top rule name ${t.top}`);e.top=i}return t.tokenizers&&(e.tokenizers=this.tokenizers.map(i=>{let n=t.tokenizers.find(s=>s.from==i);return n?n.to:i})),t.specializers&&(e.specializers=this.specializers.slice(),e.specializerSpecs=this.specializerSpecs.map((i,n)=>{let s=t.specializers.find(l=>l.from==i.external);if(!s)return i;let o=Object.assign(Object.assign({},i),{external:s.to});return e.specializers[n]=Il(o),o})),t.contextTracker&&(e.context=t.contextTracker),t.dialect&&(e.dialect=this.parseDialect(t.dialect)),t.strict!=null&&(e.strict=t.strict),t.wrap&&(e.wrappers=e.wrappers.concat(t.wrap)),t.bufferLength!=null&&(e.bufferLength=t.bufferLength),e}hasWrappers(){return this.wrappers.length>0}getName(t){return this.termNames?this.termNames[t]:String(t<=this.maxNode&&this.nodeSet.types[t].name||t)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(t){let e=this.dynamicPrecedences;return e==null?0:e[t]||0}parseDialect(t){let e=Object.keys(this.dialects),i=e.map(()=>!1);if(t)for(let s of t.split(" ")){let o=e.indexOf(s);o>=0&&(i[o]=!0)}let n=null;for(let s=0;s<e.length;s++)if(!i[s])for(let o=this.dialects[e[s]],l;(l=this.data[o++])!=65535;)(n||(n=new Uint8Array(this.maxTerm+1)))[l]=1;return new Zp(t,i,n)}static deserialize(t){return new er(t)}}function he(r,t){return r[t]|r[t+1]<<16}function Rl(r,t,e){for(let i=t,n;(n=r[i])!=65535;i++)if(n==e)return i-t;return-1}function tg(r){let t=null;for(let e of r){let i=e.p.stoppedAt;(e.pos==e.p.stream.end||i!=null&&e.pos>i)&&e.p.parser.stateFlag(e.state,2)&&(!t||t.score<e.score)&&(t=e)}return t}function Il(r){if(r.external){let t=r.extend?1:0;return(e,i)=>r.external(e,i)<<1|t}return r.get}const eg=oa({String:R.string,Number:R.number,"True False":R.bool,PropertyName:R.propertyName,Null:R.null,",":R.separator,"[ ]":R.squareBracket,"{ }":R.brace}),ig=er.deserialize({version:14,states:"$bOVQPOOOOQO'#Cb'#CbOnQPO'#CeOvQPO'#CjOOQO'#Cp'#CpQOQPOOOOQO'#Cg'#CgO}QPO'#CfO!SQPO'#CrOOQO,59P,59PO![QPO,59PO!aQPO'#CuOOQO,59U,59UO!iQPO,59UOVQPO,59QOqQPO'#CkO!nQPO,59^OOQO1G.k1G.kOVQPO'#ClO!vQPO,59aOOQO1G.p1G.pOOQO1G.l1G.lOOQO,59V,59VOOQO-E6i-E6iOOQO,59W,59WOOQO-E6j-E6j",stateData:"#O~OcOS~OQSORSOSSOTSOWQO]ROePO~OVXOeUO~O[[O~PVOg^O~Oh_OVfX~OVaO~OhbO[iX~O[dO~Oh_OVfa~OhbO[ia~O",goto:"!kjPPPPPPkPPkqwPPk{!RPPP!XP!ePP!hXSOR^bQWQRf_TVQ_Q`WRg`QcZRicQTOQZRQe^RhbRYQR]R",nodeNames:"\u26A0 JsonText True False Null Number String } { Object Property PropertyName ] [ Array",maxTerm:25,nodeProps:[["openedBy",7,"{",12,"["],["closedBy",8,"}",13,"]"]],propSources:[eg],skippedNodes:[0],repeatNodeCount:2,tokenData:"(p~RaXY!WYZ!W]^!Wpq!Wrs!]|}$i}!O$n!Q!R$w!R![&V![!]&h!}#O&m#P#Q&r#Y#Z&w#b#c'f#h#i'}#o#p(f#q#r(k~!]Oc~~!`Upq!]qr!]rs!rs#O!]#O#P!w#P~!]~!wOe~~!zXrs!]!P!Q!]#O#P!]#U#V!]#Y#Z!]#b#c!]#f#g!]#h#i!]#i#j#g~#jR!Q![#s!c!i#s#T#Z#s~#vR!Q![$P!c!i$P#T#Z$P~$SR!Q![$]!c!i$]#T#Z$]~$`R!Q![!]!c!i!]#T#Z!]~$nOh~~$qQ!Q!R$w!R![&V~$|RT~!O!P%V!g!h%k#X#Y%k~%YP!Q![%]~%bRT~!Q![%]!g!h%k#X#Y%k~%nR{|%w}!O%w!Q![%}~%zP!Q![%}~&SPT~!Q![%}~&[ST~!O!P%V!Q![&V!g!h%k#X#Y%k~&mOg~~&rO]~~&wO[~~&zP#T#U&}~'QP#`#a'T~'WP#g#h'Z~'^P#X#Y'a~'fOR~~'iP#i#j'l~'oP#`#a'r~'uP#`#a'x~'}OS~~(QP#f#g(T~(WP#i#j(Z~(^P#X#Y(a~(fOQ~~(kOW~~(pOV~",tokenizers:[0],topRules:{JsonText:[0,1]},tokenPrec:0}),ng=()=>r=>{try{JSON.parse(r.state.doc.toString())}catch(t){if(!(t instanceof SyntaxError))throw t;const e=rg(t,r.state.doc);return[{from:e,message:t.message,severity:"error",to:e}]}return[]};function rg(r,t){let e;return(e=r.message.match(/at position (\d+)/))?Math.min(+e[1],t.length):(e=r.message.match(/at line (\d+) column (\d+)/))?Math.min(t.line(+e[1]).from+ +e[2]-1,t.length):0}const sg=Un.define({parser:ig.configure({props:[aa.add({Object:pl({except:/^\s*\}/}),Array:pl({except:/^\s*\]/})}),bd.add({"Object Array":yd})]}),languageData:{closeBrackets:{brackets:["[","{",'"']},indentOnInput:/^\s*[\}\]]$/}});function og(){return new hd(sg)}function Yt(){var r=arguments[0];typeof r=="string"&&(r=document.createElement(r));var t=1,e=arguments[1];if(e&&typeof e=="object"&&e.nodeType==null&&!Array.isArray(e)){for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=e[i];typeof n=="string"?r.setAttribute(i,n):n!=null&&(r[i]=n)}t++}for(;t<arguments.length;t++)qa(r,arguments[t]);return r}function qa(r,t){if(typeof t=="string")r.appendChild(document.createTextNode(t));else if(t!=null)if(t.nodeType!=null)r.appendChild(t);else if(Array.isArray(t))for(var e=0;e<t.length;e++)qa(r,t[e]);else throw new RangeError("Unsupported child node: "+t)}class lg{constructor(t,e,i){this.from=t,this.to=e,this.diagnostic=i}}class Ee{constructor(t,e,i){this.diagnostics=t,this.panel=e,this.selected=i}static init(t,e,i){let n=t,s=i.facet(Fe).markerFilter;s&&(n=s(n));let o=tt.set(n.map(l=>l.from==l.to||l.from==l.to-1&&i.doc.lineAt(l.from).to==l.from?tt.widget({widget:new pg(l),diagnostic:l}).range(l.from):tt.mark({attributes:{class:"cm-lintRange cm-lintRange-"+l.severity},diagnostic:l}).range(l.from,l.to)),!0);return new Ee(o,e,ci(o))}}function ci(r,t=null,e=0){let i=null;return r.between(e,1e9,(n,s,{spec:o})=>{if(!(t&&o.diagnostic!=t))return i=new lg(n,s,o.diagnostic),!1}),i}function Ka(r,t){return!!(r.effects.some(e=>e.is(gr))||r.changes.touchesRange(t.pos))}function hg(r,t){return r.field(Ft,!1)?t:t.concat(J.appendConfig.of([Ft,F.decorations.compute([Ft],e=>{let{selected:i,panel:n}=e.field(Ft);return!i||!n||i.from==i.to?tt.none:tt.set([fg.range(i.from,i.to)])}),Tc(ug,{hideOn:Ka}),gg]))}function ag(r,t){return{effects:hg(r,[gr.of(t)])}}const gr=J.define(),Ya=J.define(),Qa=J.define(),Ft=Rt.define({create(){return new Ee(tt.none,null,null)},update(r,t){if(t.docChanged){let e=r.diagnostics.map(t.changes),i=null;if(r.selected){let n=t.changes.mapPos(r.selected.from,1);i=ci(e,r.selected.diagnostic,n)||ci(e,null,n)}r=new Ee(e,r.panel,i)}for(let e of t.effects)e.is(gr)?r=Ee.init(e.value,r.panel,t.state):e.is(Ya)?r=new Ee(r.diagnostics,e.value?io.open:null,r.selected):e.is(Qa)&&(r=new Ee(r.diagnostics,r.panel,e.value));return r},provide:r=>[xs.from(r,t=>t.panel),F.decorations.from(r,t=>t.diagnostics)]}),fg=tt.mark({class:"cm-lintRange cm-lintRange-active"});function ug(r,t,e){let{diagnostics:i}=r.state.field(Ft),n=[],s=2e8,o=0;i.between(t-(e<0?1:0),t+(e>0?1:0),(h,a,{spec:f})=>{t>=h&&t<=a&&(h==a||(t>h||e>0)&&(t<a||e<0))&&(n.push(f.diagnostic),s=Math.min(h,s),o=Math.max(a,o))});let l=r.state.facet(Fe).tooltipFilter;return l&&(n=l(n)),n.length?{pos:s,end:o,above:r.state.doc.lineAt(s).to<o,create(){return{dom:Ja(r,n)}}}:null}function Ja(r,t){return Yt("ul",{class:"cm-tooltip-lint"},t.map(e=>Za(r,e,!1)))}const El=r=>{let t=r.state.field(Ft,!1);return!t||!t.panel?!1:(r.dispatch({effects:Ya.of(!1)}),!0)},cg=ne.fromClass(class{constructor(r){this.view=r,this.timeout=-1,this.set=!0;let{delay:t}=r.state.facet(Fe);this.lintTime=Date.now()+t,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,t)}run(){let r=Date.now();if(r<this.lintTime-10)setTimeout(this.run,this.lintTime-r);else{this.set=!1;let{state:t}=this.view,{sources:e}=t.facet(Fe);Promise.all(e.map(i=>Promise.resolve(i(this.view)))).then(i=>{let n=i.reduce((s,o)=>s.concat(o));this.view.state.doc==t.doc&&this.view.dispatch(ag(this.view.state,n))},i=>{Zt(this.view.state,i)})}}update(r){let t=r.state.facet(Fe);(r.docChanged||t!=r.startState.facet(Fe))&&(this.lintTime=Date.now()+t.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,t.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}}),Fe=P.define({combine(r){return Object.assign({sources:r.map(t=>t.source)},rr(r.map(t=>t.config),{delay:750,markerFilter:null,tooltipFilter:null}))},enables:cg});function dg(r,t={}){return Fe.of({source:r,config:t})}function Xa(r){let t=[];if(r)t:for(let{name:e}of r){for(let i=0;i<e.length;i++){let n=e[i];if(/[a-zA-Z]/.test(n)&&!t.some(s=>s.toLowerCase()==n.toLowerCase())){t.push(n);continue t}}t.push("")}return t}function Za(r,t,e){var i;let n=e?Xa(t.actions):[];return Yt("li",{class:"cm-diagnostic cm-diagnostic-"+t.severity},Yt("span",{class:"cm-diagnosticText"},t.renderMessage?t.renderMessage():t.message),(i=t.actions)===null||i===void 0?void 0:i.map((s,o)=>{let l=u=>{u.preventDefault();let c=ci(r.state.field(Ft).diagnostics,t);c&&s.apply(r,c.from,c.to)},{name:h}=s,a=n[o]?h.indexOf(n[o]):-1,f=a<0?h:[h.slice(0,a),Yt("u",h.slice(a,a+1)),h.slice(a+1)];return Yt("button",{type:"button",class:"cm-diagnosticAction",onclick:l,onmousedown:l,"aria-label":` Action: ${h}${a<0?"":` (access key "${n[o]})"`}.`},f)}),t.source&&Yt("div",{class:"cm-diagnosticSource"},t.source))}class pg extends zi{constructor(t){super(),this.diagnostic=t}eq(t){return t.diagnostic==this.diagnostic}toDOM(){return Yt("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class zl{constructor(t,e){this.diagnostic=e,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=Za(t,e,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class io{constructor(t){this.view=t,this.items=[];let e=n=>{if(n.keyCode==27)El(this.view),this.view.focus();else if(n.keyCode==38||n.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(n.keyCode==40||n.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(n.keyCode==36)this.moveSelection(0);else if(n.keyCode==35)this.moveSelection(this.items.length-1);else if(n.keyCode==13)this.view.focus();else if(n.keyCode>=65&&n.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:s}=this.items[this.selectedIndex],o=Xa(s.actions);for(let l=0;l<o.length;l++)if(o[l].toUpperCase().charCodeAt(0)==n.keyCode){let h=ci(this.view.state.field(Ft).diagnostics,s);h&&s.actions[l].apply(t,h.from,h.to)}}else return;n.preventDefault()},i=n=>{for(let s=0;s<this.items.length;s++)this.items[s].dom.contains(n.target)&&this.moveSelection(s)};this.list=Yt("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:e,onclick:i}),this.dom=Yt("div",{class:"cm-panel-lint"},this.list,Yt("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>El(this.view)},"\xD7")),this.update()}get selectedIndex(){let t=this.view.state.field(Ft).selected;if(!t)return-1;for(let e=0;e<this.items.length;e++)if(this.items[e].diagnostic==t.diagnostic)return e;return-1}update(){let{diagnostics:t,selected:e}=this.view.state.field(Ft),i=0,n=!1,s=null;for(t.between(0,this.view.state.doc.length,(o,l,{spec:h})=>{let a=-1,f;for(let u=i;u<this.items.length;u++)if(this.items[u].diagnostic==h.diagnostic){a=u;break}a<0?(f=new zl(this.view,h.diagnostic),this.items.splice(i,0,f),n=!0):(f=this.items[a],a>i&&(this.items.splice(i,a-i),n=!0)),e&&f.diagnostic==e.diagnostic?f.dom.hasAttribute("aria-selected")||(f.dom.setAttribute("aria-selected","true"),s=f):f.dom.hasAttribute("aria-selected")&&f.dom.removeAttribute("aria-selected"),i++});i<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)n=!0,this.items.pop();this.items.length==0&&(this.items.push(new zl(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),n=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:o,panel:l})=>{o.top<l.top?this.list.scrollTop-=l.top-o.top:o.bottom>l.bottom&&(this.list.scrollTop+=o.bottom-l.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),n&&this.sync()}sync(){let t=this.list.firstChild;function e(){let i=t;t=i.nextSibling,i.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;t!=i.dom;)e();t=i.dom.nextSibling}else this.list.insertBefore(i.dom,t);for(;t;)e()}moveSelection(t){if(this.selectedIndex<0)return;let e=this.view.state.field(Ft),i=ci(e.diagnostics,this.items[t].diagnostic);!i||this.view.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0,effects:Qa.of(i)})}static open(t){return new io(t)}}function vn(r,t='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${t}>${encodeURIComponent(r)}</svg>')`}function Vr(r){return vn(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${r}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const gg=F.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:Vr("#d11")},".cm-lintRange-warning":{backgroundImage:Vr("orange")},".cm-lintRange-info":{backgroundImage:Vr("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});class mg extends me{constructor(t){super(),this.diagnostics=t,this.severity=t.reduce((e,i)=>{let n=i.severity;return n=="error"||n=="warning"&&e=="info"?n:e},"info")}toDOM(t){let e=document.createElement("div");e.className="cm-lint-marker cm-lint-marker-"+this.severity;let i=this.diagnostics,n=t.state.facet(mr).tooltipFilter;return n&&(i=n(i)),i.length&&(e.onmouseover=()=>yg(t,e,i)),e}}function bg(r,t){let e=i=>{let n=t.getBoundingClientRect();if(!(i.clientX>n.left-10&&i.clientX<n.right+10&&i.clientY>n.top-10&&i.clientY<n.bottom+10)){for(let s=i.target;s;s=s.parentNode)if(s.nodeType==1&&s.classList.contains("cm-tooltip-lint"))return;window.removeEventListener("mousemove",e),r.state.field(ef)&&r.dispatch({effects:no.of(null)})}};window.addEventListener("mousemove",e)}function yg(r,t,e){function i(){let o=r.elementAtHeight(t.getBoundingClientRect().top+5-r.documentTop);r.coordsAtPos(o.from)&&r.dispatch({effects:no.of({pos:o.from,above:!1,create(){return{dom:Ja(r,e),getCoords:()=>t.getBoundingClientRect()}}})}),t.onmouseout=t.onmousemove=null,bg(r,t)}let{hoverTime:n}=r.state.facet(mr),s=setTimeout(i,n);t.onmouseout=()=>{clearTimeout(s),t.onmouseout=t.onmousemove=null},t.onmousemove=()=>{clearTimeout(s),s=setTimeout(i,n)}}function wg(r,t){let e=Object.create(null);for(let n of t){let s=r.lineAt(n.from);(e[s.from]||(e[s.from]=[])).push(n)}let i=[];for(let n in e)i.push(new mg(e[n]).range(+n));return q.of(i,!0)}const xg=Bc({class:"cm-gutter-lint",markers:r=>r.state.field(tf)}),tf=Rt.define({create(){return q.empty},update(r,t){r=r.map(t.changes);let e=t.state.facet(mr).markerFilter;for(let i of t.effects)if(i.is(gr)){let n=i.value;e&&(n=e(n||[])),r=wg(t.state.doc,n.slice(0))}return r}}),no=J.define(),ef=Rt.define({create(){return null},update(r,t){return r&&t.docChanged&&(r=Ka(t,r)?null:Object.assign(Object.assign({},r),{pos:t.changes.mapPos(r.pos)})),t.effects.reduce((e,i)=>i.is(no)?i.value:e,r)},provide:r=>Is.from(r)}),kg=F.baseTheme({".cm-gutter-lint":{width:"1.4em","& .cm-gutterElement":{padding:".2em"}},".cm-lint-marker":{width:"1em",height:"1em"},".cm-lint-marker-info":{content:vn('<path fill="#aaf" stroke="#77e" stroke-width="6" stroke-linejoin="round" d="M5 5L35 5L35 35L5 35Z"/>')},".cm-lint-marker-warning":{content:vn('<path fill="#fe8" stroke="#fd7" stroke-width="6" stroke-linejoin="round" d="M20 6L37 35L3 35Z"/>')},".cm-lint-marker-error:before":{content:vn('<circle cx="20" cy="20" r="15" fill="#f87" stroke="#f43" stroke-width="6"/>')}}),mr=P.define({combine(r){return rr(r,{hoverTime:300,markerFilter:null,tooltipFilter:null})}});function vg(r={}){return[mr.of(r),tf,xg,kg,ef]}function Sg(r){let t,e,i,n,s,o,l=oo()+"",h,a,f,u,c,d,p,x=lo()+"",S,k,B,C,y,v,g;return{c(){t=se("main"),e=se("div"),i=se("div"),n=se("a"),s=oe("Substrait validator"),o=oe(`
      (`),h=oe(l),a=oe(")"),f=br(),u=se("div"),c=se("a"),d=oe("Substrait"),p=oe(`
      (`),S=oe(x),k=oe(")"),B=br(),C=se("div"),y=se("div"),v=br(),g=se("div"),we(n,"href","https://github.com/substrait-io/substrait-validator/releases/tag/v"+oo()),we(i,"class","svelte-ssoq21"),we(c,"href","https://github.com/substrait-io/substrait/releases/tag/v"+lo()),we(u,"class","svelte-ssoq21"),we(e,"class","container svelte-ssoq21"),we(y,"class","svelte-ssoq21"),we(g,"class","output svelte-ssoq21"),we(C,"class","container svelte-ssoq21")},m(b,_){of(b,t,_),ht(t,e),ht(e,i),ht(i,n),ht(n,s),ht(i,o),ht(i,h),ht(i,a),ht(e,f),ht(e,u),ht(u,c),ht(c,d),ht(u,p),ht(u,S),ht(u,k),ht(t,B),ht(t,C),ht(C,y),r[3](y),ht(C,v),ht(C,g),g.innerHTML=r[1]},p(b,[_]){_&2&&(g.innerHTML=b[1])},i:Sn,o:Sn,d(b){b&&Fl(t),r[3](null)}}}function Ag(r,t,e){const i=`{
  "extensionUris": [
    {
      "extensionUriAnchor": 1,
      "uri": "https://raw.githubusercontent.com/substrait-io/substrait/main/extensions/functions_datetime.yaml"
    },
    {
      "extensionUriAnchor": 2,
      "uri": "https://raw.githubusercontent.com/substrait-io/substrait/main/extensions/functions_arithmetic_decimal.yaml"
    },
    {
      "extensionUriAnchor": 3,
      "uri": "https://raw.githubusercontent.com/substrait-io/substrait/main/extensions/functions_aggregate_generic.yaml"
    }
  ],
  "extensions": [
    {
      "extensionFunction": {
        "extensionUriReference": 1,
        "functionAnchor": 1,
        "name": "lte:date_date"
      }
    },
    {
      "extensionFunction": {
        "extensionUriReference": 1,
        "functionAnchor": 2,
        "name": "subtract:date_day"
      }
    },
    {
      "extensionFunction": {
        "extensionUriReference": 2,
        "functionAnchor": 3,
        "name": "multiply:opt_dec_dec"
      }
    },
    {
      "extensionFunction": {
        "extensionUriReference": 2,
        "functionAnchor": 4,
        "name": "subtract:opt_dec_dec"
      }
    },
    {
      "extensionFunction": {
        "extensionUriReference": 2,
        "functionAnchor": 5,
        "name": "add:opt_dec_dec"
      }
    },
    {
      "extensionFunction": {
        "extensionUriReference": 2,
        "functionAnchor": 6,
        "name": "sum:opt_dec"
      }
    },
    {
      "extensionFunction": {
        "extensionUriReference": 2,
        "functionAnchor": 7,
        "name": "avg:opt_dec"
      }
    },
    {
      "extensionFunction": {
        "extensionUriReference": 3,
        "functionAnchor": 8,
        "name": "count:opt"
      }
    }
  ],
  "relations": [
    {
      "root": {
        "input": {
          "sort": {
            "common": {
              "direct": {}
            },
            "input": {
              "aggregate": {
                "common": {
                  "emit": {
                    "outputMapping": [
                      0,
                      1,
                      2,
                      3,
                      4,
                      5,
                      6,
                      7,
                      8,
                      9
                    ]
                  }
                },
                "input": {
                  "project": {
                    "common": {
                      "emit": {
                        "outputMapping": [
                          16,
                          17,
                          18,
                          19,
                          20,
                          21,
                          22
                        ]
                      }
                    },
                    "input": {
                      "filter": {
                        "common": {
                          "direct": {}
                        },
                        "input": {
                          "read": {
                            "common": {
                              "direct": {}
                            },
                            "baseSchema": {
                              "names": [
                                "L_ORDERKEY",
                                "L_PARTKEY",
                                "L_SUPPKEY",
                                "L_LINENUMBER",
                                "L_QUANTITY",
                                "L_EXTENDEDPRICE",
                                "L_DISCOUNT",
                                "L_TAX",
                                "L_RETURNFLAG",
                                "L_LINESTATUS",
                                "L_SHIPDATE",
                                "L_COMMITDATE",
                                "L_RECEIPTDATE",
                                "L_SHIPINSTRUCT",
                                "L_SHIPMODE",
                                "L_COMMENT"
                              ],
                              "struct": {
                                "types": [
                                  {
                                    "i64": {
                                      "nullability": "NULLABILITY_REQUIRED"
                                    }
                                  },
                                  {
                                    "i64": {
                                      "nullability": "NULLABILITY_REQUIRED"
                                    }
                                  },
                                  {
                                    "i64": {
                                      "nullability": "NULLABILITY_REQUIRED"
                                    }
                                  },
                                  {
                                    "i32": {
                                      "nullability": "NULLABILITY_NULLABLE"
                                    }
                                  },
                                  {
                                    "decimal": {
                                      "precision": 19,
                                      "nullability": "NULLABILITY_NULLABLE"
                                    }
                                  },
                                  {
                                    "decimal": {
                                      "precision": 19,
                                      "nullability": "NULLABILITY_NULLABLE"
                                    }
                                  },
                                  {
                                    "decimal": {
                                      "precision": 19,
                                      "nullability": "NULLABILITY_NULLABLE"
                                    }
                                  },
                                  {
                                    "decimal": {
                                      "precision": 19,
                                      "nullability": "NULLABILITY_NULLABLE"
                                    }
                                  },
                                  {
                                    "fixedChar": {
                                      "length": 1,
                                      "nullability": "NULLABILITY_NULLABLE"
                                    }
                                  },
                                  {
                                    "fixedChar": {
                                      "length": 1,
                                      "nullability": "NULLABILITY_NULLABLE"
                                    }
                                  },
                                  {
                                    "date": {
                                      "nullability": "NULLABILITY_NULLABLE"
                                    }
                                  },
                                  {
                                    "date": {
                                      "nullability": "NULLABILITY_NULLABLE"
                                    }
                                  },
                                  {
                                    "date": {
                                      "nullability": "NULLABILITY_NULLABLE"
                                    }
                                  },
                                  {
                                    "fixedChar": {
                                      "length": 25,
                                      "nullability": "NULLABILITY_NULLABLE"
                                    }
                                  },
                                  {
                                    "fixedChar": {
                                      "length": 10,
                                      "nullability": "NULLABILITY_NULLABLE"
                                    }
                                  },
                                  {
                                    "varchar": {
                                      "length": 44,
                                      "nullability": "NULLABILITY_NULLABLE"
                                    }
                                  }
                                ],
                                "nullability": "NULLABILITY_REQUIRED"
                              }
                            },
                            "namedTable": {
                              "names": [
                                "LINEITEM"
                              ]
                            }
                          }
                        },
                        "condition": {
                          "scalarFunction": {
                            "functionReference": 1,
                            "outputType": {
                              "bool": {
                                "nullability": "NULLABILITY_NULLABLE"
                              }
                            },
                            "args": [
                              {
                                "selection": {
                                  "directReference": {
                                    "structField": {
                                      "field": 10
                                    }
                                  },
                                  "rootReference": {}
                                }
                              },
                              {
                                "scalarFunction": {
                                  "functionReference": 2,
                                  "outputType": {
                                    "date": {
                                      "nullability": "NULLABILITY_REQUIRED"
                                    }
                                  },
                                  "args": [
                                    {
                                      "literal": {
                                        "date": 10561
                                      }
                                    },
                                    {
                                      "literal": {
                                        "intervalDayToSecond": {
                                          "days": 120
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      }
                    },
                    "expressions": [
                      {
                        "selection": {
                          "directReference": {
                            "structField": {
                              "field": 8
                            }
                          },
                          "rootReference": {}
                        }
                      },
                      {
                        "selection": {
                          "directReference": {
                            "structField": {
                              "field": 9
                            }
                          },
                          "rootReference": {}
                        }
                      },
                      {
                        "selection": {
                          "directReference": {
                            "structField": {
                              "field": 4
                            }
                          },
                          "rootReference": {}
                        }
                      },
                      {
                        "selection": {
                          "directReference": {
                            "structField": {
                              "field": 5
                            }
                          },
                          "rootReference": {}
                        }
                      },
                      {
                        "scalarFunction": {
                          "functionReference": 3,
                          "outputType": {
                            "decimal": {
                              "precision": 19,
                              "nullability": "NULLABILITY_NULLABLE"
                            }
                          },
                          "args": [
                            {
                              "selection": {
                                "directReference": {
                                  "structField": {
                                    "field": 5
                                  }
                                },
                                "rootReference": {}
                              }
                            },
                            {
                              "scalarFunction": {
                                "functionReference": 4,
                                "outputType": {
                                  "decimal": {
                                    "precision": 19,
                                    "nullability": "NULLABILITY_NULLABLE"
                                  }
                                },
                                "args": [
                                  {
                                    "cast": {
                                      "type": {
                                        "decimal": {
                                          "precision": 19,
                                          "nullability": "NULLABILITY_NULLABLE"
                                        }
                                      },
                                      "input": {
                                        "literal": {
                                          "i32": 1
                                        }
                                      }
                                    }
                                  },
                                  {
                                    "selection": {
                                      "directReference": {
                                        "structField": {
                                          "field": 6
                                        }
                                      },
                                      "rootReference": {}
                                    }
                                  }
                                ]
                              }
                            }
                          ]
                        }
                      },
                      {
                        "scalarFunction": {
                          "functionReference": 3,
                          "outputType": {
                            "decimal": {
                              "precision": 19,
                              "nullability": "NULLABILITY_NULLABLE"
                            }
                          },
                          "args": [
                            {
                              "scalarFunction": {
                                "functionReference": 3,
                                "outputType": {
                                  "decimal": {
                                    "precision": 19,
                                    "nullability": "NULLABILITY_NULLABLE"
                                  }
                                },
                                "args": [
                                  {
                                    "selection": {
                                      "directReference": {
                                        "structField": {
                                          "field": 5
                                        }
                                      },
                                      "rootReference": {}
                                    }
                                  },
                                  {
                                    "scalarFunction": {
                                      "functionReference": 4,
                                      "outputType": {
                                        "decimal": {
                                          "precision": 19,
                                          "nullability": "NULLABILITY_NULLABLE"
                                        }
                                      },
                                      "args": [
                                        {
                                          "cast": {
                                            "type": {
                                              "decimal": {
                                                "precision": 19,
                                                "nullability": "NULLABILITY_NULLABLE"
                                              }
                                            },
                                            "input": {
                                              "literal": {
                                                "i32": 1
                                              }
                                            }
                                          }
                                        },
                                        {
                                          "selection": {
                                            "directReference": {
                                              "structField": {
                                                "field": 6
                                              }
                                            },
                                            "rootReference": {}
                                          }
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            {
                              "scalarFunction": {
                                "functionReference": 5,
                                "outputType": {
                                  "decimal": {
                                    "precision": 19,
                                    "nullability": "NULLABILITY_NULLABLE"
                                  }
                                },
                                "args": [
                                  {
                                    "cast": {
                                      "type": {
                                        "decimal": {
                                          "precision": 19,
                                          "nullability": "NULLABILITY_NULLABLE"
                                        }
                                      },
                                      "input": {
                                        "literal": {
                                          "i32": 1
                                        }
                                      }
                                    }
                                  },
                                  {
                                    "selection": {
                                      "directReference": {
                                        "structField": {
                                          "field": 7
                                        }
                                      },
                                      "rootReference": {}
                                    }
                                  }
                                ]
                              }
                            }
                          ]
                        }
                      },
                      {
                        "selection": {
                          "directReference": {
                            "structField": {
                              "field": 6
                            }
                          },
                          "rootReference": {}
                        }
                      }
                    ]
                  }
                },
                "groupings": [
                  {
                    "groupingExpressions": [
                      {
                        "selection": {
                          "directReference": {
                            "structField": {}
                          },
                          "rootReference": {}
                        }
                      },
                      {
                        "selection": {
                          "directReference": {
                            "structField": {
                              "field": 1
                            }
                          },
                          "rootReference": {}
                        }
                      }
                    ]
                  }
                ],
                "measures": [
                  {
                    "measure": {
                      "functionReference": 6,
                      "phase": "AGGREGATION_PHASE_INITIAL_TO_RESULT",
                      "outputType": {
                        "decimal": {
                          "precision": 19,
                          "nullability": "NULLABILITY_NULLABLE"
                        }
                      },
                      "args": [
                        {
                          "selection": {
                            "directReference": {
                              "structField": {
                                "field": 2
                              }
                            },
                            "rootReference": {}
                          }
                        }
                      ]
                    }
                  },
                  {
                    "measure": {
                      "functionReference": 6,
                      "phase": "AGGREGATION_PHASE_INITIAL_TO_RESULT",
                      "outputType": {
                        "decimal": {
                          "precision": 19,
                          "nullability": "NULLABILITY_NULLABLE"
                        }
                      },
                      "args": [
                        {
                          "selection": {
                            "directReference": {
                              "structField": {
                                "field": 3
                              }
                            },
                            "rootReference": {}
                          }
                        }
                      ]
                    }
                  },
                  {
                    "measure": {
                      "functionReference": 6,
                      "phase": "AGGREGATION_PHASE_INITIAL_TO_RESULT",
                      "outputType": {
                        "decimal": {
                          "precision": 19,
                          "nullability": "NULLABILITY_NULLABLE"
                        }
                      },
                      "args": [
                        {
                          "selection": {
                            "directReference": {
                              "structField": {
                                "field": 4
                              }
                            },
                            "rootReference": {}
                          }
                        }
                      ]
                    }
                  },
                  {
                    "measure": {
                      "functionReference": 6,
                      "phase": "AGGREGATION_PHASE_INITIAL_TO_RESULT",
                      "outputType": {
                        "decimal": {
                          "precision": 19,
                          "nullability": "NULLABILITY_NULLABLE"
                        }
                      },
                      "args": [
                        {
                          "selection": {
                            "directReference": {
                              "structField": {
                                "field": 5
                              }
                            },
                            "rootReference": {}
                          }
                        }
                      ]
                    }
                  },
                  {
                    "measure": {
                      "functionReference": 7,
                      "phase": "AGGREGATION_PHASE_INITIAL_TO_RESULT",
                      "outputType": {
                        "decimal": {
                          "precision": 19,
                          "nullability": "NULLABILITY_NULLABLE"
                        }
                      },
                      "args": [
                        {
                          "selection": {
                            "directReference": {
                              "structField": {
                                "field": 2
                              }
                            },
                            "rootReference": {}
                          }
                        }
                      ]
                    }
                  },
                  {
                    "measure": {
                      "functionReference": 7,
                      "phase": "AGGREGATION_PHASE_INITIAL_TO_RESULT",
                      "outputType": {
                        "decimal": {
                          "precision": 19,
                          "nullability": "NULLABILITY_NULLABLE"
                        }
                      },
                      "args": [
                        {
                          "selection": {
                            "directReference": {
                              "structField": {
                                "field": 3
                              }
                            },
                            "rootReference": {}
                          }
                        }
                      ]
                    }
                  },
                  {
                    "measure": {
                      "functionReference": 7,
                      "phase": "AGGREGATION_PHASE_INITIAL_TO_RESULT",
                      "outputType": {
                        "decimal": {
                          "precision": 19,
                          "nullability": "NULLABILITY_NULLABLE"
                        }
                      },
                      "args": [
                        {
                          "selection": {
                            "directReference": {
                              "structField": {
                                "field": 6
                              }
                            },
                            "rootReference": {}
                          }
                        }
                      ]
                    }
                  },
                  {
                    "measure": {
                      "functionReference": 8,
                      "phase": "AGGREGATION_PHASE_INITIAL_TO_RESULT",
                      "outputType": {
                        "i64": {
                          "nullability": "NULLABILITY_REQUIRED"
                        }
                      }
                    }
                  }
                ]
              }
            },
            "sorts": [
              {
                "expr": {
                  "selection": {
                    "directReference": {
                      "structField": {}
                    },
                    "rootReference": {}
                  }
                },
                "direction": "SORT_DIRECTION_ASC_NULLS_LAST"
              },
              {
                "expr": {
                  "selection": {
                    "directReference": {
                      "structField": {
                        "field": 1
                      }
                    },
                    "rootReference": {}
                  }
                },
                "direction": "SORT_DIRECTION_ASC_NULLS_LAST"
              }
            ]
          }
        },
        "names": [
          "L_RETURNFLAG",
          "L_LINESTATUS",
          "SUM_QTY",
          "SUM_BASE_PRICE",
          "SUM_DISC_PRICE",
          "SUM_CHARGE",
          "AVG_QTY",
          "AVG_PRICE",
          "AVG_DISC",
          "COUNT_ORDER"
        ]
      }
    }
  ]
}`;let n,s=i,o;af(()=>{let h=new F({state:j.create({doc:i,extensions:[Ec(),Fc(),dg(ng()),vg(),Hd(),Qh.of(Fp),F.theme({"&":{width:"40vw",height:"50vh"},".cm-scroller":{overflow:"auto"}}),F.updateListener.of(a=>{e(2,s=h.state.doc.toString())}),og()]}),parent:n})});function l(h){Fr[h?"unshift":"push"](()=>{n=h,e(0,n)})}return r.$$.update=()=>{if(r.$$.dirty&4)try{Cf(s).then(h=>e(1,o=h))}catch(h){console.error(h)}},[n,o,s,l]}class Cg extends wf{constructor(t){super(),yf(this,t,Ag,Sg,rf,{})}}Wl().then(()=>new Cg({target:document.getElementById("app"),props:{}}));
